<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[牛牛龙]]></title>
  <link href="http://yulongniu.github.io/atom.xml" rel="self"/>
  <link href="http://yulongniu.github.io/"/>
  <updated>2015-06-29T00:29:16+08:00</updated>
  <id>http://yulongniu.github.io/</id>
  <author>
    <name><![CDATA[Yulong Niu]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[UCSC Table下载注释文件]]></title>
    <link href="http://yulongniu.github.io/blog/2015/06/02/download-ucsc-gene-mask/"/>
    <updated>2015-06-02T16:49:41+08:00</updated>
    <id>http://yulongniu.github.io/blog/2015/06/02/download-ucsc-gene-mask</id>
    <content type="html"><![CDATA[<p>在进行RNA-seq数据分析时，需要从<a href="http://genome.ucsc.edu/cgi-bin/hgTables">UCSC Table</a>下载各种注释信息。比如Cufflinks等要求的转录组注释信息、Cufflinks建议去除的rRNA/tRNA/线粒体组注释。</p>

<h2 id="section">1. 基因注释信息</h2>

<p>下载转录组Ensembl注释文件：</p>

<p><img src="http://yulongniu.github.io/images/hg19_ensembl.png" title="image" alt="UCSC下载Ensembl注释" /></p>

<!--more-->

<p>在“table”选择中，<code class="language-bash">ensemblSource</code>表示Ensembl类型注释，<code class="language-bash">ensemblToGeneName</code>表示Ensembl到基因名注释对应。</p>

<h2 id="rrna">2. rRNA注释信息</h2>

<p>分为两步：</p>

<p>第一步， “table”选择<code class="language-bash">wgEncodeGencodeBasicV19</code>。</p>

<p><img src="http://yulongniu.github.io/images/hg19_rRNA.png" title="image" alt="UCSC下载rRNA注释" /></p>

<p>第二步，按照下图编辑“filter”。</p>

<p><img src="http://yulongniu.github.io/images/hg19_rRNA_maskTable.png" title="image" alt="UCSC下载rRNA注释Table" /></p>

<p><img src="http://yulongniu.github.io/images/hg19_rRNA_mask.png" title="image" alt="UCSC下载rRNA注释筛选" /></p>

<h2 id="trna">3. tRNA注释信息</h2>

<p>分为两步：</p>

<p>第一步，“track”选择 <code class="language-bash">tRNA Genes</code>。</p>

<p><img src="http://yulongniu.github.io/images/hg19_tRNA.png" title="image" alt="UCSC下载tRNA注释" /></p>

<p>第二步，保留pseudo tRNA注释。</p>

<p><img src="http://yulongniu.github.io/images/hg19_tRNA_mask.png" title="image" alt="UCSC下载tRNA注释" /></p>

<h2 id="section-1">4. 线粒体基因组注释</h2>

<p>分为两步：</p>

<p>第一步， “table”选择<code class="language-bash">wgEncodeGencodeBasicV19</code>。</p>

<p><img src="http://yulongniu.github.io/images/hg19_chrM.png" title="image" alt="UCSC下载chrM注释" /></p>

<p>第二步，按照下图编辑“filter”。</p>

<p><img src="http://yulongniu.github.io/images/hg19_chrM_mask.png" title="image" alt="UCSC下载chrM注释筛选" /></p>

<h3 id="section-2">参考网址</h3>

<ul>
  <li>
    <p>USCS Genome Browser的Google论坛：<a href="https://groups.google.com/a/soe.ucsc.edu/forum/#!topic/genome/IL_aeOuPYU0">1</a>、<a href="https://groups.google.com/a/soe.ucsc.edu/forum/#!msg/genome/jSAY8w1JVVo/P6lk4OJzDNEJ">2</a></p>
  </li>
  <li>
    <p>另一种选择rRNA、tRNA和线粒体组注释的方法<a href="http://onetipperday.blogspot.tw/2012/08/how-to-get-trnarrnamitochondrial-gene.html">How to get tRNA/rRNA/mitochondrial gene GTF file</a></p>
  </li>
  <li>
    <p><a href="http://webappl.blogspot.tw/2015/02/extract-rrna-and-trna-features-from.html">Extract rRNA and tRNA features from UCSC Browser</a></p>
  </li>
</ul>

<h3 id="section-3">更新记录</h3>

<p>2015年6月1日</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bash简易编程]]></title>
    <link href="http://yulongniu.github.io/blog/2015/05/28/bash-program/"/>
    <updated>2015-05-28T21:24:32+08:00</updated>
    <id>http://yulongniu.github.io/blog/2015/05/28/bash-program</id>
    <content type="html"><![CDATA[<h2 id="section">1. 循环</h2>

<p><code class="language-bash">for</code>循环体</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>for in Bash</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="k">for</span> i in *.zip
</span><span class="line"><span class="k">do</span>
</span><span class="line">    <span class="nb">echo</span> <span class="s2">&quot;$i&quot;</span>
</span><span class="line"><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<h2 id="section-1">2. 字符串分割</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Split strings</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># write in file &quot;testsplit.sh&quot;</span>
</span><span class="line"><span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;,&#39;</span> <span class="nb">read</span> -ra splitArray <span class="o">&lt;&lt;&lt;</span> <span class="s2">&quot;This,is,a,test&quot;</span>
</span><span class="line"><span class="k">for</span> i in <span class="s2">&quot;${splitArray[@]}&quot;</span>
</span><span class="line"><span class="k">do</span>
</span><span class="line">    <span class="nb">echo</span> <span class="s2">&quot;$i&quot;</span>
</span><span class="line"><span class="k">done</span>
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>bash testsplit.sh
</span><span class="line">This
</span><span class="line">is
</span><span class="line">a
</span><span class="line"><span class="nb">test</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-2">3. 屏幕输出存入变量</h2>

<p>某个bash命令，比如<code class="language-bash">ls -l</code>存入变量，之后引用变量。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Save Command Output into Variables</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 注意等号前后不能加空格</span>
</span><span class="line"><span class="nv">listOutput</span><span class="o">=</span><span class="sb">`</span>ls -l<span class="sb">`</span>
</span><span class="line"><span class="nb">echo</span> <span class="s2">&quot;$listOutput&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-3">参考网址</h3>

<ul>
  <li>
    <p><a href="http://stackoverflow.com/questions/918886/how-do-i-split-a-string-on-a-delimiter-in-bash">How do I split a string on a delimiter in Bash?</a></p>
  </li>
  <li>
    <p><a href="http://stackoverflow.com/questions/4651437/how-to-set-a-bash-variable-equal-to-the-output-from-a-command">How to set a BASH variable equal to the output from a command?</a></p>
  </li>
</ul>

<h3 id="section-4">更新记录</h3>

<p>2015年5月27日</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[过滤TopHat分析双端测序的输出]]></title>
    <link href="http://yulongniu.github.io/blog/2015/05/16/filter-tophat2-output/"/>
    <updated>2015-05-16T04:33:10+08:00</updated>
    <id>http://yulongniu.github.io/blog/2015/05/16/filter-tophat2-output</id>
    <content type="html"><![CDATA[<script type="text/x-mathjax-config">
MathJax.Hub.Config({
TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

<h2 id="section">0. 结论</h2>

<p>在使用TopHat2匹配双端测序结果后，建议根据成对reads的map基因组位置唯一、方向正确和距离合适的标准，筛选得到的匹配结果。比如，TopHat2可能生成<code class="language-bash">accepted_hits.bam</code>文件，处理方法如下：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Filter TopHat Outputs</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 首先查看bam文件头部有多少行</span>
</span><span class="line"><span class="nv">$ </span>samtools view -H accepted_hits.bam <span class="p">|</span> wc -l
</span><span class="line">86
</span><span class="line">
</span><span class="line"><span class="c"># 筛选成对且成功map到基因组唯一位置的reads，按照上一条输出结果，调整“NR &lt;= 86”</span>
</span><span class="line"><span class="nv">$ </span>samtools view -h accepted_hits.bam <span class="p">|</span> <span class="se">\</span>
</span><span class="line">    awk <span class="s1">&#39;{if (NR &lt;= 86) print $0}; {if($5 == 50 &amp;&amp; ($2 == 163 || $2 == 147 || $2 == 83 || $2 == 99)) print $0}&#39;</span> <span class="p">|</span> <span class="se">\</span>
</span><span class="line">    samtools view -b - &gt; accepted_filtered.bam
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>samtools view accepted_filtered.bam <span class="p">|</span> wc -l
</span><span class="line">79143942
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="tophatsam">1. TopHat输出sam文件的第五列</h2>

<p><a href="http://ccb.jhu.edu/software/tophat/manual.shtml">TopHat文档</a>没有解释其输出bam文件（比如<code class="language-bash">accepted_hits.bam</code>）的第五列的意义。按照<a href="http://bowtie-bio.sourceforge.net/bowtie2/index.shtml">Bowtie2</a>输出结果来看，是表示映射质量指标Mapping Quality scores（MAPQ），具体计算参考公式$\eqref{eq:1}$。</p>

<script type="math/tex; mode=display">\begin{align}
MAPQ = -10 \times log_{10}(pvalue)
\label{eq:1}
\end{align}</script>

<!--more-->

<p>MAPQ值越大，表示对应的read的alignment质量越高。然而，在TopHat输出结果中，MAPQ所代表意义略有不同。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>&#8220;MAPQ&#8221; distribution from TopHat2 accepted mapping reads</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 查看accepted_hits.bam文件的MAPQ数值，并统计出现频数</span>
</span><span class="line"><span class="nv">$ </span>samtools view accepted_hits.bam <span class="p">|</span> awk <span class="s1">&#39;{print $5}&#39;</span> <span class="p">|</span> sort --parallel<span class="o">=</span><span class="m">4</span> -n <span class="p">|</span> uniq -c
</span><span class="line"><span class="m">5057430</span> 0
</span><span class="line"><span class="m">3117731</span> 1
</span><span class="line"><span class="m">8058500</span> 3
</span><span class="line"><span class="m">93044727</span> 50
</span><span class="line">
</span><span class="line"><span class="c"># 查看前100位MAPQ数值和NH:i:n分布</span>
</span><span class="line"><span class="nv">$ </span>samtools view accepted_hits.bam <span class="p">|</span> awk <span class="s1">&#39;{print $5}&#39;</span> <span class="p">|</span> head -100 <span class="p">|</span> sort --parallel<span class="o">=</span><span class="m">4</span> -n <span class="p">|</span> uniq -c
</span><span class="line"><span class="m">35</span> 0
</span><span class="line"><span class="m">42</span> 1
</span><span class="line"><span class="m">22</span> 3
</span><span class="line"><span class="m">1</span> 50
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>samtools view accepted_hits.bam <span class="p">|</span> awk <span class="s1">&#39;{print $20}&#39;</span> <span class="p">|</span> head -100 <span class="p">|</span> sort --parallel<span class="o">=</span><span class="m">4</span> -n <span class="p">|</span> uniq -c
</span><span class="line"><span class="m">1</span> NH:i:1
</span><span class="line"><span class="m">22</span> NH:i:2
</span><span class="line"><span class="m">3</span> NH:i:20
</span><span class="line"><span class="m">13</span> NH:i:3
</span><span class="line"><span class="m">29</span> NH:i:4
</span><span class="line"><span class="m">5</span> NH:i:5
</span><span class="line"><span class="m">21</span> NH:i:6
</span><span class="line"><span class="m">1</span> NH:i:7
</span><span class="line"><span class="m">2</span> NH:i:8
</span><span class="line"><span class="m">3</span> NH:i:9
</span><span class="line">
</span><span class="line"><span class="c"># 查看前200位MAPQ数值和NH:i:n分布</span>
</span><span class="line"><span class="nv">$ </span>samtools view accepted_hits.bam <span class="p">|</span> awk <span class="s1">&#39;{print $5}&#39;</span> <span class="p">|</span> head -200 <span class="p">|</span> sort --parallel<span class="o">=</span><span class="m">4</span> -n <span class="p">|</span> uniq -c
</span><span class="line"><span class="m">60</span> 0
</span><span class="line"><span class="m">43</span> 1
</span><span class="line"><span class="m">67</span> 3
</span><span class="line"><span class="m">30</span> 50
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>samtools view accepted_hits.bam <span class="p">|</span> awk <span class="s1">&#39;{print $20}&#39;</span> <span class="p">|</span> head -200 <span class="p">|</span> sort --parallel<span class="o">=</span><span class="m">4</span> -n <span class="p">|</span> uniq -c
</span><span class="line"><span class="m">30</span> NH:i:1
</span><span class="line"><span class="m">8</span> NH:i:12
</span><span class="line"><span class="m">7</span> NH:i:14
</span><span class="line"><span class="m">67</span> NH:i:2
</span><span class="line"><span class="m">3</span> NH:i:20
</span><span class="line"><span class="m">13</span> NH:i:3
</span><span class="line"><span class="m">30</span> NH:i:4
</span><span class="line"><span class="m">5</span> NH:i:5
</span><span class="line"><span class="m">31</span> NH:i:6
</span><span class="line"><span class="m">1</span> NH:i:7
</span><span class="line"><span class="m">2</span> NH:i:8
</span><span class="line"><span class="m">3</span> NH:i:9
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>首先，我们可以看到TopHat输出的MAPQ只有四个数值，分别为<code class="language-bash">50</code>、<code class="language-bash">3</code>、<code class="language-bash">1</code>和<code class="language-bash">0</code>。根据<a href="http://samtools.github.io/hts-specs/SAMv1.pdf">sam文件标准</a>，<code class="language-bash">NH:i:n</code>表示含有查询序列的alignment的数量。因此，通过上述前100位和前200位分析可以发现，MAPQ并不是按照公式$\eqref{eq:1}$计算，而有可能是以下关系：</p>

<hr />

<table>
  <thead>
    <tr>
      <th style="text-align: left">MAPQ (tophat)</th>
      <th style="text-align: center">Tag</th>
      <th style="text-align: right">描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">50</td>
      <td style="text-align: center">NH:i:1</td>
      <td style="text-align: right">map至唯一位置</td>
    </tr>
    <tr>
      <td style="text-align: left">30</td>
      <td style="text-align: center">NH:i:2</td>
      <td style="text-align: right">map至2个位置</td>
    </tr>
    <tr>
      <td style="text-align: left">1</td>
      <td style="text-align: center">NH:i:3/NH:i:4</td>
      <td style="text-align: right">map至3个或4个位置</td>
    </tr>
    <tr>
      <td style="text-align: left">0</td>
      <td style="text-align: center">NH:i:n (n &gt; 4)</td>
      <td style="text-align: right">map到多余4个位置</td>
    </tr>
  </tbody>
</table>

<hr />

<p>展示一个<code class="language-bash">NH:i:1</code>的例子，注意Illumina双端测序平台<code class="language-bash">fr-unstranded</code>：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Two pairs of unique mapped reads from Illumina HiSeq2000 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">HISEQ2000-02:436:C2PG3ACXX:3:2313:10972:95322   <span class="m">163</span>     chr1    <span class="m">637224</span>  <span class="m">50</span>      <span class="nv">100M</span>    <span class="o">=</span>       <span class="m">637339</span>  <span class="m">215</span>     AAATGATCTGTACAATAACCCCCTGTGACACCAGTCTACCTATGTAACAAATGCCCCTAAACTTAAAATAAAAGTTAAAAAAAAAGAAAATTAAAATCTC  &lt;@@BDABBDFBCDGEGHIGIIGIABAFHBGDFGGGHIIIFIEIGGGGIIIFFDHIGIIIIIIIICEHIIIIIIHEHHDHFFCBCCB@BCAACCCCCECCC    AS:i:0  XN:i:0  XM:i:0  XO:i:0  XG:i:0  NM:i:0  MD:Z:100     YT:Z:UU  NH:i:1
</span><span class="line">HISEQ2000-02:436:C2PG3ACXX:3:2313:10972:95322   <span class="m">83</span>      chr1    <span class="m">637339</span>  <span class="m">50</span>      <span class="nv">100M</span>    <span class="o">=</span>       <span class="m">637224</span>  -215    GTAATATGAAAAACACAAATCTTTCATTCATTCCTTTCAACTGATGAGGAAAATGAGGCATCGGGAGTTAGTAAAAGTCCACATTGAGATATGAGACCCA  <span class="nv">CCADDDCCCCCCCDEEEECAEHEEGGIIHGFAAGGGHEF</span><span class="o">=</span>IGGGIIGGHGCGIEIIIGIIIIIIIFIHIIIIIIGIIHFEAIGGIIGFFDFHDDDAD@@@    AS:i:0  XN:i:0  XM:i:0  XO:i:0  XG:i:0  NM:i:0  MD:Z:100     YT:Z:UU  NH:i:1
</span><span class="line">
</span><span class="line">HISEQ2000-06:325:C2RC0ACXX:5:2205:6961:88285    <span class="m">99</span>      chr1    <span class="m">643662</span>  <span class="m">50</span>      <span class="nv">100M</span>    <span class="o">=</span>       <span class="m">643707</span>  <span class="m">145</span>     CCTATCAAAATCTTAGCATTCCTCTTAGCCCTCAACAAAGCATTTCTAAAATGTGTATAGAAGACCAAAGGGCCAAAAGAGTCAACTTCTGAAGAAGCGC  CCCFFFFFHHHHHJJJJIJJHJJJJJJJIIJJJJJJJJJJJJIJJJJJIIIJJIIIJJJJJJJJJIJJJJIJJJIHHHHFFEFFFEEEEEEEDDCDDCDD    AS:i:0  XN:i:0  XM:i:0  XO:i:0  XG:i:0  NM:i:0  MD:Z:100     YT:Z:UU  NH:i:1
</span><span class="line">HISEQ2000-06:325:C2RC0ACXX:5:2205:6961:88285    <span class="m">147</span>     chr1    <span class="m">643707</span>  <span class="m">50</span>      <span class="nv">100M</span>    <span class="o">=</span>       <span class="m">643662</span>  -145    CTAAAATGTGTATAGAAGACCAAAGGGCCAAAAGAGTCAACTTCTGAAGAAGCGCAAAAAGAAAGTTGAGGAAATCTTAAAACATGTTATTGAGCTTAAA  CEEEDDDDEDFEEEEEEEBFFFFFHHHHEJJJJJJJJIJJJJGJIIIIHFJJJIIJJJJJIJJJJJJJJJJJJGHJJJJIJJJJJJJGHHHHFFFFFCCC    AS:i:0  XN:i:0  XM:i:0  XO:i:0  XG:i:0  NM:i:0  MD:Z:100     YT:Z:UU  NH:i:1
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="sam">2. sam文件的第二列</h2>

<p>sam文件中的第二列提供了具体的map情况，下列表格摘自<a href="http://samtools.github.io/hts-specs/SAMv1.pdf">sam文件标准</a>，sam/bam文件中第二列各种条件<strong>求和</strong>的<strong>十进制</strong>标识，<a href="http://broadinstitute.github.io/picard/explain-flags.html">快速解释第二列的bitwise FLAG</a>：</p>

<hr />

<table>
  <thead>
    <tr>
      <th style="text-align: center">Decimal</th>
      <th style="text-align: center">Hexadecimal</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">0x1</td>
      <td style="text-align: left">template having multiple segments in sequencing</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">0x2</td>
      <td style="text-align: left">each segment properly aligned according to the aligner</td>
    </tr>
    <tr>
      <td style="text-align: center">4</td>
      <td style="text-align: center">0x4</td>
      <td style="text-align: left">segment unmapped</td>
    </tr>
    <tr>
      <td style="text-align: center">8</td>
      <td style="text-align: center">0x8</td>
      <td style="text-align: left">next segment in the template unmapped</td>
    </tr>
    <tr>
      <td style="text-align: center">16</td>
      <td style="text-align: center">0x10</td>
      <td style="text-align: left">SEQ being reverse complemented</td>
    </tr>
    <tr>
      <td style="text-align: center">32</td>
      <td style="text-align: center">0x20</td>
      <td style="text-align: left">SEQ of the next segment in the template being reverse complemented</td>
    </tr>
    <tr>
      <td style="text-align: center">64</td>
      <td style="text-align: center">0x40</td>
      <td style="text-align: left">the first segment in the template</td>
    </tr>
    <tr>
      <td style="text-align: center">128</td>
      <td style="text-align: center">0x80</td>
      <td style="text-align: left">the last segment in the template</td>
    </tr>
    <tr>
      <td style="text-align: center">256</td>
      <td style="text-align: center">0x100</td>
      <td style="text-align: left">secondary alignment</td>
    </tr>
    <tr>
      <td style="text-align: center">512</td>
      <td style="text-align: center">0x200</td>
      <td style="text-align: left">not passing quality controls</td>
    </tr>
    <tr>
      <td style="text-align: center">1024</td>
      <td style="text-align: center">0x400</td>
      <td style="text-align: left">PCR or optical duplicate</td>
    </tr>
    <tr>
      <td style="text-align: center">2048</td>
      <td style="text-align: center">0x800</td>
      <td style="text-align: left">supplementary alignment</td>
    </tr>
  </tbody>
</table>

<hr />

<p>在map完成双端测序序列中，我们感兴趣的是一对reads都正确align到基因组上，而且方相匹配又距离合适。符合这样条件的reads，对应的第二列数值为99、147、83和163，具体图示参考<a href="https://biobeat.wordpress.com/2013/04/29/directional-rna-seq-part-1-extract-strand-information-from-sam-file/">Directional RNA-seq— Part 1: SAM file flags</a>。下面表格解释四个数值的具体意义，其中<code class="language-bash">1</code>标识双端测序，<code class="language-bash">2</code>表示一对reads正确地map到基因组合适位置，表格中着重陈述<code class="language-bash">64</code>、<code class="language-bash">32</code>、<code class="language-bash">128</code>和<code class="language-bash">16</code>。</p>

<hr />

<table>
  <thead>
    <tr>
      <th>Flag</th>
      <th>Composition</th>
      <th>Explanation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>99</td>
      <td>64+32+2+1</td>
      <td>一对引物中第一个map到基因组正义链；第二个反方向map到基因组正义链</td>
    </tr>
    <tr>
      <td>147</td>
      <td>128+16+2+1</td>
      <td>一对引物中第二个反方向map基因组正义链；第一个map到基因组正义链</td>
    </tr>
    <tr>
      <td>83</td>
      <td>64+16+2+1</td>
      <td>一对引物中第一个map到基因组反义链；第二个反方向map到基因组反义链</td>
    </tr>
    <tr>
      <td>163</td>
      <td>128+32+2+1</td>
      <td>一对引物中第二个反方向map基因组正义链；第一个map到基因组正义链</td>
    </tr>
  </tbody>
</table>

<hr />

<p>之后，我们需要筛选含有这些flags的reads。由于我们通常需要操作bam文件，也希望输出是bam文件，中间过程不希望再重新生成sam文件。那么，就需要结合使用<code class="language-bash">awk</code>进行筛选，具体方法见本篇文章开头所示。当然，如果是只是查看，可以使用下面例子中的 <code class="language-bash">samtools view -f 0x2</code>。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Count number of unique pair-mapped alignments</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># map到基因组上唯一位置的reads数目</span>
</span><span class="line"><span class="nv">$ </span>samtools view -q <span class="m">50</span> accepted_hits.bam <span class="p">|</span> wc -l
</span><span class="line">93044727
</span><span class="line"><span class="c"># 成对reads都map到基因组对应位置的reads数目</span>
</span><span class="line"><span class="nv">$ </span>samtools view -f 0x2 accepted_hits.bam <span class="p">|</span> wc -l
</span><span class="line">88793640
</span><span class="line"><span class="c"># 成对且唯一mapped的reads数目</span>
</span><span class="line"><span class="nv">$ </span>samtools view -q <span class="m">50</span> -f 0x2 accepted_hits.bam <span class="p">|</span> wc -l
</span><span class="line">79143942
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="tophat">3. 操作TopHat输出的文件命令集锦</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Useful bash for bam files from TopHat</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># samtools的view -c命令，其实就是输出sam文件有多少行</span>
</span><span class="line"><span class="nv">$ </span>samtools view accepted_hits.bam <span class="p">|</span> wc -l
</span><span class="line">109278388
</span><span class="line"><span class="nv">$ </span>samtools view -c accepted_hits.bam
</span><span class="line">109278388
</span><span class="line">
</span><span class="line"><span class="c"># 查看bam文件中mapped的reads长度分布</span>
</span><span class="line"><span class="c"># 第二种方法是运行FastQC，输出结果中也有显示</span>
</span><span class="line">samtools view accepted_hits.bam <span class="p">|</span> awk <span class="s1">&#39;{print length($10)}&#39;</span> <span class="p">|</span> sort -n <span class="p">|</span> uniq -c
</span><span class="line">
</span><span class="line"><span class="c"># 查看bed文件前几行</span>
</span><span class="line"><span class="nv">$ </span>head junction.bed
</span><span class="line"><span class="c"># 统计bed文件有多少行，需要去除第一行注释</span>
</span><span class="line"><span class="c"># 以下两种方式相同，但不够完美</span>
</span><span class="line"><span class="nv">$ </span>wc -l junction.bed
</span><span class="line"><span class="m">220648</span> junctions.bed
</span><span class="line"><span class="nv">$ </span>awk <span class="s1">&#39;END {print NR}&#39;</span> junctions.bed
</span><span class="line">220648
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="dnamrna">4. DNA链和mRNA链的称呼总结</h2>

<p>双链DNA和单链mRNA，对每条链都有特定的称呼。总结如下：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>DNA/RNA strands </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">3<span class="s1">&#39;~~~~~UCUGAU~~~~~ 5&#39;</span> mRNA的对应基因信息在reverse strand
</span><span class="line">
</span><span class="line">5<span class="s1">&#39;-----AGACTA----------ATTGTT----- 3&#39;</span>
</span><span class="line">3<span class="s1">&#39;-----TCTGAT----------TAACAA----- 5&#39;</span>
</span><span class="line">
</span><span class="line">                5<span class="s1">&#39;~~~~~AUUGUU~~~~~ 3&#39;</span> mRNA的对应基因信息在forward strand
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>对于一条双链DNA，称呼列表如下：</p>

<table>
  <thead>
    <tr>
      <th>方向<sup>a</sup></th>
      <th>名称1</th>
      <th>名称2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>从左至右</td>
      <td>forward</td>
      <td>plus</td>
    </tr>
    <tr>
      <td>从右至左</td>
      <td>reverse</td>
      <td>minus</td>
    </tr>
  </tbody>
</table>

<p><sup>a</sup>：方向是指5’至3’的阅读方向，用于区分两条DNA链条</p>

<hr />

<p>对于一条RNA链，其对应的双链DNA称呼如下：</p>

<table>
  <thead>
    <tr>
      <th>mRNA方向<sup>a</sup></th>
      <th>名称1</th>
      <th>名称2</th>
      <th>名称3</th>
      <th>名称4</th>
      <th>名称5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>同向</td>
      <td>coding</td>
      <td>nontemplate</td>
      <td>sense</td>
      <td>positive</td>
      <td>+</td>
    </tr>
    <tr>
      <td>反向</td>
      <td>template</td>
      <td>noncoding</td>
      <td>antisense</td>
      <td>negative</td>
      <td>-</td>
    </tr>
  </tbody>
</table>

<p><sup>a</sup>：mRNA方向是指5’至3’。</p>

<hr />

<h3 id="section-1">参考网址</h3>

<ul>
  <li>
    <p><a href="http://blog.qiuworld.com:8080/archives/3321">关于map当中的unique mapped reads问题</a></p>
  </li>
  <li>
    <p>TopHat的bam输出文件第五列（类似MAPQ）的讨论： <a href="https://groups.google.com/forum/#!topic/tuxedo-tools-users/m0p1qXDEqKA">tophat mapping quality</a>和<a href="http://www.acgt.me/blog/2015/3/17/more-madness-with-mapq-scores-aka-why-bioinformaticians-hate-poor-and-incomplete-software-documentation">More madness with MAPQ scores</a></p>
  </li>
  <li>
    <p><a href="https://biobeat.wordpress.com/2013/05/01/directional-rna-seq-part-2-using-samtools/">Directional RNA-seq— Part 2: Explore SAM flags using samtools</a></p>
  </li>
  <li>
    <p><a href="http://www.acgt.me/blog/2015/4/15/filtering-a-sam-file-generated-by-tophat-to-find-uniquely-mapped-concordant-read-pairs-awk-vs-samtools">Filtering a SAM file generated by TopHat to find uniquely mapped, concordant read pairs: AWK vs SAMtools</a></p>
  </li>
  <li>
    <p><a href="https://www.biostars.org/p/3423/">Question: Forward And Reverse Strand Conventions</a></p>
  </li>
  <li>
    <p><a href="http://en.wikipedia.org/wiki/Sense_(molecular_biology)">wiki</a></p>
  </li>
</ul>

<h3 id="section-2">更新记录</h3>

<p>2015年5月25日</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Django使用介绍]]></title>
    <link href="http://yulongniu.github.io/blog/2015/05/09/django-tutorial/"/>
    <updated>2015-05-09T13:42:15+08:00</updated>
    <id>http://yulongniu.github.io/blog/2015/05/09/django-tutorial</id>
    <content type="html"><![CDATA[<p>本文是学习<a href="https://docs.djangoproject.com/en/1.8/intro/tutorial01/">Django Tutorial</a>的记录，目的为了帮助快速浏览和查找Django使用细节。</p>

<h2 id="django">1. 安装Django</h2>

<p>本文使用<a href="https://www.python.org/">Python 3.3.6</a>和<a href="http://www.postgresql.org/">PostgreSQL 9.3.6</a>学习Django。可以参考<a href="http://yulongniu.bionutshell.org/blog/2015/05/09/python-different-version/">“使用Pyenv控制多个版本Python”</a>和 <a href="http://yulongniu.bionutshell.org/blog/2015/05/08/install-use-postgresql/">“Fedora安装与使用PostgreSQL”</a>，安装对应版本Python和PostgreSQL。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 安装Django</span>
</span><span class="line"><span class="nv">$ </span>pip install django
</span><span class="line">
</span><span class="line"><span class="c"># 安装PostgreSQL支持psycopg2 </span>
</span><span class="line"><span class="nv">$ </span>pip install psycopg2
</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 检查Django版本</span>
</span><span class="line"><span class="nv">$ </span>python -c <span class="s2">&quot;import django; print(django.get_version())&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section">2. 创建项目</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 创建名为mysite的项目</span>
</span><span class="line"><span class="nv">$ </span>django-admin startproject mysite
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>之后，配制数据库。修改<code class="language-bash">mysite/settings.py</code>对应位置。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>mysite/settings.py</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="c"># Database</span>
</span><span class="line"><span class="c"># https://docs.djangoproject.com/en/1.8/ref/settings/#databases</span>
</span><span class="line">
</span><span class="line"><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.postgresql_psycopg2&#39;</span><span class="p">,</span>
</span><span class="line">        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="s">&#39;testdb&#39;</span><span class="p">,</span>
</span><span class="line">        <span class="s">&#39;USER&#39;</span><span class="p">:</span> <span class="s">&#39;userName&#39;</span><span class="p">,</span>
</span><span class="line">        <span class="s">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s">&#39;passWord&#39;</span><span class="p">,</span>
</span><span class="line">        <span class="s">&#39;HOST&#39;</span><span class="p">:</span> <span class="s">&#39;/var/run/postgresql&#39;</span><span class="p">,</span>
</span><span class="line">        <span class="s">&#39;PORT&#39;</span><span class="p">:</span> <span class="s">&#39;5432&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 配制好数据库后，链接数据库</span>
</span><span class="line"><span class="nv">$ </span>python manage.py migrate
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>开启Django测试网络服务器</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>python manage.py runserver
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="app">3. 创建app</h2>

<p>首先， 创建新的app，比如<code class="language-bash">polls</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>python manage.py startapp polls
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>其次，修改app</p>

<p>app文件位置<code class="language-bash">polls/models.py</code>，之后在项目配制文件<code class="language-bash">mysite/settings.py</code>中添加app，最后添加app。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 添加app</span>
</span><span class="line"><span class="nv">$ </span>python manage.py makemigrations polls
</span><span class="line">
</span><span class="line"><span class="c"># 如果有数据库操作，可以打印具体的数据库操作脚本</span>
</span><span class="line"><span class="nv">$ </span>python manage.py sqlmigrate polls 0001
</span><span class="line">
</span><span class="line"><span class="c"># 也可以检查</span>
</span><span class="line"><span class="nv">$ </span>python manage.py check
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>最后，链接app与数据库</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>python manage.py migrate
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="a-idrefa"><a id="Ref">参考网址</a></h3>

<ul>
  <li><a href="https://docs.djangoproject.com/en/1.8/intro/tutorial01/">Django Tutorial</a></li>
</ul>

<h3 id="section-1">更新记录</h3>

<p>2015年5月9日</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用Pyenv控制多个版本Python]]></title>
    <link href="http://yulongniu.github.io/blog/2015/05/09/python-different-version/"/>
    <updated>2015-05-09T00:14:10+08:00</updated>
    <id>http://yulongniu.github.io/blog/2015/05/09/python-different-version</id>
    <content type="html"><![CDATA[<p>同时在一台电脑上使用多个版本的Python，可以通过<a href="https://github.com/yyuu/pyenv">pyenv</a>控制和管理。</p>

<h2 id="section">1. 安装方法</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>git clone git://github.com/yyuu/pyenv.git ~/.pyenv
</span><span class="line">
</span><span class="line"><span class="c"># 写入路径信息</span>
</span><span class="line"><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;export PYENV_ROOT=&quot;$HOME/.pyenv&quot;&#39;</span> &gt;&gt; ~/.bashrc
</span><span class="line"><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;export PATH=&quot;$PYENV_ROOT/bin:$PATH&quot;&#39;</span> &gt;&gt; ~/.bashrc
</span><span class="line"><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;eval &quot;$(pyenv init -)&quot;&#39;</span> &gt;&gt; ~/.bashrc
</span><span class="line">
</span><span class="line"><span class="c"># 重新载入</span>
</span><span class="line"><span class="nv">$ </span><span class="nb">source</span> ~/.bashrc
</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<h2 id="python">2. 安装多个版本Python和对应包</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 查看可提供的Python版本列表</span>
</span><span class="line"><span class="nv">$ </span>pyenv install --list
</span><span class="line">
</span><span class="line"><span class="c"># 安装Python所依赖包</span>
</span><span class="line"><span class="c"># yum install readline readline-devel readline-static openssl openssl-devel openssl-static sqlite-devel bzip2-devel bzip2-libs</span>
</span><span class="line">
</span><span class="line"><span class="c"># 安装其他版本Python</span>
</span><span class="line"><span class="c"># 如果命令行下载安装Python太慢，可以将下载的安装包放入~/.pyenv/cache/文件夹中，之后安装</span>
</span><span class="line"><span class="nv">$ </span>pyenv install 3.4.3
</span><span class="line"><span class="nv">$ </span>pyenv rehash
</span><span class="line">
</span><span class="line"><span class="c"># 查看已安装Python版本</span>
</span><span class="line"><span class="nv">$ </span>pyenv versions
</span><span class="line">
</span><span class="line"><span class="c"># 全局切换Python版本</span>
</span><span class="line"><span class="nv">$ </span>pyenv global 3.4.3
</span><span class="line">
</span><span class="line"><span class="c"># 安装对应版本Python包。</span>
</span><span class="line"><span class="c"># 每次安装包之后，都要执行rehash。</span>
</span><span class="line"><span class="nv">$ </span>pip install ipython
</span><span class="line"><span class="nv">$ </span>pyenv rehash
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>如果在使用<code class="language-bash">pip</code>安装包时，下载速度过慢，可以考虑使用国内源。比如：</p>

<ul>
  <li>
    <p>http://pypi.mirrors.ustc.edu.cn/</p>
  </li>
  <li>
    <p>http://pypi.douban.com/</p>
  </li>
</ul>

<p>使用方法为：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Using different pip mirror</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>pip install --upgrade numpy -i http://pypi.mirrors.ustc.edu.cn/simple
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="pyenv">3. 更新pyenv</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span><span class="nb">cd</span> ~/.pyenv
</span><span class="line"><span class="nv">$ </span>git pull
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="python-1">4. 删除特定版本Python</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 查找特定版本Python文件夹位置，之后直接删除即可。</span>
</span><span class="line"><span class="nv">$ </span>pyenv prefix 3.4.3
</span><span class="line"><span class="nv">$ </span>rm -rf ~/.pyenv/versions/3.4.3
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="a-idrefa"><a id="Ref">参考网址</a></h3>

<ul>
  <li>
    <p><a href="http://seisman.info/python-pyenv.html">Python多版本共存之pyenv</a></p>
  </li>
  <li>
    <p><a href="http://www.leadnt.com/2013/08/%E4%BD%BF%E7%94%A8%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F%E6%BA%90%E6%9D%A5%E5%8A%A0%E9%80%9Fpython-pypi%E5%8C%85%E7%9A%84%E5%AE%89%E8%A3%85/">使用国内镜像源来加速python pypi包的安装</a></p>
  </li>
</ul>

<h3 id="section-1">更新记录</h3>

<p>2015年5月23日</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fedora安装与使用PostgreSQL]]></title>
    <link href="http://yulongniu.github.io/blog/2015/05/08/install-use-postgresql/"/>
    <updated>2015-05-08T18:30:54+08:00</updated>
    <id>http://yulongniu.github.io/blog/2015/05/08/install-use-postgresql</id>
    <content type="html"><![CDATA[<h2 id="postgresql">1. 安装和开启postgresql</h2>

<p>Fedora直接使用<code class="language-bash">yum</code>安装相关组件。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 安装PostgreSQL</span>
</span><span class="line"><span class="c"># yum install postgresql postgresql-server postgresql-contrib postgresql-devel pgadmin3</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<p>初始化（只需要执行一次）。如果出现类似<code class="language-bash">Data directory is not empty!</code>报错，可以尝试执行删除操作<code>rm -f -r /usr/local/pgsql/data</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 初始化</span>
</span><span class="line"><span class="c"># postgresql-setup initdb</span>
</span><span class="line">
</span><span class="line"><span class="c"># 开启服务</span>
</span><span class="line"><span class="c"># service postgresql start</span>
</span><span class="line">
</span><span class="line"><span class="c"># 查询工作状态</span>
</span><span class="line"><span class="c"># service postgresql status</span>
</span><span class="line">
</span><span class="line"><span class="c"># 关闭服务</span>
</span><span class="line"><span class="c"># service postgresql stop</span>
</span><span class="line">
</span><span class="line"><span class="c"># 开机启动</span>
</span><span class="line"><span class="c"># chkconfig postgresql on</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section">2. 创建用户和数据库</h2>

<p>为了方便使用，可以在PostgreSQL中创建一个与当前系统用户名相同的用户，比如目前系统登陆用户为Kitty。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 进入home路径</span>
</span><span class="line"><span class="nv">$ </span><span class="nb">cd</span> <span class="se">\h</span>ome
</span><span class="line">
</span><span class="line"><span class="c"># 进入默认postgres用户，需要输入root密码。</span>
</span><span class="line"><span class="c"># 之后系统命令提示符会变成类似“bash-4.3$”。</span>
</span><span class="line"><span class="nv">$ </span>su postgres
</span><span class="line">
</span><span class="line"><span class="c"># 创建用户</span>
</span><span class="line"><span class="c"># -P：创建用户后立即创建密码</span>
</span><span class="line"><span class="c"># -s：用户为superuser</span>
</span><span class="line"><span class="c"># -e：打印消息</span>
</span><span class="line">bash-4.3<span class="nv">$ </span>createuser -P -s -e Kitty
</span><span class="line">
</span><span class="line"><span class="c"># 创建数据库</span>
</span><span class="line"><span class="c"># -O：制定用户</span>
</span><span class="line">bash-4.3<span class="nv">$ </span>createdb -O Kitty testdb
</span><span class="line">
</span><span class="line"><span class="c"># 退出</span>
</span><span class="line">bash-4.3<span class="nv">$ </span><span class="nb">exit</span>
</span><span class="line">
</span><span class="line"><span class="c"># 再创建新的数据库时，不需要进入postgres。</span>
</span><span class="line"><span class="c"># 直接在当前登录用户下创建即可。</span>
</span><span class="line"><span class="c"># 由于PostgreSQL用户与系统登录用户相同，不需要指定PostgreSQL用户</span>
</span><span class="line"><span class="nv">$ </span>creatdb testdb2
</span><span class="line">
</span><span class="line"><span class="c"># 删除数据库</span>
</span><span class="line"><span class="nv">$ </span>dropdb testdb2
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>创建完用户和对应数据库后，可以登录数据库控制台。登录后，系统命令提示符会变成类似“testdb=#”。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 登录testdb数据库控制台</span>
</span><span class="line"><span class="nv">$ </span>psql testdb
</span><span class="line">
</span><span class="line"><span class="c"># 完整登录命令</span>
</span><span class="line"><span class="c"># -U：用户名</span>
</span><span class="line"><span class="c"># -d：数据库</span>
</span><span class="line"><span class="c"># -h：host，默认为local socket</span>
</span><span class="line"><span class="c"># -p：端口</span>
</span><span class="line"><span class="nv">$ </span>psql -U Kitty -d testdb -h /var/run/postgresql -p 5432
</span><span class="line">
</span><span class="line"><span class="c"># 查看PostgreSQL配制文件路径</span>
</span><span class="line"><span class="nv">testdb</span><span class="o">=</span><span class="c"># SHOW config_file;</span>
</span><span class="line">
</span><span class="line"><span class="c"># 查看所有用户</span>
</span><span class="line"><span class="nv">testdb</span><span class="o">=</span><span class="c"># \du</span>
</span><span class="line">
</span><span class="line"><span class="c"># 查看表格（table）</span>
</span><span class="line"><span class="nv">testdb</span><span class="o">=</span><span class="c"># \dt</span>
</span><span class="line">
</span><span class="line"><span class="c"># 查看所有数据库</span>
</span><span class="line"><span class="nv">testdb</span><span class="o">=</span><span class="c"># \l</span>
</span><span class="line">
</span><span class="line"><span class="c"># 退出</span>
</span><span class="line"><span class="nv">testdb</span><span class="o">=</span><span class="c"># \q</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="a-idrefa"><a id="Ref">参考网址</a></h3>

<ul>
  <li>
    <p><a href="http://www.postgresql.org/docs/9.4/interactive/index.html">PostgreSQL 9.4 Manuals</a></p>
  </li>
  <li>
    <p><a href="http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html">PostgreSQL新手入门</a></p>
  </li>
  <li>
    <p><a href="http://www.heatware.net/linux-unix/how-install-postgresql-8-4-centos-5/">初始化错误</a></p>
  </li>
</ul>

<h3 id="section-1">更新记录</h3>

<p>2015年5月11日</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[C语言学习记录]]></title>
    <link href="http://yulongniu.github.io/blog/2014/12/08/c-program-note/"/>
    <updated>2014-12-08T07:23:16+08:00</updated>
    <id>http://yulongniu.github.io/blog/2014/12/08/c-program-note</id>
    <content type="html"><![CDATA[<h2 id="section">1. 基本数据类型</h2>

<h3 id="section-1">1.1 数字形式</h3>

<p>数字的位数是多少？</p>

<ul>
  <li>
    <p><code>int</code>：整数</p>
  </li>
  <li>
    <p><code>short</code>：短整数</p>
  </li>
  <li>
    <p><code>long</code>：长整数</p>
  </li>
  <li>
    <p><code>float</code>：浮点数</p>
  </li>
  <li>
    <p><code>double</code>：双浮点数</p>
  </li>
  <li>
    <p><code>char</code>：字符</p>
  </li>
</ul>

<!--more-->

<h3 id="section-2">1.2 其他形式</h3>

<ul>
  <li>
    <p><code>arrays</code></p>
  </li>
  <li>
    <p><code>structures</code></p>
  </li>
  <li>
    <p><code>unions</code></p>
  </li>
  <li>
    <p><code>pointers</code></p>
  </li>
  <li>
    <p><code>functions</code></p>
  </li>
</ul>

<h2 id="section-3">2. 操作类型和顺序</h2>

<ul>
  <li>
    <p>赋值操作<code>=</code>：从右向左</p>
  </li>
  <li>
    <p>或操作<code>||</code>、且操作<code>&amp;&amp;</code>：从左向右，遇到第一个<code>true</code>即停止</p>
  </li>
</ul>

<h2 id="section-4">3. 语法注意事项</h2>

<ul>
  <li>
    <p><code>#define LOWER 0</code>定义常量的语句之后，没有分号<code>;</code></p>
  </li>
  <li>
    <p><code>EOF</code>是文档结束的标志（End of File），在<code class="language-c">&lt;stdio.h&gt;</code>定义为一个整数<code>-1</code>，代码如下：</p>
  </li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>definition of EOF in C </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="c"><span class="line"><span class="cp">#ifndef EOF</span>
</span><span class="line"><span class="cp"># define EOF (-1)</span>
</span><span class="line"><span class="cp">#endif</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>
    <p>用引号<code>''</code>标记的字符串，对应的是ASCII的数字值</p>
  </li>
  <li>
    <p>赋值例如<code class="language-c">c = getchar()</code>也有值，其值等于等号左侧赋值操作后的值</p>
  </li>
  <li>
    <p><code>for</code>循环声明需要有主体，如无，在<code>for</code>语句后添加<code>;</code>作“无效声明（null statement）”</p>
  </li>
  <li>
    <p>矩阵计数从0开始</p>
  </li>
</ul>

<h2 id="section-5">4. 标准库</h2>

<h3 id="include-stdiohlanguage-c">4.1 <code class="language-c">#include &lt;stdio.h&gt;</code></h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="c"><span class="line"><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%3.0f %6.1f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">fahr</span><span class="p">,</span> <span class="n">celsius</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>
    <p><code>%d</code>：十进制整数</p>
  </li>
  <li>
    <p><code>%ld</code>：长十进制整数</p>
  </li>
  <li>
    <p><code>%6d</code>：十进制整数，至少6位宽</p>
  </li>
  <li>
    <p><code>%f</code>：浮点数</p>
  </li>
  <li>
    <p><code>%6f</code>：浮点数，至少6位宽</p>
  </li>
  <li>
    <p><code>%6.0f</code>：浮点树，至少6位宽，无小数点而且无小数位</p>
  </li>
  <li>
    <p><code>%.2f</code>：浮点数，小数点后两位</p>
  </li>
  <li>
    <p><code>%6.2f</code>：浮点数，至少6位宽，小数点后两位</p>
  </li>
  <li>
    <p><code>%o</code>：八进制</p>
  </li>
  <li>
    <p><code>%x</code>：六进制</p>
  </li>
  <li>
    <p><code>%c</code>：字符</p>
  </li>
  <li>
    <p><code>%s</code>：字符串</p>
  </li>
  <li>
    <p><code>%%</code>：<code>%</code>自身</p>
  </li>
</ul>

<h3 id="section-6">参考资料</h3>

<ul>
  <li>BW Kernighan and DM Ritchie: <a href="http://www.amazon.com/The-Programming-Language-2nd-Edition/dp/0131103628">The C Programming Language (2nd Edition)</a>, 1988.</li>
</ul>

<h3 id="section-7">更新记录</h3>

<p>2014年12月7日</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Emacs配置C语言编程环境]]></title>
    <link href="http://yulongniu.github.io/blog/2014/12/02/emacs-config-c/"/>
    <updated>2014-12-02T06:36:41+08:00</updated>
    <id>http://yulongniu.github.io/blog/2014/12/02/emacs-config-c</id>
    <content type="html"><![CDATA[<p>有很多优秀的C语言IDE用来实现高效的编程，比如<a href="https://www.jetbrains.com/clion/">CLion</a>。目前，CLion还在处于公开测试阶段，可以下载试用。本文介绍在Emacs下配置C/C++编程环境。</p>

<!--more-->

<h2 id="section">1. 安装和基本配置</h2>

<h3 id="section-1">1.1. 安装需求</h3>

<ul>
  <li>安装<a href="http://www.gnu.org/software/global/">GNU Global</a></li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># yum install global</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>安装Emacs的<code>helm</code>、<code>helm-swoop</code>、<code>helm-gtags</code>、<code>sr-speedbar</code>、<code>smartparens</code>、<code>google-c-style</code>、<code>auto-complete</code>、<code>auto-complete-c-headers</code>、<code>auto-complete-clang</code>包。</li>
</ul>

<h3 id="emacs">1.2. Emacs配置</h3>

<p>将<a href="#c-mode-config">附加环境设置</a>添加到Emacs设置文件，比如<code class="language-bash">~/.emacs</code>，此环境配置参考<a href="https://github.com/tuhdo/emacs-c-ide-demo/blob/master/custom/setup-helm.el">tuhdo</a>。</p>

<h2 id="section-2">2. 文件操作</h2>

<h3 id="section-3">2.1. 查找</h3>

<ul>
  <li>当前buffer查找函数、类的定义</li>
</ul>

<blockquote>
  <p><code>C-c h i</code>（helm-semantic-or-imenu）：可以输入部分关键词、空格等，以快速搜索。</p>
</blockquote>

<ul>
  <li>当前project查找定义</li>
</ul>

<blockquote>
  <ol>
    <li>
      <p><code>M-.</code>（helm-gtags-dwim）：输入查找内容。<code>M-,</code>（tags-loop-continue）：返回上一个buffer。</p>
    </li>
    <li>
      <p><code>C-j</code>（helm-gtags-select）：列出当前project所有定义，并且查找。</p>
    </li>
  </ol>
</blockquote>

<ul>
  <li>查找引用</li>
</ul>

<blockquote>
  <ol>
    <li>
      <p><code>C-c g r</code>（helm-gtags-find-rtags）：光标停留在函数内部，查找该函数名；如果光标停留在函数名，查找该函数的所有引用。</p>
    </li>
    <li>
      <p><code>C-c g s</code>（helm-gtags-find-symbol）：光标停留在变量时的查找。</p>
    </li>
  </ol>
</blockquote>

<ul>
  <li>查找当前函数引用的函数</li>
</ul>

<blockquote>
  <p><code>C-c g a</code>（helm-gtags-tags-in-this-function）</p>
</blockquote>

<ul>
  <li>查找文件</li>
</ul>

<blockquote>
  <p><code>C-c g P</code>（elm-gtags-find-files）</p>
</blockquote>

<h3 id="section-4">2.2. 列出源码树</h3>

<ul>
  <li>开启和关闭</li>
</ul>

<blockquote>
  <p><code>M-x sr-speedbar-open RET</code>：开启。<code>M-x sr-speedbar-close RET</code>：关闭。</p>
</blockquote>

<ul>
  <li>操作</li>
</ul>

<blockquote>
  <ol>
    <li>
      <p><code>b</code>和<code>f</code>切换到当前buffer和所有文件列表。</p>
    </li>
    <li>
      <p><code>=</code>：展开。<code>g</code>：收回。</p>
    </li>
    <li>
      <p><code>U</code>：上一级目录。</p>
    </li>
  </ol>
</blockquote>

<h3 id="section-5">2.3 代码补全</h3>

<p>代码补全使用<code>auto-complete</code>、<code>auto-complete-c-headers</code>、<code>semantic</code>包。在使用<code>auto-complete-c-headers</code>自动补全头文件名称时，使用以下命令获得头文件路径：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>gcc -xc -E -v -
</span><span class="line"><span class="nv">$ </span>gcc -xc++ -E -v -
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="http://yulongniu.github.io/images/emacs_config_c_autocomplete.png" width="900" height="900" title="image" alt="images" /></p>

<h2 id="debug">3. 编译和debug</h2>

<h3 id="gcc">3.1 使用gcc编译</h3>

<p>使用<code>M-x compile</code>对源文件进行编译链接；或者开启ansi-term模式<code>M-x ansi-term</code>，进入shell操作。一个直接编译–汇编–链接的简单例子：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>gcc helloworld.c -o helloworld
</span><span class="line"><span class="nv">$ </span>./helloworld
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-6">附加内容</h2>

<p><a id="c-mode-config">C/C++的Emacs编程环境设置</a></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Emacs configure </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
<span class="line-number">141</span>
<span class="line-number">142</span>
<span class="line-number">143</span>
<span class="line-number">144</span>
<span class="line-number">145</span>
<span class="line-number">146</span>
<span class="line-number">147</span>
<span class="line-number">148</span>
<span class="line-number">149</span>
<span class="line-number">150</span>
<span class="line-number">151</span>
<span class="line-number">152</span>
<span class="line-number">153</span>
<span class="line-number">154</span>
<span class="line-number">155</span>
<span class="line-number">156</span>
<span class="line-number">157</span>
<span class="line-number">158</span>
<span class="line-number">159</span>
<span class="line-number">160</span>
<span class="line-number">161</span>
<span class="line-number">162</span>
<span class="line-number">163</span>
<span class="line-number">164</span>
<span class="line-number">165</span>
<span class="line-number">166</span>
<span class="line-number">167</span>
<span class="line-number">168</span>
<span class="line-number">169</span>
<span class="line-number">170</span>
<span class="line-number">171</span>
<span class="line-number">172</span>
<span class="line-number">173</span>
<span class="line-number">174</span>
<span class="line-number">175</span>
<span class="line-number">176</span>
<span class="line-number">177</span>
<span class="line-number">178</span>
<span class="line-number">179</span>
<span class="line-number">180</span>
<span class="line-number">181</span>
<span class="line-number">182</span>
<span class="line-number">183</span>
<span class="line-number">184</span>
<span class="line-number">185</span>
<span class="line-number">186</span>
<span class="line-number">187</span>
<span class="line-number">188</span>
<span class="line-number">189</span>
<span class="line-number">190</span>
<span class="line-number">191</span>
<span class="line-number">192</span>
<span class="line-number">193</span>
<span class="line-number">194</span>
<span class="line-number">195</span>
<span class="line-number">196</span>
<span class="line-number">197</span>
<span class="line-number">198</span>
<span class="line-number">199</span>
<span class="line-number">200</span>
<span class="line-number">201</span>
<span class="line-number">202</span>
<span class="line-number">203</span>
<span class="line-number">204</span>
<span class="line-number">205</span>
<span class="line-number">206</span>
<span class="line-number">207</span>
<span class="line-number">208</span>
<span class="line-number">209</span>
<span class="line-number">210</span>
<span class="line-number">211</span>
<span class="line-number">212</span>
<span class="line-number">213</span>
</pre></td><td class="code"><pre><code class="emacs-lisp"><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="c1">;set up helm</span>
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;helm-config</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;helm-grep</span><span class="p">)</span>
</span><span class="line"><span class="c1">;; The default &quot;C-x c&quot; is quite close to &quot;C-x C-c&quot;, which quits Emacs.</span>
</span><span class="line"><span class="c1">;; Changed to &quot;C-c h&quot;. Note: We must set &quot;C-c h&quot; globally, because we</span>
</span><span class="line"><span class="c1">;; cannot change `helm-command-prefix-key&#39; once `helm-config&#39; is loaded.</span>
</span><span class="line"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c h&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-command-prefix</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">global-unset-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-x c&quot;</span><span class="p">))</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">helm-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;&lt;tab&gt;&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-execute-persistent-action</span><span class="p">)</span> <span class="c1">; rebihnd tab to do persistent action</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">helm-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-i&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-execute-persistent-action</span><span class="p">)</span> <span class="c1">; make TAB works in terminal</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">helm-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-z&quot;</span><span class="p">)</span>  <span class="ss">&#39;helm-select-action</span><span class="p">)</span> <span class="c1">; list actions using C-z</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">helm-grep-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;&lt;return&gt;&quot;</span><span class="p">)</span>  <span class="ss">&#39;helm-grep-mode-jump-other-window</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">helm-grep-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;n&quot;</span><span class="p">)</span>  <span class="ss">&#39;helm-grep-mode-jump-other-window-forward</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">helm-grep-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;p&quot;</span><span class="p">)</span>  <span class="ss">&#39;helm-grep-mode-jump-other-window-backward</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">&quot;curl&quot;</span><span class="p">)</span>
</span><span class="line">  <span class="p">(</span><span class="k">setq</span> <span class="nv">helm-google-suggest-use-curl-p</span> <span class="no">t</span><span class="p">))</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="k">setq</span>
</span><span class="line"> <span class="nv">helm-scroll-amount</span> <span class="mi">4</span> <span class="c1">; scroll 4 lines other window using M-&lt;next&gt;/M-&lt;prior&gt;</span>
</span><span class="line"> <span class="nv">helm-quick-update</span> <span class="no">t</span> <span class="c1">; do not display invisible candidates</span>
</span><span class="line"> <span class="nv">helm-ff-search-library-in-sexp</span> <span class="no">t</span> <span class="c1">; search for library in `require&#39; and `declare-function&#39; sexp.</span>
</span><span class="line"> <span class="nv">helm-split-window-in-side-p</span> <span class="no">t</span> <span class="c1">;; open helm buffer inside current window, not occupy whole other window</span>
</span><span class="line"> <span class="nv">helm-candidate-number-limit</span> <span class="mi">500</span> <span class="c1">; limit the number of displayed canidates</span>
</span><span class="line"> <span class="nv">helm-ff-file-name-history-use-recentf</span> <span class="no">t</span>
</span><span class="line"> <span class="nv">helm-move-to-line-cycle-in-source</span> <span class="no">t</span> <span class="c1">; move to end or beginning of source when reaching top or bottom of source.</span>
</span><span class="line"> <span class="nv">helm-buffers-fuzzy-matching</span> <span class="no">t</span>          <span class="c1">; fuzzy matching buffer names when non-nil</span>
</span><span class="line">                                        <span class="c1">; useful in helm-mini that lists buffers</span>
</span><span class="line">
</span><span class="line"> <span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;helm-sources-using-default-as-input</span> <span class="ss">&#39;helm-source-man-pages</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-x&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-M-x</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-y&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-show-kill-ring</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-x b&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-mini</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-x C-f&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-find-files</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-h SPC&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-all-mark-rings</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c h o&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-occur</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c h C-c w&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-wikipedia-suggest</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c h x&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-register</span><span class="p">)</span>
</span><span class="line"><span class="c1">;; (global-set-key (kbd &quot;C-x r j&quot;) &#39;jump-to-register)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="ss">&#39;help-command</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-f&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-apropos</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="ss">&#39;help-command</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-info-emacs</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="ss">&#39;help-command</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-l&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-locate-library</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;; use helm to list eshell history</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;eshell-mode-hook</span>
</span><span class="line">          <span class="nf">#&#39;</span><span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
</span><span class="line">              <span class="p">(</span><span class="nv">define-key</span> <span class="nv">eshell-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-l&quot;</span><span class="p">)</span>  <span class="ss">&#39;helm-eshell-history</span><span class="p">)))</span>
</span><span class="line">
</span><span class="line"><span class="c1">;;; Save current position to mark ring</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;helm-goto-line-before-hook</span> <span class="ss">&#39;helm-save-current-pos-to-mark-ring</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;; show minibuffer history with Helm</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">minibuffer-local-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-p&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-minibuffer-history</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">minibuffer-local-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-n&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-minibuffer-history</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">global-map</span> <span class="nv">[remap</span> <span class="nv">find-tag]</span> <span class="ss">&#39;helm-etags-select</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">global-map</span> <span class="nv">[remap</span> <span class="nv">list-buffers]</span> <span class="ss">&#39;helm-buffers-list</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="c1">;; PACKAGE: helm-swoop                ;;</span>
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="c1">;; Locate the helm-swoop folder to your path</span>
</span><span class="line"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;helm-swoop</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;; Change the keybinds to whatever you like :)</span>
</span><span class="line"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c h o&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-swoop</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c s&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-multi-swoop-all</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;; When doing isearch, hand the word over to helm-swoop</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">isearch-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-i&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-swoop-from-isearch</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;; From helm-swoop to helm-multi-swoop-all</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">helm-swoop-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-i&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-multi-swoop-all-from-helm-swoop</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;; Save buffer when helm-multi-swoop-edit complete</span>
</span><span class="line"><span class="p">(</span><span class="k">setq</span> <span class="nv">helm-multi-swoop-edit-save</span> <span class="no">t</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;; If this value is t, split window inside the current window</span>
</span><span class="line"><span class="p">(</span><span class="k">setq</span> <span class="nv">helm-swoop-split-with-multiple-windows</span> <span class="no">t</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;; Split direcion. &#39;split-window-vertically or &#39;split-window-horizontally</span>
</span><span class="line"><span class="p">(</span><span class="k">setq</span> <span class="nv">helm-swoop-split-direction</span> <span class="ss">&#39;split-window-vertically</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;; If nil, you can slightly boost invoke speed in exchange for text color</span>
</span><span class="line"><span class="p">(</span><span class="k">setq</span> <span class="nv">helm-swoop-speed-or-color</span> <span class="no">t</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">helm-mode</span> <span class="mi">1</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;setup-helm</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;setup-helm</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="k">setq</span>
</span><span class="line"> <span class="nv">helm-gtags-ignore-case</span> <span class="no">t</span>
</span><span class="line"> <span class="nv">helm-gtags-auto-update</span> <span class="no">t</span>
</span><span class="line"> <span class="nv">helm-gtags-use-input-at-cursor</span> <span class="no">t</span>
</span><span class="line"> <span class="nv">helm-gtags-pulse-at-cursor</span> <span class="no">t</span>
</span><span class="line"> <span class="nv">helm-gtags-prefix-key</span> <span class="s">&quot;\C-cg&quot;</span>
</span><span class="line"> <span class="nv">helm-gtags-suggested-key-mapping</span> <span class="no">t</span>
</span><span class="line"> <span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;helm-gtags</span><span class="p">)</span>
</span><span class="line"><span class="c1">;; Enable helm-gtags-mode</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;dired-mode-hook</span> <span class="ss">&#39;helm-gtags-mode</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;eshell-mode-hook</span> <span class="ss">&#39;helm-gtags-mode</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;c-mode-hook</span> <span class="ss">&#39;helm-gtags-mode</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;c++-mode-hook</span> <span class="ss">&#39;helm-gtags-mode</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;asm-mode-hook</span> <span class="ss">&#39;helm-gtags-mode</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">helm-gtags-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c g a&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-gtags-tags-in-this-function</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">helm-gtags-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-j&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-gtags-select</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">helm-gtags-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-.&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-gtags-dwim</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">helm-gtags-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;M-,&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-gtags-pop-stack</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">helm-gtags-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c &lt;&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-gtags-previous-history</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">helm-gtags-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;C-c &gt;&quot;</span><span class="p">)</span> <span class="ss">&#39;helm-gtags-next-history</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="c1">;enable semantic mode</span>
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;cc-mode</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;semantic</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">global-semanticdb-minor-mode</span> <span class="mi">1</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">global-semantic-idle-scheduler-mode</span> <span class="mi">1</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">global-semantic-idle-summary-mode</span> <span class="mi">1</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">global-semantic-stickyfunc-mode</span> <span class="mi">1</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">semantic-mode</span> <span class="mi">1</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="c1">;open hs-mode</span>
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;c-mode-common-hook</span>   <span class="ss">&#39;hs-minor-mode</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="c1">;google-c-style</span>
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;c-mode-common-hook</span> <span class="ss">&#39;google-set-c-style</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;c-mode-common-hook</span> <span class="ss">&#39;google-make-newline-indent</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="c1">;smartparens</span>
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;smartparens-config</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">show-smartparens-global-mode</span> <span class="no">t</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">smartparens-global-mode</span> <span class="no">t</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="c1">; auto-complete</span>
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;auto-complete</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;auto-complete-config</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">ac-config-default</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="c1">;; auto-complete-c-headers </span>
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my:ac-c-header-init</span><span class="p">()</span>
</span><span class="line">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;auto-complete-c-headers</span><span class="p">)</span>
</span><span class="line">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;ac-sources</span> <span class="ss">&#39;ac-source-c-headers</span><span class="p">)</span>
</span><span class="line">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;achead:include-directories</span> <span class="o">&#39;</span><span class="s">&quot;/usr/lib/gcc/x86_64-redhat-linux/4.9.2/../../../../include/c++/4.9.2&quot;</span><span class="p">)</span>
</span><span class="line">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;achead:include-directories</span> <span class="o">&#39;</span><span class="s">&quot;/usr/lib/gcc/x86_64-redhat-linux/4.9.2/../../../../include/c++/4.9.2/x86_64-redhat-linux&quot;</span><span class="p">)</span>
</span><span class="line">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;achead:include-directories</span> <span class="o">&#39;</span><span class="s">&quot;/usr/lib/gcc/x86_64-redhat-linux/4.9.2/../../../../include/c++/4.9.2/backward&quot;</span><span class="p">)</span>
</span><span class="line">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;achead:include-directories</span> <span class="o">&#39;</span><span class="s">&quot;/usr/lib/gcc/x86_64-redhat-linux/4.9.2/include&quot;</span><span class="p">)</span>
</span><span class="line">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;achead:include-directories</span> <span class="o">&#39;</span><span class="s">&quot;/usr/local/include&quot;</span><span class="p">)</span>
</span><span class="line">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;achead:include-directories</span> <span class="o">&#39;</span><span class="s">&quot;/usr/include&quot;</span><span class="p">)</span>
</span><span class="line">  <span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;c++-mode-hook</span> <span class="ss">&#39;my:ac-c-header-init</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;c-mode-hook</span> <span class="ss">&#39;my:ac-c-header-init</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="c1">;; auto-complete-clang </span>
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;auto-complete-clang</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="k">setq</span> <span class="nv">ac-auto-start</span> <span class="no">t</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="k">setq</span> <span class="nv">ac-quick-help-delay</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span class="line"><span class="c1">;; (ac-set-trigger-key &quot;TAB&quot;)</span>
</span><span class="line"><span class="c1">;; (define-key ac-mode-map  [(control tab)] &#39;auto-complete)</span>
</span><span class="line"><span class="p">(</span><span class="nv">define-key</span> <span class="nv">ac-mode-map</span>  <span class="nv">[</span><span class="p">(</span><span class="nv">control</span> <span class="nv">tab</span><span class="p">)</span><span class="nv">]</span> <span class="ss">&#39;auto-complete</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-ac-config</span> <span class="p">()</span>
</span><span class="line">  <span class="p">(</span><span class="k">setq</span> <span class="nv">ac-clang-flags</span>
</span><span class="line">	<span class="p">(</span><span class="nb">mapcar</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">item</span><span class="p">)(</span><span class="nv">concat</span> <span class="s">&quot;-I&quot;</span> <span class="nv">item</span><span class="p">))</span>
</span><span class="line">	       <span class="p">(</span><span class="nv">split-string</span>
</span><span class="line">		<span class="s">&quot;</span>
</span><span class="line"><span class="s">/usr/lib/gcc/x86_64-redhat-linux/4.9.2/../../../../include/c++/4.9.2</span>
</span><span class="line"><span class="s">/usr/lib/gcc/x86_64-redhat-linux/4.9.2/../../../../include/c++/4.9.2/x86_64-redhat-linux</span>
</span><span class="line"><span class="s">/usr/lib/gcc/x86_64-redhat-linux/4.9.2/../../../../include/c++/4.9.2/backward</span>
</span><span class="line"><span class="s">/usr/lib/gcc/x86_64-redhat-linux/4.9.2/include</span>
</span><span class="line"><span class="s">/usr/local/include</span>
</span><span class="line"><span class="s">/usr/include&quot;</span>
</span><span class="line">		<span class="p">)))</span>
</span><span class="line">  <span class="p">(</span><span class="nv">setq-default</span> <span class="nv">ac-sources</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">ac-source-abbrev</span> <span class="nv">ac-source-dictionary</span> <span class="nv">ac-source-words-in-same-mode-buffers</span><span class="p">))</span>
</span><span class="line">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;emacs-lisp-mode-hook</span> <span class="ss">&#39;ac-emacs-lisp-mode-setup</span><span class="p">)</span>
</span><span class="line">  <span class="c1">;; (add-hook &#39;c-mode-common-hook &#39;ac-cc-mode-setup)</span>
</span><span class="line">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;ruby-mode-hook</span> <span class="ss">&#39;ac-ruby-mode-setup</span><span class="p">)</span>
</span><span class="line">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;css-mode-hook</span> <span class="ss">&#39;ac-css-mode-setup</span><span class="p">)</span>
</span><span class="line">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;auto-complete-mode-hook</span> <span class="ss">&#39;ac-common-setup</span><span class="p">)</span>
</span><span class="line">  <span class="p">(</span><span class="nv">global-auto-complete-mode</span> <span class="no">t</span><span class="p">))</span>
</span><span class="line"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-ac-cc-mode-setup</span> <span class="p">()</span>
</span><span class="line">  <span class="p">(</span><span class="k">setq</span> <span class="nv">ac-sources</span> <span class="p">(</span><span class="nb">append</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">ac-source-clang</span> <span class="nv">ac-source-yasnippet</span><span class="p">)</span> <span class="nv">ac-sources</span><span class="p">)))</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;c-mode-common-hook</span> <span class="ss">&#39;my-ac-cc-mode-setup</span><span class="p">)</span>
</span><span class="line"><span class="c1">;; ac-source-gtags</span>
</span><span class="line"><span class="p">(</span><span class="nv">my-ac-config</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-7">参考资料</h3>

<ul>
  <li>
    <p><a href="http://tuhdo.github.io/c-ide.html#sec-1-3">C/C++ Development Environment for Emacs</a></p>
  </li>
  <li>
    <p><a href="https://www.youtube.com/watch?v=HTUE03LnaXA">YouTube Vedio</a></p>
  </li>
</ul>

<h3 id="section-8">更新记录</h3>

<p>2014年12月7日</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[二代测序中的短序列比对]]></title>
    <link href="http://yulongniu.github.io/blog/2014/07/26/short-sequence-alignment/"/>
    <updated>2014-07-26T02:04:25+08:00</updated>
    <id>http://yulongniu.github.io/blog/2014/07/26/short-sequence-alignment</id>
    <content type="html"><![CDATA[<p>在二代测序数据分析中，非常重要的一步是将测得的短序列“对应”到基因组上。所使用的工具被称为“短序列比对工具（short sequence aligners）”。以下是一些常用工具的介绍。</p>

<h2 id="bowtie">1. Bowtie</h2>

<p><strong>简介</strong>：<a href="http://bowtie-bio.sourceforge.net/">Bowtie2</a>是现在广泛使用的序列比对工具。</p>

<p><strong>运行方式</strong>：所有平台</p>

<p><strong>特点</strong>：</p>

<ul>
  <li>
    <p>相比较<a href="http://bowtie-bio.sourceforge.net/index.shtml">Bowtie1</a>，处理大于50bp的短序列，速度更快、也更敏感。Bowtie1在处理小于50bp的短序列上，效果更好。</p>
  </li>
  <li>
    <p><a href="http://support.illumina.com/sequencing/sequencing_software/igenome.ilmn">iGenomes</a>提供一些事先编排（index）的基因组。
<!--more--></p>
  </li>
</ul>

<p><strong>快速运行</strong>：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 建立一系列FASTA文件目录</span>
</span><span class="line"><span class="nv">$ </span>bowtie2-build /filePath/genomeFastaFile indexName
</span><span class="line">
</span><span class="line"><span class="c"># 从已经index文件中提取原始基因组</span>
</span><span class="line"><span class="nv">$ </span>bowtie2-inspect indexName &gt; genomeFastaFile
</span><span class="line">
</span><span class="line"><span class="c"># unpaired序列比对</span>
</span><span class="line"><span class="nv">$ </span>bowtie2 -p <span class="m">4</span> -x indexName -U readFiles -S samFileName
</span><span class="line">
</span><span class="line"><span class="c"># paired序列比对</span>
</span><span class="line"><span class="nv">$ </span>bowtie2 -p <span class="m">4</span> -x indexName  -1 readFiles1 -2 readFiles2 -S eg2.sam
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>
    <p><code>-p</code>：多线程</p>
  </li>
  <li>
    <p><code>-x</code>：之后跟index名称</p>
  </li>
  <li>
    <p><code>-U</code>：测序文件（比如Fasta，Fastq文件）</p>
  </li>
  <li>
    <p><code>-1</code>/<code>-2</code>：标识paired文件</p>
  </li>
  <li>
    <p><code>-S</code>：SAM格式输出文件</p>
  </li>
</ul>

<h3 id="section">参考网址</h3>

<ul>
  <li><a href="http://lh3lh3.users.sourceforge.net/NGSalign.shtml">Heng Li总结的工具列表</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress安装和使用]]></title>
    <link href="http://yulongniu.github.io/blog/2014/07/23/octopress-install/"/>
    <updated>2014-07-23T01:45:46+08:00</updated>
    <id>http://yulongniu.github.io/blog/2014/07/23/octopress-install</id>
    <content type="html"><![CDATA[<p>安装和使用Octopress的一些注意事项，详细的内容可以<a href="#Ref">参考网址</a>。</p>

<h2 id="section">1. 安装</h2>

<p>请参考<a href="http://octopress.org/">官网</a>，其他的博客介绍的安装已经失效或者错误。</p>

<p>常用命令:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 预览，可自动更新。使用Ctrl+c终止。</span>
</span><span class="line"><span class="nv">$ </span>rake preview
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="ruby">2. Ruby版本调整</h2>

<p>因为Octopress需要使用Ruby旧版本，推荐使用<a href="https://rvm.io/">RVM</a>安装Ruby 1.9.3版本。在安转过程中可能会出现<code>"gpg: Can't check signature: public key not found"</code>的错误提示，需要执行一下类似命名，添加公用匙。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>gpg2 --keyserver hkp://keys.gnupg.net --recv-keys D39DC0E3
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>使用以下操作设定ruby版本：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span><span class="nb">source</span> ~/.rvm/scripts/rvm
</span><span class="line"><span class="nv">$ </span>rvm use 1.9.3
</span></code></pre></td></tr></table></div></figure></notextile></div>
<!--more-->

<h2 id="section-1">3. 预览错误</h2>

<p>如果在预览博文时出现<code class="language-bash">TCPServer Error: Address already in use - bind(2)</code>的错误，表示端口（Octopress默认4000）被占，解决办法:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 获取占据4000端口程序的PID</span>
</span><span class="line"><span class="nv">$ </span>lsof -wni tcp:4000
</span><span class="line"><span class="nv">$ </span><span class="nb">kill</span> -9 PID
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-2">4. 更新博文</h2>

<p>博文放置在<code class="language-bash">source/_posts</code>目录下。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>rake new_post<span class="o">[</span><span class="s2">&quot;new post&quot;</span><span class="o">]</span>
</span><span class="line"><span class="nv">$ </span>git add .
</span><span class="line"><span class="nv">$ </span>git commit -m <span class="s2">&quot;my comment&quot;</span>
</span><span class="line"><span class="nv">$ </span>git push origin <span class="nb">source</span>
</span><span class="line"><span class="nv">$ </span>rake generate
</span><span class="line"><span class="nv">$ </span>rake deploy
</span><span class="line">
</span><span class="line"><span class="c"># 或者generate和deploy一步执行</span>
</span><span class="line"><span class="nv">$ </span>rake gen_deploy
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>如果需要在首页显示部分博文，在需要隔断的地方（博文markdown文件）加入：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="c">&lt;!--more--&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-3">5. 使用主题</h2>

<p>当前博客使用的是<a href="http://kaworu.github.io/octopress/">octostrap</a>主题。</p>

<ul>
  <li>
    <p><a href="http://kaworu.github.io/octostrap3/blog/2013/10/03/category-list-aside/">添加Category侧边栏</a></p>
  </li>
  <li>
    <p><a href="http://kaworu.github.io/octostrap3/blog/2013/10/02/pick-a-theme-for-only-one-page/">每个页面更换主题</a></p>
  </li>
  <li>
    <p><a href="http://kaworu.github.io/octostrap3/setup/pick-a-theme/">选择Bootstrap主题</a></p>
  </li>
</ul>

<h2 id="section-4">6. 修改标签图标记</h2>

<p>可以使用<a href="http://converticon.com/">在线转换工具</a>，将png格式图片转换为ico格式（比如32*32），例如文件<code>favicon.ico</code>。之后，将<code>favicon.ico</code>移动到<code class="language-bash">source/</code>目录下。之后修改文件<code class="language-bash">source/_includes/head.html</code>，找到<code>favicon.png</code>将其改为<code>favicon.ico</code>。</p>

<h2 id="section-5">7. 404公益</h2>

<p>在<code class="language-bash">source</code>文件夹下添加<em>404.markdown</em>文件，之后写入</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">---</span>
</span><span class="line"><span class="nx">layout</span><span class="o">:</span> <span class="nx">page</span>
</span><span class="line"><span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;404 Error&quot;</span>
</span><span class="line"><span class="nx">date</span><span class="o">:</span> <span class="mi">2014</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">22</span>
</span><span class="line"><span class="nx">comments</span><span class="o">:</span> <span class="kc">false</span>
</span><span class="line"><span class="nx">sharing</span><span class="o">:</span> <span class="kc">false</span>
</span><span class="line"><span class="nx">footer</span><span class="o">:</span> <span class="kc">false</span>
</span><span class="line"><span class="o">---</span>
</span><span class="line">
</span><span class="line"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;http://www.qq.com/404/search_children.js?edition=small&quot;</span> <span class="nx">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-6">8. 私密博文</h2>

<p>Octopress提供了隐藏博文的功能，即使文章已经推送到了github，也可以不在博客主页显示。具体方法是在每篇markdown文件头部添加：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="ss">published</span><span class="p">:</span> <span class="kp">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>如果需要公开发表，将其删除或者改为：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="ss">published</span><span class="p">:</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-7">9. 代码高亮设置</h2>

<p>安装<code>coderay</code>和<code>kramdown</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>gem install coderay
</span><span class="line"><span class="nv">$ </span>gem install kramdown
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>在<code class="language-bash">_config.yml</code>文件中写入：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">markdown: kramdown
</span><span class="line">kramdown:
</span><span class="line">  use_coderay: <span class="nb">true</span>
</span><span class="line"><span class="nb">  </span>coderay:
</span><span class="line">    coderay_line_numbers: table
</span><span class="line">    coderay_css: class
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="kramdown">10. Kramdown语法小技巧</h2>

<ul>
  <li>代码高亮</li>
</ul>

<p>代码段高亮参考<a href="http://octopress.org/docs/plugins/codeblock/">Octopress codeblock</a>，其中<code>[lang:language]</code>设置高亮语言种类。<code>[url]</code>和<code>[linktext]</code>非必须。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">{% codeblock [lang:language] [title] [url] [link text] %}
</span><span class="line">code snippet
</span><span class="line">{% endcodeblock %}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>行内引用代码使用
<code>`source/_includes/custom/head.html`{:.language-bash}</code></p>

<ul>
  <li>四个空格或者一个Tab可以生成一个文本块</li>
</ul>

<h2 id="section-8">11. 链接在新的选择卡中打开</h2>

<p>在<code class="language-bash">source/_includes/custom/head.html</code>的末尾添加：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="c">&lt;!-- link open with new tab  --&gt;</span>
</span><span class="line"><span class="nt">&lt;script&gt;</span>
</span><span class="line">  <span class="kd">function</span> <span class="nx">addBlankTargetForLinks</span> <span class="p">()</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a[href^=&quot;http&quot;]&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class="line">  <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;_blank&#39;</span><span class="p">);</span>
</span><span class="line">  <span class="p">});</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line">
</span><span class="line">  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;DOMNodeInserted&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">addBlankTargetForLinks</span><span class="p">();</span>
</span><span class="line">  <span class="p">});</span>
</span><span class="line"><span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-9">12. 修改分页数</h2>

<p>修改<code class="language-bash">_config.yml</code>文件</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 每页最多展示的博文数目</span>
</span><span class="line">paginate: 5
</span><span class="line">
</span><span class="line"><span class="c"># 分页后博文地址</span>
</span><span class="line">paginate_path: <span class="s2">&quot;posts/:num&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-10">13. 添加图片</h2>

<p>将需要添加的图片移动到目录<code class="language-bash">source/images/</code>，之后在正文中添加：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">&lt;img <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;[class names]&quot;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;/path/to/image&quot;</span> <span class="nv">title</span><span class="o">=</span><span class="s2">&quot;[width] [height] [title text [alt text]]&quot;</span> &gt;
</span><span class="line">
</span><span class="line"><span class="c"># 例子</span>
</span><span class="line">&lt;img <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;left&quot;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;/images/testimg.png&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;350&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;350&quot;</span> <span class="nv">title</span><span class="o">=</span><span class="s2">&quot;image&quot;</span> <span class="nv">alt</span><span class="o">=</span><span class="s2">&quot;images&quot;</span>&gt;
</span><span class="line">&lt;img <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;right&quot;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;http://placekitten.com/300/500&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;150&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;250&quot;</span> <span class="nv">title</span><span class="o">=</span><span class="s2">&quot;Place Kitten #3&quot;</span> &gt;
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-11">14. 添加新页面</h2>

<p>首先，添加新的页面：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">rake new_page<span class="o">[</span>ANewPage<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>这会生成一个新的文件<code class="language-bash">source/anewpage/index.markdown</code>。之后，修改<code class="language-bash">source/_includes/custom/navigation.html</code>文件，根据自己主题，添加如下类似内容</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&lt;li {% if page.navbar == 'ANewPage' %}class="active"{% endif %}&gt;
</span><span class="line">  &lt;a href="{{ root_url }}/anewpage"&gt;ANewPage&lt;/a&gt;
</span><span class="line">&lt;/li&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-12">15. 添加表格</h2>

<p>建立新文件<code>source/stylesheets/data-table.css</code>，写入以下内容，其中<code>#00B9E3</code>是表头的背景颜色，可以更改为自己喜欢的颜色：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>data-table </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
</pre></td><td class="code"><pre><code class="css"><span class="line"><span class="o">*</span> <span class="o">+</span> <span class="nt">table</span> <span class="p">{</span>
</span><span class="line">  <span class="k">border-style</span><span class="o">:</span><span class="k">solid</span><span class="p">;</span>
</span><span class="line">  <span class="k">border-width</span><span class="o">:</span><span class="m">1px</span><span class="p">;</span>
</span><span class="line">  <span class="k">border-color</span><span class="o">:</span><span class="m">#e7e3e7</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="o">*</span> <span class="o">+</span> <span class="nt">table</span> <span class="nt">th</span><span class="o">,</span> <span class="o">*</span> <span class="o">+</span> <span class="nt">table</span> <span class="nt">td</span> <span class="p">{</span>
</span><span class="line">  <span class="k">border-style</span><span class="o">:</span><span class="k">dashed</span><span class="p">;</span>
</span><span class="line">  <span class="k">border-width</span><span class="o">:</span><span class="m">1px</span><span class="p">;</span>
</span><span class="line">  <span class="k">border-color</span><span class="o">:</span><span class="m">#e7e3e7</span><span class="p">;</span>
</span><span class="line">  <span class="k">padding-left</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
</span><span class="line">  <span class="k">padding-right</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="o">*</span> <span class="o">+</span> <span class="nt">table</span> <span class="nt">th</span> <span class="p">{</span>
</span><span class="line">  <span class="k">border-style</span><span class="o">:</span><span class="k">solid</span><span class="p">;</span>
</span><span class="line">  <span class="k">font-weight</span><span class="o">:</span><span class="k">bold</span><span class="p">;</span>
</span><span class="line">  <span class="k">background</span><span class="o">:</span> <span class="sx">url(&quot;/images/noise.png?1330434582&quot;)</span> <span class="k">repeat</span> <span class="k">scroll</span> <span class="k">left</span> <span class="k">top</span> <span class="m">#00B9E3</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="o">*</span> <span class="o">+</span> <span class="nt">table</span> <span class="nt">th</span><span class="o">[</span><span class="nt">align</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="o">],</span> <span class="o">*</span> <span class="o">+</span> <span class="nt">table</span> <span class="nt">td</span><span class="o">[</span><span class="nt">align</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="o">]</span> <span class="p">{</span>
</span><span class="line">  <span class="k">text-align</span><span class="o">:</span><span class="k">left</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="o">*</span> <span class="o">+</span> <span class="nt">table</span> <span class="nt">th</span><span class="o">[</span><span class="nt">align</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="o">],</span> <span class="o">*</span> <span class="o">+</span> <span class="nt">table</span> <span class="nt">td</span><span class="o">[</span><span class="nt">align</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="o">]</span> <span class="p">{</span>
</span><span class="line">  <span class="k">text-align</span><span class="o">:</span><span class="k">right</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="o">*</span> <span class="o">+</span> <span class="nt">table</span> <span class="nt">th</span><span class="o">[</span><span class="nt">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="o">],</span> <span class="o">*</span> <span class="o">+</span> <span class="nt">table</span> <span class="nt">td</span><span class="o">[</span><span class="nt">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="o">]</span> <span class="p">{</span>
</span><span class="line">  <span class="k">text-align</span><span class="o">:</span><span class="k">center</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>之后，在<code>source/_includes/head.html</code>中修改或者添加：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line">&lt;link href="{{ root_url }}/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css"&gt;
</span><span class="line">{% if page.styles contains 'data-table' %}
</span><span class="line">&lt;link href="{{ root_url }}/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" /&gt;
</span><span class="line">{% endif %}
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>使用方法，在每篇博客头部位置添加<code>styles: [data-table]</code>，之后使用表格样式即可。如果使用Kramdown，表格对其方法如下：</p>

<hr />

<table>
  <thead>
    <tr>
      <th style="text-align: left"><strong>X/Y</strong></th>
      <th style="text-align: center"><strong>1(Presence)</strong></th>
      <th style="text-align: center"><strong>0(Absence)</strong></th>
      <th style="text-align: right"><strong>Sum</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>1(Presence)</strong></td>
      <td style="text-align: center">a</td>
      <td style="text-align: center">b</td>
      <td style="text-align: right">a+b</td>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>0(Absence)</strong></td>
      <td style="text-align: center">c</td>
      <td style="text-align: center">d</td>
      <td style="text-align: right">c+d</td>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Sum</strong></td>
      <td style="text-align: center">a+c</td>
      <td style="text-align: center">b+d</td>
      <td style="text-align: right">n=a+b+c+d</td>
    </tr>
  </tbody>
</table>

<hr />

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class=""><span class="line">|---------------+---------------+--------------+---------|
</span><span class="line">|**X/Y**        |**1(Presence)**|**0(Absence)**|**Sum**  |
</span><span class="line">|:--------------|:-------------:|:------------:|--------:|
</span><span class="line">|**1(Presence)**|a              |b             |a+b      |
</span><span class="line">|---------------|---------------|--------------|---------|
</span><span class="line">|**0(Absence)** |c              |d             |c+d      |
</span><span class="line">|---------------|---------------|--------------|---------|
</span><span class="line">|**Sum**        |a+c            |b+d           |n=a+b+c+d|
</span><span class="line">|---------------|---------------|--------------|---------|</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>如果使用Emacs，可以使用Emacs的<a href="http://orgmode.org/">org模式</a>快速建立和编辑表格。</p>

<h2 id="github">16. 重新克隆github上的博文和设置</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Re-set Octopress on local computer </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 注意切换到指定ruby版本</span>
</span><span class="line"><span class="c"># 克隆source分支到本地</span>
</span><span class="line"><span class="nv">$ </span>git clone -b <span class="nb">source </span>git@github.com:usrname/usrname.github.io.git octopress
</span><span class="line">
</span><span class="line"><span class="c"># 克隆master分支到_deploy文件夹</span>
</span><span class="line"><span class="nv">$ </span><span class="nb">cd </span>octopress
</span><span class="line"><span class="nv">$ </span>git clone git@github.com:usrname/usrname.github.io.git _deploy
</span><span class="line">
</span><span class="line"><span class="c"># 安装bundle</span>
</span><span class="line"><span class="nv">$ </span>gem install bundler
</span><span class="line"><span class="nv">$ </span>bundle install
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-13">17. 多台电脑共同编写博客</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Writing Octopress on more than one computer </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 设定好Octopress，假定Octopress目录为octopress</span>
</span><span class="line"><span class="nv">$ </span><span class="nb">cd </span>octopress
</span><span class="line"><span class="nv">$ </span>git pull origin <span class="nb">source</span>
</span><span class="line"><span class="nv">$ </span><span class="nb">cd</span> ./_deploy
</span><span class="line"><span class="nv">$ </span>git pull origin master
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="a-idrefa"><a id="Ref">参考资料</a></h3>

<ul>
  <li>
    <p>Octopress安装和域名设置：<a href="http://tchen.me/posts/2012-12-16-first-blog.html">1</a>, <a href="http://beyondvincent.com/blog/2013/08/03/108-creating-a-github-blog-using-octopress/">2</a></p>
  </li>
  <li>
    <p>Octopress其他配制：<a href="http://812lcl.com/blog/2013/10/26/octopressce-bian-lan-ji-ping-lun-xi-tong-ding-zhi/">1</a>, <a href="http://cn.soulmachine.me/blog/20130402/">2</a></p>
  </li>
  <li>
    <p>添加多说：<a href="http://havee.me/internet/2013-02/add-duoshuo-commemt-system-into-octopress.html">1</a>, <a href="http://kaiimeng.cn/my-first-octopress-blog/">2</a>, <a href="http://cn.soulmachine.me/blog/20130402/">3</a></p>
  </li>
  <li>
    <p>添加Mathjax支持：<a href="http://yanping.me/cn/blog/2012/03/10/octopress-with-latex/">1</a>, <a href="http://www.idryman.org/blog/2012/03/10/writing-math-equations-on-octopress/">2</a>, <a href="http://adereth.github.io/blog/2013/11/29/colorful-equations/">Mathjax彩色公式</a></p>
  </li>
  <li>
    <p><a href="http://kramdown.gettalong.org/syntax.html">Kramdown语法</a></p>
  </li>
  <li>
    <p><a href="http://kramdown.gettalong.org/quickref.html">Kramdown演示</a></p>
  </li>
  <li>
    <p><a href="http://i.rexdf.org/blog/2014/09/26/octopressbo-ke-geng-xin-ri-zhi/">pygments错误详细提示</a></p>
  </li>
  <li>
    <p><a href="http://pygments.org/docs/lexers/">Octopress highlight language list</a></p>
  </li>
  <li>
    <p>标记Octopress自身语法：<a href="http://stackoverflow.com/questions/15786144/how-to-escape-in-markdown-on-octopress">1</a>，<a href="http://stackoverflow.com/questions/3426182/how-to-escape-liquid-template-tags/13582517#13582517">2</a></p>
  </li>
  <li>
    <p><a href="http://programus.github.io/blog/2012/03/07/add-table-data-css-for-octopress/">Octopress添加表格</a></p>
  </li>
  <li>
    <p><a href="http://blog.csdn.net/hankai1024/article/details/12786201">Octopress重装或者多台电脑上并行写作同步</a>和<a href="http://boboshone.com/blog/2013/06/05/write-octopress-blog-on-multiple-machines/">在多台电脑上写Octopress博客</a></p>
  </li>
</ul>

<h3 id="section-14">更新记录</h3>

<p>2015年6月28日</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My First Post]]></title>
    <link href="http://yulongniu.github.io/blog/2014/07/05/my-first-post/"/>
    <updated>2014-07-05T10:04:38+08:00</updated>
    <id>http://yulongniu.github.io/blog/2014/07/05/my-first-post</id>
    <content type="html"><![CDATA[<p>This is my first post. I want to say something. Then say something.</p>

<p>This is a piece of html code <code class="language-html">&lt;html&gt;</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">def</span> <span class="nf">what?</span>
</span><span class="line">  <span class="mi">42</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<!-- more -->

<ol>
  <li>
    <p>Mathjax supports.</p>

    <script type="math/tex; mode=display">% &lt;![CDATA[
\begin{align*}
   & \phi(x,y) = \phi \left(\sum_{i=1}^n x_ie_i, \sum_{j=1}^n y_je_j \right)
   = \sum_{i=1}^n \sum_{j=1}^n x_i y_j \phi(e_i, e_j) = \\
   & (x_1, \ldots, x_n) \left( \begin{array}{ccc}
   \phi(e_1, e_1) & \cdots & \phi(e_1, e_n) \\
   \vdots & \ddots & \vdots \\
   \phi(e_n, e_1) & \cdots & \phi(e_n, e_n)
 \end{array} \right)
   \left( \begin{array}{c}
   y_1 \\
   \vdots \\
   y_n
 \end{array} \right)
 \end{align*} %]]&gt;</script>
  </li>
  <li>
    <p>Colorful mathjax euqation.</p>

    <script type="math/tex; mode=display">\definecolor{energy}{RGB}{114,0,172}
 \definecolor{freq}{RGB}{45,177,93}
 \definecolor{spin}{RGB}{251,0,29}
 \definecolor{signal}{RGB}{18,110,213}
 \definecolor{circle}{RGB}{217,86,16}
 \definecolor{average}{RGB}{203,23,206}
 \color{energy} X_{\color{freq} k} \color{black} =
 \color{average} \frac{1}{N} \sum_{n=0}^{N-1}
 \color{signal}x_n \color{spin}
 e^{\mathrm{i} \color{circle} 2\pi \color{freq}k
 \color{average} \frac{n}{N}}</script>

    <p>To find <font color="#7200AC">the energy</font></p>
    <font color="2DB15D">at a particular frequency</font>
    <p>,</p>
    <font color="#FB001D">spin</font>
    <font color="#126ED5">your
 signal</font>
    <font color="#D04400">around a circle</font>
    <font color="2DB15D">at that frequency</font>
    <p>, and</p>
    <font color="#CB17CE">average a bunch of points along that
 path</font>
    <p>.</p>
  </li>
</ol>

<ul>
  <li>Show the block.</li>
</ul>

<blockquote>
  <p>This is the block</p>
</blockquote>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[R使用parallel包并行计算]]></title>
    <link href="http://yulongniu.github.io/blog/2014/06/25/parallel-package/"/>
    <updated>2014-06-25T10:10:20+08:00</updated>
    <id>http://yulongniu.github.io/blog/2014/06/25/parallel-package</id>
    <content type="html"><![CDATA[<p>最新版本的R已经内置<span style="color: blue">parallel</span>包，<span style="color: blue">parallel</span>包是从<span style="color: blue"><a href="http://cran.r-project.org/web/packages/snow/index.html">snow</a></span>包和<span style="color: blue"><a href="http://cran.r-project.org/web/packages/multicore/index.html">multicore</a></span>包继承而来，包含了很多非常好用的函数。<span style="color: blue">parallel</span>包可以通过PVM（<span style="color: blue">rpvm</span>包）、MPI（<span style="color: blue"><a href="http://cran.r-project.org/web/packages/Rmpi/index.html">Rmpi</a></span>包）、NetWorkSpaces（<span style="color: blue"><a href="http://cran.r-project.org/web/packages/nws/index.html">nws</a></span>包）和raw sockets（如果以上3种都不能使用）平台进行分布计算，支持cluster和多核个人/服务器计算机。在Linux系统上，通常使用<a href="http://www.open-mpi.org/">openMPI</a>。</p>

<h2 id="span-stylecolor-bluermpispan">1. 安装<span style="color: blue">Rmpi</span>包</h2>

<p>因为使用openMPI，所以<span style="color: blue">parallel</span>包需要<span style="color: blue">Rmpi</span>包来设定节点，所以首先需要在计算机上安装openMPI。</p>

<!--more-->

<h3 id="linuxopenmpi">1.1 Linux系统下安装openMPI环境</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 安装openmpi环境</span>
</span><span class="line"><span class="c"># yum install openmpi openmpi-devel</span>
</span><span class="line">
</span><span class="line"><span class="c"># 配置环境（安装时执行，可能之后运行也要执行）</span>
</span><span class="line"><span class="c"># ldconfig /usr/lib64/openmpi/lib/</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>在<code class="language-bash">~/.bashrc</code>下写入</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">
</span><span class="line"><span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;${LD_LIBRARY_PATH}${LD_LIBRARY_PATH:+:}/usr/lib64/openmpi/lib/&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>载入<code class="language-bash">~/.bashrc</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">
</span><span class="line"><span class="nv">$ </span><span class="nb">source</span> ~/.bashrc
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="rmpi">1.2 安装Rmpi包</h3>

<p>在启动的R窗口中输入：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">install.packages<span class="p">(</span><span class="s">&quot;Rmpi&quot;</span><span class="p">,</span>
</span><span class="line">                 configure.args <span class="o">=</span>
</span><span class="line">                 <span class="kt">c</span><span class="p">(</span><span class="s">&quot;--with-Rmpi-include=/usr/include/openmpi-x86_64/&quot;</span><span class="p">,</span>
</span><span class="line">                   <span class="s">&quot;--with-Rmpi-libpath=/usr/lib64/openmpi/lib/&quot;</span><span class="p">,</span>
</span><span class="line">                   <span class="s">&quot;--with-Rmpi-type=OPENMPI&quot;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="span-stylecolor-blueparallelspan">2. 使用<span style="color: blue">parallel</span>包</h2>

<h3 id="section">2.1 设定节点数</h3>

<p>首先，需要设定cluster的节点（nodes）数目</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">cl <span class="o">&lt;-</span> makeCluster<span class="p">(</span><span class="m">2</span><span class="p">,</span> type <span class="o">=</span> <span class="s">&quot;MPI&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>这里对“节点数”设定做一些解释，如果使用cluster，可以直接设定cluster数据即可；如果是在小型服务器或者个人电脑上使用，最大节点数可以设定为“线程数（processor）-1”。比如一个双核四线程计算机，节点数目最大可以设定为3。这是因为<span style="color: blue">snow</span>包（<span style="color: blue">parallel</span>包的主要依赖包）在设计时，总是要保留一个<strong>“主线程”</strong>来处理和整合数据。</p>

<p>在linux系统下，线程数可以通过 <code class="language-bash">$ nproc</code> 查看。</p>

<h3 id="section-1">2.2 内置函数</h3>

<p>使用<span style="color: blue">parallel</span>包中的内置并行运算函数
比如使用<code class="language-r">parApply()</code>、<code class="language-r">parCapply()</code>、<code class="language-r">parRapply()</code>、<code class="language-r">parLapply()</code>和<code class="language-r">parSapply()</code>（如果返回矩阵，使用
<code class="language-r">cbind()</code>）等函数。其中文档中指出，<code class="language-r">parApply()</code>函数对于<strong>二维矩阵</strong>的每一个单元进行操作，因此要慢一些。如果可能，使用<code class="language-r">parCapply()</code>和<code class="language-r">parRapply()</code>对列和行进行操作，以加快运行速度。</p>

<h3 id="section-2">2.3 回收节点</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">stopCluster<span class="p">(</span>cl<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-3">3. 并行计算的包依赖问题</h3>

<p>在并行计算过程中，不可避免地会用到其他包辅助。这里涉及到<span style="color: blue">snow</span>包的一个设计原理：并行运算多个R进程，只有一个主进程载入完整的依赖包环境。这就意味着其他并行的R进程中也要载入依赖的包环境。</p>

<p>有两个思路，第一个思路是修改<code class="language-bash">Rprofile.site</code>文件，让任意R进程在启动时都载入依赖的包。但是，不推荐这种做法，因为这样会增加R载入的速度；并且如果不同的代码用了不同的依赖包，就要不停地修改<code class="language-bash">Rprofile.site</code>文件。</p>

<p>第二个思路是在新开的R进程中“动态”加载需要的包。所谓<strong>“动态”</strong>，没有什么高深的意思，就是“需要的时候加载即可”。根据需要，可以选择以下两种方法。</p>

<ul>
  <li>第一种方法是在直接在启动的R进程中加载包。</li>
</ul>

<p>这种方法非常直观，推荐。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1"># 以下代码摘抄自Parallel R，其中packages</span>
</span><span class="line"><span class="c1"># 是一个要选择加载的package列表，</span>
</span><span class="line"><span class="c1"># 比如c(&#39;bigmemory&#39;, &#39;foreach&#39;, &#39;doMC&#39;)</span>
</span><span class="line">worker.init <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>packages<span class="p">)</span> <span class="p">{</span>
</span><span class="line">  <span class="kr">for</span> <span class="p">(</span>p <span class="kr">in</span> packages<span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="kn">library</span><span class="p">(</span>p<span class="p">,</span> character.only<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line">  <span class="kc">NULL</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>第二种方法是在调用函数中加入。</li>
</ul>

<p>这种方法不推荐，因为我们将看到这种方法是“投机”了<span style="color: blue">parallel</span>包的并行<code>apply</code>家族函数。原理是：<span style="color: blue">parallel</span>包中最主要的就是<code>apply</code>家族函数，比如<code class="language-r">parApply(cl = NULL, X, MARGIN, FUN, ...)</code>函数，是<span style="color: blue">base</span>包中<code class="language-r">apply()</code>的并行版本。其中会用到一个<code>FUN</code>函数，我们可以在这个函数中加载包，比如写入<code class="language-r">require('bigmemory')</code>等。这样，并行的R进程就会载入需要的包。举例如下：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">Getft <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>i<span class="p">,</span> arg1<span class="p">,</span> arg2<span class="p">){</span>
</span><span class="line">  <span class="kn">require</span><span class="p">(</span>packages<span class="p">)</span>
</span><span class="line">  <span class="kc">...</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line">adft <span class="o">&lt;-</span> parSapply<span class="p">(</span>cl<span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> Getft<span class="p">,</span> argInput1<span class="p">,</span> argInput2<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="span-stylecolor-bluebigmemoryspan">4. 与<span style="color: blue">bigmemory</span>包结合</h2>

<p><span style="color: blue">parallel</span>包可以很好地与<span style="color: blue">bigmemory</span>包结合，进而进一步提升R操作大数据的能力。</p>

<p>但是，有一个问题是<code class="language-r">parApply()</code>、<code class="language-r">parCapply()</code>、<code class="language-r">parRapply()</code>函数是不能直接调用<span style="color: blue">bigmemory</span>包的<code>big.memory</code>这种S4对象。当然也可以使用<code>mat[, ]</code>之类语句引用big.matrix对象。但是这会把矩阵全部载入内存，也就失去了<code>big.matrix</code>对象的意义，只有在内存允许的情况下这样操作。</p>

<p>解决办法：</p>

<blockquote>
  <ol>
    <li>
      <p>将<code>big.matrix</code>对象的操作放在一个函数中，函数传入的是<code>big.matrix</code>的<code>description file</code>（描述文件），而不是<code>big.matrix</code>对象本身。</p>
    </li>
    <li>
      <p>把这个函数作为<code class="language-r">parLapply()</code>和<code class="language-r">parSapply()</code>的<code>FUN</code>，达到分布计算，而又不直接引用<code>big.matrix</code>对象的目的。</p>
    </li>
    <li>
      <p>这个思路的前提是：创建的<code>big.matrix</code>对象必须是“<strong>内存共享</strong>”的，否则不能将其分布到不同的节点计算。</p>
    </li>
  </ol>
</blockquote>

<p>举一个例子，完整版本见<a href="#final_version">补充材料：Final version</a>，这个例子中首先创建一个<code class="language-r">Getft()</code>函数，接受<code>adAllRowColDesc</code>和<code>adMatDesc</code>两个变量是<code>big.matrix</code>对象的描述文件。在这个函数中，<code class="language-r">attach.big.matrix()</code>通过描述文件引用<code>big.matrix</code>对象，并完成相关操作。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">Getft <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>i<span class="p">,</span> adAllRowColDesc<span class="p">,</span> adMatDesc<span class="p">){</span>
</span><span class="line">  adAllRowColData <span class="o">&lt;-</span> attach.big.matrix<span class="p">(</span>adAllRowColDesc<span class="p">)</span>
</span><span class="line">  adMatData <span class="o">&lt;-</span> attach.big.matrix<span class="p">(</span>adMatDesc<span class="p">)</span>
</span><span class="line">  rowIndex <span class="o">&lt;-</span> adAllRowColData<span class="p">[</span>i<span class="p">,</span> <span class="m">1</span><span class="p">]</span>
</span><span class="line">  colIndex <span class="o">&lt;-</span> adAllRowColData<span class="p">[</span>i<span class="p">,</span> <span class="m">2</span><span class="p">]</span>
</span><span class="line">  linkData <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span>rowNames<span class="p">[</span>rowIndex<span class="p">],</span> rowNames<span class="p">[</span>colIndex<span class="p">],</span> adMatData<span class="p">[</span>rowIndex<span class="p">,</span> colIndex<span class="p">])</span>
</span><span class="line">  <span class="kr">return</span><span class="p">(</span>linkData<span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>之后，使用<code class="language-r">parSapply()</code>函数调用<code class="language-r">Getft()</code>函数，使用<code>1:nrow(adAllRowCol)</code>作为“<strong>计数器</strong>”。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">adft <span class="o">&lt;-</span> parSapply<span class="p">(</span>cl<span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>adAllRowCol<span class="p">),</span> Getft<span class="p">,</span> adAllRowColDescFile<span class="p">,</span> adMatDescFile<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>如果需要处理的<code>big.matrix</code>对象不大，也可以直接使用<code class="language-r">parSapply()</code>函数，详细参考<a href="#bigmatrix_direct">补充材料：Bigmatrix direct version</a>。</p>

<h2 id="span-stylecolor-blueforeachspan">5. 与<span style="color: blue">foreach</span>包比较</h2>

<p>另外一个支持并行计算的包是<span style="color: blue">foreach</span>包，它天生与<code>big.matrix</code>对象匹配。所以，我也提供了使用<code class="language-r">foreach</code>版本，详细参考<a href="#foreach">补充材料：Foreach version</a>。</p>

<p>通过测试可以发现，在数据量较少时（1000行左右），<code class="language-r">foreach</code><a href="#foreach">版本</a>和<code class="language-r">parSapply()</code><a href="#final_version">版本</a>速度基本持平。但是，数据量增大时（百万行），<code class="language-r">foreach</code><a href="#foreach">版本</a>速度明显减慢。原因是在使用<code class="language-r">foreach</code>并行计算时，计算开始时候需要建立索引。这个过程在循环数变大时，会变得非常缓慢。</p>

<p>因此，我们可以看到，如果使用<span style="color: blue">foreach</span>包，会减少代码量，而且程序逻辑也非常清晰，但是遇到超大循环数，速度明显减慢。同时，如果使用<span style="color: blue">parallel</span>包，那么需要一些“技巧”才能与<code>big.matrix</code>对象有效融合。所以，我们的结论是原生态的R（包括提供的一些包）不适合做并行大数据计算。</p>

<h3 id="a-idrefa"><a id="Ref">参考网址</a></h3>

<ul>
  <li>
    <p><a href="http://cran.r-project.org/web/views/HighPerformanceComputing.html">R task: High-Performance and Parallel Computing with R</a></p>
  </li>
  <li>
    <p><a href="http://www.jstatsoft.org/v31/i01/paper">State of the Art in Parallel Computing with R</a>，这篇文章详细介绍了很多R并行计算的平台</p>
  </li>
  <li>
    <p>Rmpi安装：<a href="http://www.stats.uwo.ca/faculty/yu/Rmpi/">1</a>, <a href="https://www.sharcnet.ca/help/index.php/Using_R_and_MPI">2</a>, <a href="http://www.cybaea.net/Blogs/R-tips-Installing-Rmpi-on-Fedora-Linux.html">3</a></p>
  </li>
  <li>
    <p><a href="http://www.sfu.ca/~sblay/R/snow.html">snow包介绍</a></p>
  </li>
  <li>
    <p><a href="http://www.stat.yale.edu/~mjk56/temp/bigmemory-vignette.pdf">The R Package bigmemory: Supporting Efficient Computation and Concurrent Programming with Large Data Sets.</a></p>
  </li>
  <li>
    <p>书籍<a href="http://shop.oreilly.com/product/0636920021421.do">Parallel R</a></p>
  </li>
</ul>

<h3 id="a-idappendixa"><a id="appendix">补充材料</a></h3>

<ul>
  <li><a id="final_version">Final version</a></li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>combine parSapply and big.matrix </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">adj2ftBig <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>adMat<span class="p">,</span> adAllRowCol<span class="p">,</span> n <span class="o">=</span> <span class="m">2</span><span class="p">){</span>
</span><span class="line">
</span><span class="line">  <span class="c1"># INPUT: &#39;adMat&#39; should be a bigmatrix. &#39;adAllRowCol&#39; is the row and column combination, also is a bigmatrix</span>
</span><span class="line">
</span><span class="line">  <span class="kn">require</span><span class="p">(</span>bigmemory<span class="p">)</span>
</span><span class="line">  <span class="kn">require</span><span class="p">(</span>parallel<span class="p">)</span>
</span><span class="line">  cl <span class="o">&lt;-</span> makeCluster<span class="p">(</span>n<span class="p">,</span> type <span class="o">=</span> <span class="s">&quot;MPI&quot;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  adMatDescFile <span class="o">&lt;-</span> describe<span class="p">(</span>adMat<span class="p">)</span>
</span><span class="line">  adAllRowColDescFile <span class="o">&lt;-</span> describe<span class="p">(</span>adAllRowCol<span class="p">)</span>
</span><span class="line">
</span><span class="line">  rowNames <span class="o">&lt;-</span> <span class="kp">rownames</span><span class="p">(</span>adMat<span class="p">)</span>
</span><span class="line">  colNames <span class="o">&lt;-</span> <span class="kp">colnames</span><span class="p">(</span>adMat<span class="p">)</span>
</span><span class="line">
</span><span class="line">  ignore <span class="o">&lt;-</span> clusterEvalQ<span class="p">(</span>cl<span class="p">,</span> <span class="p">{</span><span class="kn">library</span><span class="p">(</span>bigmemory<span class="p">);</span> <span class="kc">NULL</span><span class="p">})</span>
</span><span class="line">
</span><span class="line">  Getft <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>i<span class="p">,</span> adAllRowColDesc<span class="p">,</span> adMatDesc<span class="p">){</span>
</span><span class="line">    adAllRowColData <span class="o">&lt;-</span> attach.big.matrix<span class="p">(</span>adAllRowColDesc<span class="p">)</span>
</span><span class="line">    adMatData <span class="o">&lt;-</span> attach.big.matrix<span class="p">(</span>adMatDesc<span class="p">)</span>
</span><span class="line">    rowIndex <span class="o">&lt;-</span> adAllRowColData<span class="p">[</span>i<span class="p">,</span> <span class="m">1</span><span class="p">]</span>
</span><span class="line">    colIndex <span class="o">&lt;-</span> adAllRowColData<span class="p">[</span>i<span class="p">,</span> <span class="m">2</span><span class="p">]</span>
</span><span class="line">    linkData <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span>rowNames<span class="p">[</span>rowIndex<span class="p">],</span> rowNames<span class="p">[</span>colIndex<span class="p">],</span> adMatData<span class="p">[</span>rowIndex<span class="p">,</span> colIndex<span class="p">])</span>
</span><span class="line">    <span class="kr">return</span><span class="p">(</span>linkData<span class="p">)</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line">
</span><span class="line">  adft <span class="o">&lt;-</span> parSapply<span class="p">(</span>cl<span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>adAllRowCol<span class="p">),</span> Getft<span class="p">,</span> adAllRowColDescFile<span class="p">,</span> adMatDescFile<span class="p">)</span>
</span><span class="line">
</span><span class="line">  stopCluster<span class="p">(</span>cl<span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="kr">return</span><span class="p">(</span>adft<span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li><a id="bigmatrix_direct">Bigmatrix direct version</a></li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>directly use the big.matrix </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">adj2ftBig3 <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>adMat<span class="p">,</span> adAllRowCol<span class="p">,</span> n <span class="o">=</span> <span class="m">2</span><span class="p">){</span>
</span><span class="line">
</span><span class="line">  <span class="c1"># INPUT: &#39;adMat&#39; is a matrix. &#39;adAllRowCol&#39; is the row and column combination, also a matrix.</span>
</span><span class="line">
</span><span class="line">  <span class="kn">library</span><span class="p">(</span>parallel<span class="p">)</span>
</span><span class="line">  cl <span class="o">&lt;-</span> makeCluster<span class="p">(</span>n<span class="p">,</span> type <span class="o">=</span> <span class="s">&quot;MPI&quot;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  rowNames <span class="o">&lt;-</span> <span class="kp">rownames</span><span class="p">(</span>adMat<span class="p">)</span>
</span><span class="line">  colNames <span class="o">&lt;-</span> <span class="kp">colnames</span><span class="p">(</span>adMat<span class="p">)</span>
</span><span class="line">
</span><span class="line">  adft <span class="o">&lt;-</span> parRapply<span class="p">(</span>cl <span class="o">=</span> cl<span class="p">,</span> adAllRowCol<span class="p">,</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
</span><span class="line">    linkData <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span>rowNames<span class="p">[</span>x<span class="p">[</span><span class="m">1</span><span class="p">]],</span> colNames<span class="p">[</span>x<span class="p">[</span><span class="m">2</span><span class="p">]],</span> adMat<span class="p">[</span>x<span class="p">[</span><span class="m">1</span><span class="p">],</span> x<span class="p">[</span><span class="m">2</span><span class="p">]])</span>
</span><span class="line">    <span class="kr">return</span><span class="p">(</span>linkData<span class="p">)</span>
</span><span class="line">  <span class="p">})</span>
</span><span class="line">
</span><span class="line">  stopCluster<span class="p">(</span>cl<span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="kr">return</span><span class="p">(</span>adft<span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li><a id="foreach">Foreach version</a></li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>apply foreach to big.matrix </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">adj2ftBig2 <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>adMat<span class="p">,</span> adAllRowCol<span class="p">,</span> n <span class="o">=</span> <span class="m">4</span><span class="p">){</span>
</span><span class="line">
</span><span class="line">  <span class="c1"># INPUT: &#39;adMat&#39; should be a bigmatrix. &#39;adAllRowCol&#39; is the row and column combination, also a bigmatrix.</span>
</span><span class="line">
</span><span class="line">  <span class="kn">library</span><span class="p">(</span>bigmemory<span class="p">)</span>
</span><span class="line">  <span class="kn">library</span><span class="p">(</span>foreach<span class="p">)</span>
</span><span class="line">  <span class="kn">library</span><span class="p">(</span>doMC<span class="p">)</span>
</span><span class="line">  registerDoMC<span class="p">(</span>n<span class="p">)</span>
</span><span class="line">
</span><span class="line">  rowNames <span class="o">&lt;-</span> <span class="kp">rownames</span><span class="p">(</span>adMat<span class="p">)</span>
</span><span class="line">  colNames <span class="o">&lt;-</span> <span class="kp">colnames</span><span class="p">(</span>adMat<span class="p">)</span>
</span><span class="line">
</span><span class="line">  adft <span class="o">&lt;-</span> foreach <span class="p">(</span>i <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>adAllRowCol<span class="p">),</span> <span class="m">.</span>combine <span class="o">=</span> <span class="kp">rbind</span><span class="p">,</span> <span class="m">.i</span>norder<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span> <span class="o">%dopar%</span> <span class="p">{</span>
</span><span class="line">    <span class="kp">print</span><span class="p">(</span><span class="kp">paste</span><span class="p">(</span><span class="s">&#39;It is running &#39;</span><span class="p">,</span> i<span class="p">,</span> <span class="s">&#39; in total of &#39;</span><span class="p">,</span> <span class="kp">nrow</span><span class="p">(</span>adAllRowCol<span class="p">),</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> sep <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
</span><span class="line">    linkData <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span>rowNames<span class="p">[</span>adAllRowCol<span class="p">[</span>i<span class="p">,</span> <span class="m">1</span><span class="p">]],</span> colNames<span class="p">[</span>adAllRowCol<span class="p">[</span>i<span class="p">,</span> <span class="m">2</span><span class="p">]],</span> adMat<span class="p">[</span>adAllRowCol<span class="p">[</span>i<span class="p">,</span> <span class="m">1</span><span class="p">],</span> adAllRowCol<span class="p">[</span>i<span class="p">,</span> <span class="m">2</span><span class="p">]])</span>
</span><span class="line">    <span class="kr">return</span><span class="p">(</span>linkData<span class="p">)</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line">
</span><span class="line">  <span class="kr">return</span><span class="p">(</span>adft<span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-4">更新记录</h3>

<p>2014年7月22日</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[构建和展示进化树软件使用心得]]></title>
    <link href="http://yulongniu.github.io/blog/2014/05/02/phylo-tool-summary/"/>
    <updated>2014-05-02T05:13:59+08:00</updated>
    <id>http://yulongniu.github.io/blog/2014/05/02/phylo-tool-summary</id>
    <content type="html"><![CDATA[<h2 id="section">构建进化树</h2>

<h3 id="phyml">1. PhyML</h3>

<p><strong>构建进化树方法</strong>：Maximum Likelihood</p>

<p><strong>评估</strong>：选择bootstrap或者Likelihood-ratio test</p>

<p><strong>运行方式</strong>：所有平台和<a href="http://atgc.lirmm.fr/phyml/">网页</a></p>

<p><strong>心得</strong>：理论上支持4000条序列，小于2000000个字符。但是，对于个人电脑，通常100-200条序列比较合适。命令行运行时，可以选择非常简介的默认模式运行。在默认模式下，bootstrap需要手动开启。安装和使用非常方便，直接下载后可以直接使用。同时，bootstrap可以通过MPI分布计算，但是需要从源代码安装。</p>

<p><strong>快速运行</strong>：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">phyml -i align_file.phy --no_memory_check
</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<ul>
  <li><code>-i</code>：后跟需要Phylip格式文件</li>
  <li><code>--no_memory_check</code>：不用检查内存，防止程序运行时跳出</li>
</ul>

<h3 id="raxml">2. RAxML</h3>

<p><strong>构建进化树方法</strong>：Maximum Likelihood</p>

<p><strong>运行方式</strong>：所有<a href="http://www.exelixis-lab.org/">平台</a>和网页。</p>

<p><strong>心得</strong>：推荐<a href="http://www.phylo.org/portal2/login!input.action">网页运行</a>，支持数据的存放和其他构建进化树的方法。本地安装支持MPI和PThreads的分布计算，但是安装有些复杂，需要仔细阅读文档。</p>

<p><strong>快速运行1</strong>：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">raxmlHPC-PTHREADS-AVX -x <span class="m">12345</span> -p <span class="m">12345</span> -# <span class="m">100</span> -m GTRGAMMA -T <span class="m">4</span> -s align_file.phy -n TEST
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li><code>-x</code>：bootstrap运行时设定随机数，用于结果重现</li>
  <li><code>-p</code>：parsimony推断时设定随机数，用于结果重现</li>
  <li><code>-#</code>：bootstrap次数。也可以设定为autoMRE，最大次数是1000。</li>
  <li><code>-m</code>：设定使用的模型，GTRGAMMA为核苷酸序列适用模型</li>
  <li><code>-T</code>：设定线程数，不要超过最大线程</li>
  <li><code>-s</code>：输入文件，Phylip或者fasta文件</li>
  <li><code>-n</code>：输入文件记号</li>
</ul>

<p><strong>快速运行2</strong>：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">raxmlHPC-PTHREADS-AVX -f a -x <span class="m">12345</span> -p <span class="m">12345</span> -# autoMRE -m GTRCAT -T <span class="m">4</span> -s align_file.phy -n TEST
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li><code>-f a</code>：选定算法，快速bootstrap</li>
</ul>

<h2 id="section-1">展示进化树</h2>

<h3 id="itol">1. iTOL</h3>

<p><strong>运行方式</strong>：<a href="http://itol.embl.de/">网页</a></p>

<p><strong>心得</strong>：</p>

<ul>
  <li>
    <p>用户可以添加很多自定义的项目，丰富和完善自己的进化树，比如添加柱状图、蛋白结构域、heatmap、基因平行转移（horizontal gene transfer）等；</p>
  </li>
  <li>
    <p>如果输入NCBI taxonomy编号，能够自动转化成物种名称；支持鼠标点击交互式运行，非常方便。
心得：可以在网站上建立自己的帐号，之后设定不同的project展示和存放自己的项目。尝试构建了2000条左右的序列，显示完全没有问题。</p>
  </li>
</ul>

<h3 id="section-2">更新记录</h3>

<p>2014年5月1日</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[创建R包的最简流程]]></title>
    <link href="http://yulongniu.github.io/blog/2014/03/28/creat-r-package/"/>
    <updated>2014-03-28T02:53:05+08:00</updated>
    <id>http://yulongniu.github.io/blog/2014/03/28/creat-r-package</id>
    <content type="html"><![CDATA[<p>一个最简单创建R包的流程。</p>

<h2 id="section">1. 载入工具包</h2>

<p>安装并载入<span style="color: blue">devtools</span>包和<span style="color: blue">roxygen2</span>包。<span style="color: blue">devtools</span>包提供了一些包的检查、安装和打包的基本工具。<span style="color: blue">roxygen2</span>包则使得书写R帮助文档变得轻松简单。如果习惯使用Emacs，可以结合<a href="http://ess.r-project.org/">ESS</a>建立R包，可以将R代码和帮助文档有效组合在一起，便于管理。当然，也可以使用<a href="http://www.rstudio.com/">Rstudio</a>。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="kn">library</span><span class="p">(</span>devtools<span class="p">)</span>
</span><span class="line"><span class="kn">library</span><span class="p">(</span>roxygen2<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<h2 id="description">2. 创建DESCRIPTION文件模板</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">load_all<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>其中<code class="language-bash">import</code>栏目，在源代码中使用了哪些包，需要逐步在import项目中添加和修改。</p>

<h2 id="section-1">3. 检查包</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">check<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-2">4. 安装包</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">install<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="targzlanguage-bash">5. 生成<code class="language-bash">.tar.gz</code>压缩文件</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">build<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="a-idrefa"><a id="Ref">参考网址</a></h3>

<ul>
  <li><a href="https://www.youtube.com/watch?v=9PyQlbAEujY">创建R包视频</a></li>
</ul>

<h3 id="section-3">更新记录</h3>

<p>2014年9月5日</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Circos Notes]]></title>
    <link href="http://yulongniu.github.io/blog/2014/03/18/circos-notes/"/>
    <updated>2014-03-18T03:37:45+08:00</updated>
    <id>http://yulongniu.github.io/blog/2014/03/18/circos-notes</id>
    <content type="html"><![CDATA[<p>Mapping data onto a Circos figure requires that you identify what patterns in your data are (a) likely to be important and (b) likely to be present, and create a figure that exposes such patterns. Remember, if the pattern exists, you can’t afford to miss it. If it doesn’t exist, you can’t afford to be fooled into thinking that it’s there, or left wondering whether it’s occluded by other data.</p>

<h2 id="run-circos">1. Run circos</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">bin/circos
</span><span class="line">-png
</span><span class="line">-svg
</span><span class="line">-conf etc/circos.conf
</span><span class="line">-outputdir /path/to/your/output/directory
</span><span class="line">-outputfile yourimage.png
</span></code></pre></td></tr></table></div></figure></notextile></div>
<!--more-->

<ul>
  <li>
    <p><code class="language-bash">-debug</code> is used for debugging</p>
  </li>
  <li>
    <p><code class="language-bash">-cdump</code> is used for check the parsing file.</p>
  </li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># store all debug output in circos.debug.txt and display only karyotype</span>
</span><span class="line">&gt; circos ... -group_debug _all <span class="p">|</span> tee circos.debug.txt <span class="p">|</span> egrep <span class="s2">&quot;debuggroup karyotype&quot;</span>
</span><span class="line"><span class="c"># extract other debug reports</span>
</span><span class="line">&gt; egrep <span class="s2">&quot;debuggroup rule&quot;</span> circos.debug.txt
</span><span class="line">&gt; egrep <span class="s2">&quot;debuggroup (rule|scale)&quot;</span> circos.debug.txt
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="syntax-and-configure-files">2. Syntax and configure files</h2>

<p>Configuration syntax is like:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;ideogram&gt;</span>
</span><span class="line"> thickness = 30p
</span><span class="line"> fill      = yes
</span><span class="line"> ...
</span><span class="line"><span class="nt">&lt;/ideogram&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Usefule syntax: hierarchical structure <code class="language-html">&lt;ideogram&gt;</code>; all data points in all plot tracks <code class="language-html">&lt;links&gt;</code> and <code class="language-html">&lt;plots&gt;</code>; local data points in a given track <code class="language-html">&lt;link&gt;</code> and <code class="language-html">&lt;plot&gt;</code>; rules <code class="language-html">&lt;rules&gt;</code> and <code class="language-html">&lt;rule&gt;</code>; highlight<code class="language-html">&lt;hightlight&gt;</code>.</p>

<p>Extermal imports</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;image&gt;</span>
</span><span class="line"># Included from Circos distribution.
</span><span class="line"><span class="err">&lt;</span><span class="nt">&lt;include</span> <span class="na">etc</span><span class="err">/</span><span class="na">image</span><span class="err">.</span><span class="na">conf</span><span class="nt">&gt;</span>&gt;
</span><span class="line"><span class="nt">&lt;/image&gt;</span>
</span><span class="line">
</span><span class="line"># colors, fonts and fill patterns
</span><span class="line"><span class="err">&lt;</span><span class="nt">&lt;include</span> <span class="na">etc</span><span class="err">/</span><span class="na">colors_fonts_patterns</span><span class="err">.</span><span class="na">conf</span><span class="nt">&gt;</span>&gt;
</span><span class="line"># system and debug parameters
</span><span class="line"><span class="err">&lt;</span><span class="nt">&lt;include</span> <span class="na">etc</span><span class="err">/</span><span class="na">housekeeping</span><span class="err">.</span><span class="na">conf</span><span class="nt">&gt;</span>&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Accessing configuration values<code class="language-html">parameter2 = conf(parameter1)</code> or <code class="language-html">parameter2 = conf(block1,block2,parameter1)</code> for:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;block1&gt;</span>
</span><span class="line"><span class="nt">&lt;block2&gt;</span>
</span><span class="line">parameter1 = ...
</span><span class="line"><span class="nt">&lt;/block2&gt;</span>
</span><span class="line"><span class="nt">&lt;/block1&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Eval</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="html"><span class="line">track_color = blue
</span><span class="line">track_width = 100
</span><span class="line">track_start = 0.5
</span><span class="line">
</span><span class="line"><span class="nt">&lt;plots&gt;</span>
</span><span class="line"><span class="nt">&lt;plot&gt;</span>
</span><span class="line"># color=blue
</span><span class="line">color = conf(track_color)
</span><span class="line"># r0 = 0.5r
</span><span class="line">r0    = eval(conf(track_start) . &quot;r&quot;)
</span><span class="line"># r1 = 0.5r+100p
</span><span class="line">r1    = eval(conf(track_start) . &quot;r&quot; + conf(track_width) . &quot;p&quot;)
</span><span class="line"><span class="nt">&lt;/plot&gt;</span>
</span><span class="line"><span class="nt">&lt;/plots&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Color</p>

<p>Use the color name given, like <code class="language-html">red</code>, <code class="language-html">lred</code>, <code class="language-html">vlred</code>, <code class="language-html">vvlred</code>, <code class="language-html">dred</code>, <code class="language-html">vdred</code>, <code class="language-html">vvdred</code>. If a pure color is need, use <code class="language-html">pred</code>. For the transparent color, <code class="language-html">red_a1</code>, <code class="language-html">red_a2</code>, and to <code class="language-html">red_a5</code>. <code class="language-html">red_a1</code> has a 17% tansparency and <code class="language-html">red_a5</code> have a 83% transparency.</p>

<h2 id="ideogram">3. Ideogram</h2>

<p>One of the most common used ideogram is the karyotypes plot. The chromosome is marked as:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line">
</span><span class="line"><span class="nb">chr</span> <span class="o">-</span> <span class="n">id</span> <span class="n">label</span> <span class="n">start</span> <span class="n">end</span> <span class="n">color</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>for example</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="nb">chr</span> <span class="o">-</span> <span class="n">hs1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">249250621</span> <span class="n">chr1</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The cytogenetic bands data is like:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">band</span> <span class="n">hs1</span> <span class="n">p36</span><span class="mf">.33</span> <span class="n">p36</span><span class="mf">.33</span> <span class="mi">0</span> <span class="mi">2300000</span> <span class="n">gneg</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>Choose a subset of chromosomes</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">chromosomes_display_default</span> <span class="o">=</span> <span class="nb">no</span>
</span><span class="line">
</span><span class="line"><span class="n">chromosomes</span> <span class="o">=</span> <span class="n">hs1</span><span class="p">;</span><span class="n">hs2</span><span class="p">;</span><span class="n">hs3</span><span class="p">;</span><span class="n">h4</span>
</span><span class="line"><span class="n">chromosomes</span> <span class="o">=</span> <span class="sr">/hs[1-4]$/</span>
</span><span class="line"><span class="n">chromosomes</span> <span class="o">=</span> <span class="sr">/hs[1-4]$/</span><span class="p">;</span><span class="n">hs10</span><span class="p">;</span><span class="n">hs11</span>
</span><span class="line"><span class="n">chromosomes</span> <span class="o">=</span> <span class="sr">/hs[1-4]$/</span><span class="p">;</span><span class="o">-</span><span class="n">hs3</span>
</span><span class="line"><span class="n">chromosomes</span> <span class="o">=</span> <span class="n">hs1:</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">120</span><span class="o">-</span><span class="p">);</span><span class="n">hs2</span><span class="p">;</span><span class="n">hs3</span><span class="p">;</span><span class="n">h4</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>Order</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">chromosomes_order</span> <span class="o">=</span> <span class="n">hs2</span><span class="p">,</span><span class="n">hs3</span><span class="p">,</span><span class="n">hs1</span><span class="p">,</span><span class="n">hs5</span><span class="p">,</span><span class="n">hs4</span><span class="p">,</span><span class="n">hs8</span><span class="p">,</span><span class="n">hs7</span><span class="p">,</span><span class="n">hs6</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>Scale</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">chromosomes_scale</span> <span class="o">=</span> <span class="n">hs1</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">hs2</span><span class="o">=</span><span class="mf">2.0</span>
</span><span class="line"><span class="c1"># 25% and 50%</span>
</span><span class="line"><span class="n">chromosomes_scale</span> <span class="o">=</span> <span class="n">hs1</span><span class="o">=</span><span class="mf">0.25</span><span class="n">r</span><span class="p">,</span><span class="n">hs2</span><span class="o">=</span><span class="mf">0.50</span><span class="n">r</span>
</span><span class="line"><span class="c1"># each is 25%</span>
</span><span class="line"><span class="n">chromosomes_scale</span> <span class="o">=</span> <span class="sr">/hs[12]/</span><span class="o">=</span><span class="mf">0.5</span><span class="n">rn</span>
</span><span class="line"><span class="c1"># all ideograms distributed evenly within entire figure</span>
</span><span class="line"><span class="n">chromosomes_scale</span>   <span class="o">=</span> <span class="sr">/./</span><span class="o">=</span><span class="mi">1</span><span class="n">rn</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>Rotation</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;image&gt;</span>
</span><span class="line">angle_orientation* = counterclockwise
</span><span class="line"><span class="err">&lt;</span><span class="nt">&lt;include</span> <span class="na">etc</span><span class="err">/</span><span class="na">image</span><span class="nt">&gt;</span>&gt;
</span><span class="line"><span class="nt">&lt;/image&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">chromosomes_reverse</span> <span class="o">=</span> <span class="sr">/hs[234]/</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>Chromosome color</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">chromosomes_color</span> <span class="o">=</span> <span class="n">hs1</span><span class="o">=</span><span class="n">red</span><span class="p">,</span><span class="n">hs2</span><span class="o">=</span><span class="n">orange</span><span class="p">,</span><span class="n">hs3</span><span class="o">=</span><span class="n">green</span><span class="p">,</span><span class="n">hs4</span><span class="o">=</span><span class="n">blue</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Also, the color could be redefined as</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">chr1</span><span class="o">*</span> <span class="o">=</span> <span class="n">red</span>
</span><span class="line"><span class="n">chr2</span><span class="o">*</span> <span class="o">=</span> <span class="n">orange</span>
</span><span class="line"><span class="n">chr3</span><span class="o">*</span> <span class="o">=</span> <span class="n">green</span>
</span><span class="line"><span class="n">chr4</span><span class="o">*</span> <span class="o">=</span> <span class="n">blue</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>Position</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">chromosomes_radius</span> <span class="o">=</span> <span class="n">hs4:0</span><span class="mf">.9</span><span class="n">r</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>Show bands</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">band_transparency</span> <span class="o">=</span> <span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>Add chromosome</li>
</ul>

<p>For example, add the human mitochondria chromosome.</p>

<p>Add the following to the file <code class="language-bash">data/karyotype/karyotype.human.txt</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="nb">chr</span> <span class="o">-</span> <span class="n">hsMT</span> <span class="n">MT</span> <span class="mi">0</span> <span class="mi">16569</span> <span class="n">chrMT</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Add “hsMT” color in the file <code class="language-bash">etc/colors.ucsc.conf</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">chrMT</span> <span class="o">=</span> <span class="mi">121</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">61</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="highlight">4. Highlight</h2>

<h3 id="data-type">4.1 Data type</h3>

<p>Data type of highlight is</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="nb">chr</span> <span class="n">start</span> <span class="n">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>for exmaple,</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">hs1</span> <span class="mi">1298972</span> <span class="mi">1300443</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>We can also add the highlight information into the data file, for example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">hs1</span> <span class="mi">100433463</span> <span class="mi">100487964</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">red</span><span class="p">,</span><span class="n">r0</span><span class="o">=</span><span class="mf">0.6</span><span class="n">r</span><span class="p">,</span><span class="n">r1</span><span class="o">=</span><span class="mf">0.6</span><span class="n">r</span><span class="o">+</span><span class="mi">50</span><span class="n">p</span>
</span><span class="line"><span class="n">hs1</span> <span class="mi">232817594</span> <span class="mi">240828534</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">chr9</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="mi">61</span><span class="p">,</span><span class="n">r0</span><span class="o">=</span><span class="mf">0.4</span><span class="n">r</span><span class="o">-</span><span class="mf">78.7058</span><span class="n">p</span><span class="p">,</span><span class="n">r1</span><span class="o">=</span><span class="mf">0.4</span><span class="n">r</span><span class="o">+</span><span class="mf">78.7058</span><span class="n">p</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="conf-format">4.2 Conf format</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;highlights&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;highlight&gt;</span>
</span><span class="line">...
</span><span class="line"><span class="nt">&lt;/highlight&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;highlight&gt;</span>
</span><span class="line">...
</span><span class="line"><span class="nt">&lt;/highlight&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;highlight&gt;</span>
</span><span class="line">...
</span><span class="line"><span class="nt">&lt;/highlight&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;/highlights&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="parameters">4.3 Parameters</h3>

<p><code>r0</code>: inner radius of highlight</p>

<p><code>r1</code>: outer radius of highlight</p>

<p><code>offset</code>:  an offset applied to both r0 and r1 (useful for overriding default r0,r1 values defined at lower precedence)</p>

<p><code>fill_color</code>: color of the highlight slice</p>

<p><code>stroke_color</code>: color of the highlight border, drawn if stroke_thickness is set</p>

<p><code>stroke_thickness</code>: border thickness, if any, of the highlight slice</p>

<p><code>z</code>: z-depth of the highlight, controlling the order in which highlights are drawn</p>

<p><code>ideogram</code>: toggles the position of the highlight to be within the ideogram extent</p>

<h3 id="plot-hightlight">4.4 Plot hightlight</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;plots&gt;</span>
</span><span class="line"><span class="nt">&lt;plot&gt;</span>
</span><span class="line">type = highlight
</span><span class="line">file = data/3/chr.highlights.txt
</span><span class="line">r0   = 0.3r
</span><span class="line">r1   = 0.35r
</span><span class="line">z    = 10
</span><span class="line"><span class="nt">&lt;/plot&gt;</span>
</span><span class="line"><span class="nt">&lt;/plots&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="links">5. Links</h2>

<h3 id="data-type-1">5.1 Data type</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">hs1</span> <span class="mi">100</span> <span class="mi">200</span> <span class="n">hs2</span> <span class="mi">250</span> <span class="mi">300</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>or</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">segdup00010</span> <span class="n">hs1</span> <span class="mi">100</span> <span class="mi">200</span>
</span><span class="line"><span class="n">segdup00010</span> <span class="n">hs2</span> <span class="mi">250</span> <span class="mi">300</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>with link options</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">hs1</span> <span class="mi">100</span> <span class="mi">200</span> <span class="n">hs2</span> <span class="mi">250</span> <span class="mi">300</span> <span class="n">color</span><span class="o">=</span><span class="n">blue</span>
</span><span class="line"><span class="n">hs1</span> <span class="mi">400</span> <span class="mi">550</span> <span class="n">hs3</span> <span class="mi">500</span> <span class="mi">750</span> <span class="n">color</span><span class="o">=</span><span class="n">red</span><span class="p">,</span><span class="n">thickness</span><span class="o">=</span><span class="mi">5</span><span class="n">p</span>
</span><span class="line"><span class="n">hs1</span> <span class="mi">600</span> <span class="mi">800</span> <span class="n">hs4</span> <span class="mi">150</span> <span class="mi">350</span> <span class="n">color</span><span class="o">=</span><span class="n">black</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="conf-format-1">5.2 Conf format</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;links&gt;</span>
</span><span class="line"><span class="nt">&lt;link&gt;</span>
</span><span class="line">file          = data/5/segdup.txt
</span><span class="line">radius        = 0.8r
</span><span class="line">bezier_radius = 0r
</span><span class="line">color         = black_a4
</span><span class="line">thickness     = 2
</span><span class="line"><span class="nt">&lt;/link&gt;</span>
</span><span class="line"><span class="nt">&lt;/links&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="parameters-1">5.3 Parameters</h3>

<p><code>radius</code>: this is the radial position of the termination of the link; for relative values, if radius &lt; 1 then it is defined in terms of the inner ideogram radius, otherwise it is defined in terms of the outer ideogram radius</p>

<p><code>bezier_radius</code>: the radial position of the third control point (in addition to the two positions defined by the link coordinates) used to draw the Bezier curve; if this parameter is not defined then straight lines will be used</p>

<p><code>color</code>: color of the link line</p>

<p><code>thickness</code>: thickness of the link line (note that this is not stroke_thickness, since the line isn’t technically stroked)</p>

<p><code>record_limit</code>: if this is defined, the number of records read from the file is capped; coordinate records are sampled from the start of the file; useful for debugging</p>

<p>In each <code class="language-html">&lt;link&gt;</code>, <code class="language-html">&lt;rules&gt;</code> and <code class="language-html">&lt;rule&gt;</code> can be applied to special ruls. Each <code class="language-html">&lt;rule&gt;</code> contains three parts: <em>a condition</em>, <em>formatting statements</em> and <em>an optional ‘flow’ statement</em>.</p>

<p>Marker the priority of rules</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;rule&gt;</span>
</span><span class="line"># 1st
</span><span class="line">importance = 10
</span><span class="line"><span class="nt">&lt;/rule&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Add a tag</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;rule&gt;</span>
</span><span class="line">flow = goto special_rule if true
</span><span class="line">...
</span><span class="line"><span class="nt">&lt;/rule&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;rule&gt;</span>
</span><span class="line">tag = special_rule
</span><span class="line">...
</span><span class="line"><span class="nt">&lt;/rule&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="histograms">6. Histograms</h2>

<p>Histogram, line plot, scatter plot, and heat map share the same data format</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="nb">chr</span> <span class="n">start</span> <span class="n">end</span> <span class="n">value</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>for exmaple</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">hs3</span> <span class="mi">196000000</span> <span class="mi">197999999</span> <span class="mf">71.0000</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">blue</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="c1"># in data file</span>
</span><span class="line"><span class="n">hs3</span> <span class="mi">196000000</span> <span class="mi">197999999</span> <span class="mf">71.0000</span> <span class="n">id</span><span class="o">=</span><span class="n">abc</span>
</span><span class="line">
</span><span class="line"><span class="c1"># in rule block</span>
</span><span class="line"><span class="sr">&lt;rule&gt;</span>
</span><span class="line"><span class="n">condition</span>  <span class="o">=</span> <span class="n">var</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot;abc&quot;</span>
</span><span class="line"><span class="n">fill_color</span> <span class="o">=</span> <span class="n">blue</span>
</span><span class="line"><span class="sr">&lt;/rule&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Another data format has multiple values</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="nb">chr</span> <span class="n">start</span> <span class="n">end</span> <span class="n">value</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="o">...</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>for example</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">hs3</span> <span class="mi">196000000</span> <span class="mi">197999999</span> <span class="mf">0.0000</span><span class="p">,</span><span class="mf">7.0000</span><span class="p">,</span><span class="mf">64.0000</span><span class="p">,</span><span class="mf">0.0000</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>Plot histogram</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;plots&gt;</span>
</span><span class="line"><span class="nt">&lt;plot&gt;</span>
</span><span class="line">type = histogram
</span><span class="line">file = data/5/segdup.hs1234.hist.txt
</span><span class="line">r1   = 0.88r
</span><span class="line">r0   = 0.81r
</span><span class="line">
</span><span class="line">fill_color = vdgrey
</span><span class="line">extend_bin = no
</span><span class="line"><span class="nt">&lt;/plot&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>For multiple values, <code class="language-bash">fill_color</code> is used to set the different colors.</p>

<ul>
  <li>Orientation</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="html"><span class="line">orientation = in
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>Rules</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;rules&gt;</span>
</span><span class="line"><span class="err">&lt;</span><span class="nt">&lt;include</span> <span class="na">exclude</span><span class="err">.</span><span class="na">hs1</span><span class="err">.</span><span class="na">rule</span><span class="nt">&gt;</span>&gt;
</span><span class="line"><span class="nt">&lt;/rules&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>Backgrounds and axes</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;plot&gt;</span>
</span><span class="line">...
</span><span class="line">
</span><span class="line"><span class="nt">&lt;axes&gt;</span>
</span><span class="line"> <span class="nt">&lt;axis&gt;</span>
</span><span class="line"> ...
</span><span class="line"> <span class="nt">&lt;/axis&gt;</span>
</span><span class="line"> <span class="nt">&lt;axis&gt;</span>
</span><span class="line"> ...
</span><span class="line"> <span class="nt">&lt;/axis&gt;</span>
</span><span class="line"> ...
</span><span class="line"><span class="nt">&lt;/axes&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;backgrounds&gt;</span>
</span><span class="line"> <span class="nt">&lt;background&gt;</span>
</span><span class="line"> ...
</span><span class="line"> <span class="nt">&lt;/background&gt;</span>
</span><span class="line"> <span class="nt">&lt;background&gt;</span>
</span><span class="line"> ...
</span><span class="line"> <span class="nt">&lt;/background&gt;</span>
</span><span class="line"> ...
</span><span class="line"><span class="nt">&lt;/backgrounds&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;/plot&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>text</li>
</ul>

<p>text data format is</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="nb">chr</span> <span class="n">start</span> <span class="n">end</span> <span class="n">value</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>for exmaple</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="n">hs1</span> <span class="mi">100425066</span> <span class="mi">100487997</span> <span class="n">DBT</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;plots&gt;</span>
</span><span class="line"><span class="nt">&lt;plot&gt;</span>
</span><span class="line">type             = text
</span><span class="line">color            = black
</span><span class="line">file             = data/phylo/labelGene.txt
</span><span class="line"><span class="nt">&lt;/plot&gt;</span>
</span><span class="line"><span class="nt">&lt;/plots&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>apply rules</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;rules&gt;</span>
</span><span class="line"><span class="nt">&lt;rule&gt;</span>
</span><span class="line">importance = 90
</span><span class="line">condition  = var(value) eq &quot;GeneName&quot;
</span><span class="line">color = blue
</span><span class="line"><span class="nt">&lt;/rule&gt;</span>
</span><span class="line"><span class="nt">&lt;/rules&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="http://circos.ca/images/scientific_literature/">Ciros grocery of published pictures</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A Brief Intruction of Mutual Information and Demonstration With R]]></title>
    <link href="http://yulongniu.github.io/blog/2013/11/10/mutual-information/"/>
    <updated>2013-11-10T14:21:16+08:00</updated>
    <id>http://yulongniu.github.io/blog/2013/11/10/mutual-information</id>
    <content type="html"><![CDATA[<script type="text/x-mathjax-config">
MathJax.Hub.Config({
TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

<p>$\newcommand{\entropfrac}[2]{\frac{#1}{#2} \log \left( \frac{#1}{#2} \right)}$</p>

<h2 id="mututal-information-mi">Mututal Information (MI)</h2>

<h3 id="introduction">Introduction</h3>

<p><a href="http://en.wikipedia.org/wiki/Mutual_information">Mutual Information (MI)</a> distance is used to measure the distance between two genes vectors, for example $x_1 = {1, 0, 1, 1, 1, 1, 0}$ and $y_1 = {0, 1, 1, 1, 1, 1, 0}$. It is easily to transfer the two vectors into a binary table:</p>

<hr />

<table>
  <thead>
    <tr>
      <th style="text-align: center"><strong>X/Y</strong></th>
      <th style="text-align: center"><strong>1(Presence)</strong></th>
      <th style="text-align: center"><strong>0(Absence)</strong></th>
      <th style="text-align: center"><strong>Sum</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><strong>1(Presence)</strong></td>
      <td style="text-align: center">a</td>
      <td style="text-align: center">b</td>
      <td style="text-align: center">a+b</td>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td style="text-align: center"><strong>0(Absence)</strong></td>
      <td style="text-align: center">c</td>
      <td style="text-align: center">d</td>
      <td style="text-align: center">c+d</td>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td style="text-align: center"><strong>Sum</strong></td>
      <td style="text-align: center">a+c</td>
      <td style="text-align: center">b+d</td>
      <td style="text-align: center">n=a+b+c+d</td>
    </tr>
  </tbody>
</table>

<hr />

<!--more-->

<p>Typically, here we give the example of two discrete variables, the mutual information between $x_1$ and $y_1$ is</p>

<script type="math/tex; mode=display">% &lt;![CDATA[
\begin{align}
\begin{split}
I(X;Y) &= H(X) + H(Y) - H(X,Y)\\
&= -\sum_{x \in \{0, 1\}}p(x)\log(p(x)) - \sum_{y \in \{0, 1\}}p(y)\log(p(y))\\
& \quad -\left( -\sum_{x \in \{0, 1\}}\sum_{y \in \{0, 1\}}p(x,y)\log(p(x,y)) \right)\\
\end{split}
\label{eq:1}
\end{align} %]]&gt;</script>

<p>The $\eqref{eq:1}$ is equal to</p>

<script type="math/tex; mode=display">\begin{equation}
I(X;Y) = \sum_{x \in \{1, 0\}}\sum_{y \in \{1, 0\}} p(x,y) \frac{\log(p(x,y))}{p(x)p(y)}
\label{eq:2}
\end{equation}</script>

<p>$p(x)$ is the probability that a symbol (here is 0 or 1) appears in the gene vector X regardless that what the symbol is in gene vector Y. $p(y)$ has a similar definition of $p(x). $$p(x, y)$ is probability of a symbol combination appears in gene vector X and Y. In this example, there are four kinds of symbol combination $(1, 1)$, $(1, 0)$, $(0, 1)$ and $(1, 1)$.</p>

<p>If we use the binary table to illustrate this equation, the $\eqref{eq:1}$ is:</p>

<script type="math/tex; mode=display">% &lt;![CDATA[
\begin{align}
\begin{split}
I(X; Y) &= -\left( \entropfrac{a+c}{n} + \entropfrac{b+d}{n} \right)\\
& \quad -\left( \entropfrac{a+b}{n} + \entropfrac{c+d}{n} \right)\\
& \quad - \left( - \left(
\entropfrac{a}{n} + \entropfrac{b}{n} + \entropfrac{c}{n} + \entropfrac{d}{n}
\right) \right)\\
\end{split}
\label{eq:3}
\end{align} %]]&gt;</script>

<p>The $\eqref{eq:3}$ is mathmatically equal to:</p>

<script type="math/tex; mode=display">% &lt;![CDATA[
\begin{align}
\begin{split}
I(X; Y) &= \frac{a}{n}\log\frac{na}{(a+b)(a+c)} + \frac{b}{n}\log\frac{nc}{(a+d)(b+d)}\\
& \quad \frac{c}{n}\log\frac{nc}{(a+b)(a+c)} + \frac{d}{n}\log\frac{nd}{(d+c)(d+b)}
\end{split}
\label{eq:4}
\end{align} %]]&gt;</script>

<h3 id="example">Example</h3>

<p>We can use R to directly calculate the MI between two gene vectors mentioned above.</p>

<ol>
  <li>Use basic R function</li>
</ol>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">x1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
</span><span class="line">y1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
</span><span class="line"><span class="kp">table</span><span class="p">(</span>x1<span class="p">,</span> y1<span class="p">)</span>
</span><span class="line">   y1
</span><span class="line">x1  <span class="m">0</span> <span class="m">1</span>
</span><span class="line">  <span class="m">0</span> <span class="m">1</span> <span class="m">1</span>
</span><span class="line">  <span class="m">1</span> <span class="m">1</span> <span class="m">4</span>
</span><span class="line"><span class="c1"># calculate MI</span>
</span><span class="line"><span class="m">4</span><span class="o">/</span><span class="m">7</span> <span class="o">*</span> <span class="kp">log</span><span class="p">(</span><span class="m">28</span><span class="o">/</span><span class="m">25</span><span class="p">)</span> <span class="o">+</span> <span class="m">1</span><span class="o">/</span><span class="m">7</span> <span class="o">*</span> <span class="kp">log</span><span class="p">(</span><span class="m">7</span><span class="o">/</span><span class="m">10</span><span class="p">)</span> <span class="o">+</span> <span class="m">1</span><span class="o">/</span><span class="m">7</span> <span class="o">*</span> <span class="kp">log</span><span class="p">(</span><span class="m">7</span><span class="o">/</span><span class="m">10</span><span class="p">)</span> <span class="o">+</span> <span class="m">1</span><span class="o">/</span><span class="m">7</span> <span class="o">*</span> <span class="kp">log</span><span class="p">(</span><span class="m">7</span><span class="o">/</span><span class="m">4</span><span class="p">)</span>
</span><span class="line"><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">0.04279723</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ol>
  <li>Use R package <span style="color: blue">bioDist</span></li>
</ol>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="kn">library</span><span class="p">(</span>bioDist<span class="p">)</span>
</span><span class="line">mutualInfo<span class="p">(</span><span class="kp">rbind</span><span class="p">(</span>x1<span class="p">,</span> y1<span class="p">))</span>
</span><span class="line">           x1
</span><span class="line">y1 <span class="m">0.04279723</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="reference">Reference</h3>

<ul>
  <li>
    <p><a href="http://nlp.stanford.edu/IR-book/html/htmledition/mutual-information-1.html">An example of MI</a></p>
  </li>
  <li>
    <p><a href="http://www1.ece.uic.edu/~devroye/courses/ECE534/lectures/ch2.pdf">Slices of MI</a></p>
  </li>
  <li>
    <p><a href="http://people.cs.umass.edu/~elm/Teaching/Docs/mutInf.pdf">Entropy and Mutual Information</a></p>
  </li>
  <li>
    <p><a href="http://www.scholarpedia.org/article/Mutual_information">Useful Websites 1</a></p>
  </li>
  <li>
    <p><a href="http://montana.informatics.indiana.edu/LabWebPage/Presentations/Vikas_Nov02_2011.pdf">Slices about MI application in bioinformatics</a></p>
  </li>
  <li>
    <p>Seung-Seok Choi, Sung-Hyuk Cha, Charles C. Tappert: <a href="http://www.iiisci.org/journal/sci/Abstract.asp?var=&amp;id=GS315JG">A Survey of Binary Similarity and Distance Measures</a>.</p>
  </li>
  <li>
    <p>Huynen M, Snel B, Lathe W 3rd, Bork P: Predicting protein function by genomic context: quantitative evaluation and qualitative inferences.Genome Res. 2000;10(8):1204-10.</p>
  </li>
  <li>
    <p>Korber BT, Farber RM, Wolpert DH, Lapedes AS: Covariation of mutations in the V3 loop of human immunodeficiency virus type 1 envelope protein: an information theoretic analysis. Proc Natl Acad Sci U S A. 1993;90(15):7176-80.</p>
  </li>
  <li>
    <p>Kensche PR, van Noort V, Dutilh BE, Huynen MA: Practical and theoretical advances in predicting the function of a protein by its phylogenetic distribution. J R Soc Interface. 2008;5(19):151-70.</p>
  </li>
</ul>

<h3 id="update-record">Update record</h3>

<p>12/16/2014</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[R Ggplot2 Notes]]></title>
    <link href="http://yulongniu.github.io/blog/2013/10/02/ggplot2-notes/"/>
    <updated>2013-10-02T14:47:11+08:00</updated>
    <id>http://yulongniu.github.io/blog/2013/10/02/ggplot2-notes</id>
    <content type="html"><![CDATA[<h1 id="r-package-span-stylecolor-blueggplot2span-notes">R Package <span style="color: blue">ggplot2</span> Notes</h1>

<h2 id="basic-grammar">1. Basic grammar</h2>

<h3 id="plot-types">1.1 Plot types</h3>

<p>The R package <span style="color: blue">ggplot2</span> is a famous plot tool for high quality scientific figures. The <span style="color: blue">ggplot2</span> style figures are widely seen in papers published in high quality journals such as <em>PNAS</em>, <em>Nature</em> and <em>Cell</em>.</p>

<p>The input data should be in <strong>data frame</strong> form, and it is easily to use the function <code class="language-r">as.data.frame()</code>. “<span style="color:red"><strong>+</strong></span>” is used to connect different plot statement. A typical <span style="color: blue">ggplot2</span> plot statement is like:</p>

<!--more-->

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="kn">require</span><span class="p">(</span><span class="s">&#39;ggplot2&#39;</span><span class="p">)</span>
</span><span class="line">ggplot<span class="p">(</span>data<span class="o">=</span>mpg<span class="p">,</span> mapping<span class="o">=</span>aes<span class="p">(</span>x<span class="o">=</span>cty<span class="p">,</span> y<span class="o">=</span>hwy<span class="p">,</span> colour<span class="o">=</span><span class="kp">factor</span><span class="p">(</span>year<span class="p">)))</span> <span class="o">+</span>
</span><span class="line">geom_point<span class="p">()</span> <span class="o">+</span> stat_smooth<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><code class="language-r">ggplot()</code>: <strong>data</strong> is a <span style="color:blue">data.frame</span> class object. <strong>mapping</strong> is an <code class="language-r">aes()</code> function to specify the X-axis and Y-axis. When a <code class="language-r">aes()</code> is used, a figure legend will be added. If we do not want the legends appear, use <code class="language-r">show_guide = FALSE</code> in <em>geom_XXX</em> or <em>stat_XXX</em></p>

<p><code class="language-r">geom_point()</code>: is used to plot points with the attributes <strong>x</strong>, <strong>y</strong>, alpha, colour, fill, shape, size.</p>

<p><code class="language-r">geom_line()</code>: is used to plot points with the attributes <strong>x</strong>, <strong>y</strong>, alpha, colour, fill, shape, size.</p>

<p><code class="language-r">geom_bar()</code>: bar plot. <code class="language-r">stat = 'identity'</code> for draw the identical, <code class="language-r">hjust</code> and <code class="language-r">vjust</code> is to adjust the x and y axis distance. <code class="language-r">coord_flip()</code> to reverse X and Y axis. <code class="language-r">position = 'dodge'</code> to set position of two bars, can be set as ‘dodge’, ‘stack’, ‘fill’ and ‘identity’.</p>

<p><code class="language-r">geom_box()</code>: boxplot.</p>

<p><code class="language-r">geom_tile()</code>: fill blocks.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1"># example</span>
</span><span class="line"><span class="kn">require</span><span class="p">(</span><span class="s">&#39;ggplot2&#39;</span><span class="p">)</span>
</span><span class="line">p <span class="o">&lt;-</span> ggplot<span class="p">(</span>mtcars<span class="p">,</span> aes<span class="p">(</span><span class="kp">factor</span><span class="p">(</span>cyl<span class="p">),</span> mpg<span class="p">))</span>
</span><span class="line"><span class="c1"># basic plot</span>
</span><span class="line">p <span class="o">+</span> geom_boxplot<span class="p">()</span>
</span><span class="line"><span class="c1"># add colors to boxes</span>
</span><span class="line">p <span class="o">+</span> geom_boxplot<span class="p">(</span>aes<span class="p">(</span>fill <span class="o">=</span> <span class="kp">factor</span><span class="p">(</span>cyl<span class="p">)))</span>
</span><span class="line"><span class="c1"># change default colors</span>
</span><span class="line">p <span class="o">+</span> geom_boxplot<span class="p">(</span>aes<span class="p">(</span>fill <span class="o">=</span> <span class="kp">factor</span><span class="p">(</span>cyl<span class="p">)))</span> <span class="o">+</span> scale_fill_manual<span class="p">(</span>values <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="s">&#39;blue&#39;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><code class="language-r">geom_rect(mapping = NULL, data = NULL, stat = "identity", position = "identity", ...)</code>: plot rectangles. 
In <code class="language-r">aes()</code>, <code class="language-r">xmin</code>, <code class="language-r">xmax</code>, <code class="language-r">ymin</code>, and <code class="language-r">ymax</code> are necessary. 
<code class="language-r">inherit.aes = FALSE</code> may be used if new <code class="language-r">data</code> is applied.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1"># example</span>
</span><span class="line">ggplot<span class="p">(</span>mtcars<span class="p">)</span> <span class="o">+</span>
</span><span class="line">  geom_density<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>disp<span class="p">,</span> group<span class="o">=</span>cyl<span class="p">,</span> fill<span class="o">=</span>cyl<span class="p">),</span> alpha<span class="o">=</span><span class="m">0.6</span><span class="p">,</span> adjust<span class="o">=</span><span class="m">0.75</span><span class="p">)</span> <span class="o">+</span>
</span><span class="line">  geom_rect<span class="p">(</span>data<span class="o">=</span>mtcars<span class="p">[</span><span class="m">1</span><span class="p">,],</span> aes<span class="p">(</span>xmin<span class="o">=</span><span class="m">100</span><span class="p">,</span> xmax<span class="o">=</span><span class="m">200</span><span class="p">,</span> ymin<span class="o">=</span><span class="m">0</span><span class="p">,</span>ymax<span class="o">=</span><span class="kc">Inf</span><span class="p">),</span> fill<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span> alpha<span class="o">=</span><span class="m">0.2</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="statistics">1.2 Statistics</h3>

<p><code class="language-r">geom_smooth()</code>: is used for the add smooth line with the <strong>method</strong> lm, glm, gam, loess and rlm. <code class="language-r">se = TRUE</code> is to display the confident region. The following aesthetics <strong>x</strong>, <strong>y</strong>, alpha, colour, fill, linetype, size, weight could be added.</p>

<p><code class="language-r">stat_boxplot()</code>: plot error lines in boxplot.</p>

<h3 id="add-elements">1.3 Add elements</h3>

<p><code class="language-r">xlab()</code>: change X axis label, set <code>xlab('')</code> to remove the X axis label; <code class="language-r">ylab()</code>: change Y axis label; <code class="language-r">ggtitle()</code>: add figure title; <code class="language-r">scale_y_continuous(limits=c(0, 20))</code> and <code class="language-r">scale_x_continuous(limits=c(0, 20))</code> to adjust range of X and Y axis.</p>

<p><code class="language-r">geom_abline(intercept = 37, slope = -5)</code>: to add line.</p>

<p><code class="language-r">geom_hline</code> and <code class="language-r">geom_vline</code>: to add horizontal and vertical lines.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1"># example </span>
</span><span class="line">p <span class="o">&lt;-</span> ggplot<span class="p">(</span>mtcars<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> wt<span class="p">,</span> y <span class="o">=</span> mpg<span class="p">))</span> <span class="o">+</span> geom_point<span class="p">()</span>
</span><span class="line">geom_vline<span class="p">(</span>xintercept <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> colour<span class="o">=</span><span class="s">&quot;green&quot;</span><span class="p">,</span> linetype <span class="o">=</span> <span class="s">&quot;longdash&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1"># ggplot2 line type</span>
</span><span class="line">d <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>lt<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;blank&#39;</span><span class="p">,</span> <span class="s">&#39;solid&#39;</span><span class="p">,</span> <span class="s">&#39;dashed&#39;</span><span class="p">,</span> <span class="s">&#39;dotted&#39;</span><span class="p">,</span> <span class="s">&#39;dotdash&#39;</span><span class="p">,</span> <span class="s">&#39;longdash&#39;</span><span class="p">,</span> <span class="s">&#39;twodash&#39;</span><span class="p">,</span> <span class="s">&#39;1F&#39;</span><span class="p">,</span> <span class="s">&#39;F1&#39;</span><span class="p">,</span> <span class="s">&#39;4C88C488&#39;</span><span class="p">,</span> <span class="s">&#39;12345678&#39;</span><span class="p">))</span>
</span><span class="line">ggplot<span class="p">()</span> <span class="o">+</span>
</span><span class="line">  scale_x_continuous<span class="p">(</span>name<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> limits<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> breaks<span class="o">=</span><span class="kc">NULL</span><span class="p">)</span> <span class="o">+</span>
</span><span class="line">  scale_y_discrete<span class="p">(</span>name<span class="o">=</span><span class="s">&#39;linetype&#39;</span><span class="p">)</span> <span class="o">+</span>
</span><span class="line">  scale_linetype_identity<span class="p">()</span> <span class="o">+</span>
</span><span class="line">  geom_segment<span class="p">(</span>data<span class="o">=</span>d<span class="p">,</span> mapping<span class="o">=</span>aes<span class="p">(</span>x<span class="o">=</span><span class="m">0</span><span class="p">,</span> xend<span class="o">=</span><span class="m">1</span><span class="p">,</span> y<span class="o">=</span>lt<span class="p">,</span> yend<span class="o">=</span>lt<span class="p">,</span> linetype<span class="o">=</span>lt<span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><code class="language-r">geom_text()</code>: to add text. Set <code>parse = TRUE</code> to use expression and greek letters.</p>

<p><code class="language-r">scale_fill_discrete(..., values)</code>: change labels. <code class="language-r">name</code> to reset label names, <code class="language-r">labels</code> to reset labels.</p>

<p><code class="language-r">scale_shape_manual(..., values)</code>: change the shape of points.</p>

<p><code class="language-r">scale_linetype_manual(..., values)</code>: change the types of lines. line referring <a href="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/">R plot</a>.<code>name</code>, <code>value</code>, <code>labels</code> are used to change value.</p>

<p><code class="language-r">scale_color_manual</code> is used for change the colors. Please refer to <a href="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/">Useful color palette</a>, <a href="http://blog.ggplot2.org/post/24607351280/choosing-colour-palettes-part-ii-educated-choices">Introduction of ggplot2 colors</a>, and <a href="http://research.stowers-institute.org/efg/R/Color/Chart/">R Color Chart</a> 
. The default ggplot2 colors are generated from the “<em>scales</em>” package, for example the default “hue pallet” could be view as <code class="language-r">show_col(hue_pal(h = c(0, 360) + 15, c = 100, l = 65, h.start = 0, direction = 1)(9))</code></p>

<p><code class="language-r">scale_fill_manual(..., alues)</code> to change filled colors.</p>

<p><code class="language-r">theme</code> is used for exact control. <code>legend.position='none'</code> to remove the side legend.</p>

<h2 id="save-plot">2. Save plot</h2>

<p>The function <code class="language-r">ggsave()</code> is used to save the screen plot to file. <code class="language-r">print()</code> is also applied like:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">pdf<span class="p">(</span><span class="s">&#39;testfile.pdf&#39;</span><span class="p">)</span>
</span><span class="line">q <span class="o">&lt;-</span> ggplot<span class="p">()</span>
</span><span class="line"><span class="kp">print</span><span class="p">(</span><span class="kp">q</span><span class="p">)</span>
</span><span class="line">dev.off<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="other-issues">3. Other issues</h2>

<h3 id="plot-mutiple-ggplot2">3.1 Plot mutiple ggplot2</h3>

<p>Use <span style="color: blue">gridExtra</span> package to plot multiple ggplot2 figures in the one figure.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1"># example</span>
</span><span class="line"><span class="kn">require</span><span class="p">(</span><span class="s">&#39;gridExtra&#39;</span><span class="p">)</span>
</span><span class="line"><span class="c1"># save ggplot object into a list like &quot;plotList&quot;</span>
</span><span class="line"><span class="kp">do.call</span><span class="p">(</span>grid.arrange<span class="p">,</span> plotList<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="a-idrefa"><a id="Ref">参考网址</a></h3>

<ul>
  <li><a href="http://directlabels.r-forge.r-project.org/examples.html">Better labels</a></li>
  <li><a href="http://docs.ggplot2.org/current/">ggplot2 doc</a></li>
  <li><a href="http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/#working-with-colors">ggplot2 cheatsheet</a></li>
</ul>

<h3 id="section">更新记录</h3>

<p>2014年8月28日</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[生物信息学工具网址]]></title>
    <link href="http://yulongniu.github.io/blog/2013/06/19/bioinfor-tools/"/>
    <updated>2013-06-19T04:42:10+08:00</updated>
    <id>http://yulongniu.github.io/blog/2013/06/19/bioinfor-tools</id>
    <content type="html"><![CDATA[<h2 id="section">1. 基因组注释信息</h2>

<ul>
  <li>
    <p><a href="ftp://ftp.ncbi.nih.gov/genomes/">NCBI ftp 下载基因组</a></p>
  </li>
  <li>
    <p><a href="http://www.jcvi.org/cms/home/">Craig Venter Institute</a></p>
  </li>
  <li>
    <p><a href="http://useast.ensembl.org/info/data/ftp/index.html">Ensembl</a></p>
  </li>
</ul>

<h2 id="section-1">2. 进化树</h2>

<ul>
  <li>
    <p>进化树展示</p>

    <ul>
      <li>
        <p><a href="http://en.wikipedia.org/wiki/List_of_phylogenetic_tree_visualization_software">Wiki software list</a></p>
      </li>
      <li>
        <p><a href="https://www.biostars.org/p/2438/">Biostats总结</a></p>
      </li>
      <li>
        <p><a href="http://itol.embl.de/index.shtml">iTOL</a></p>
      </li>
      <li>
        <p><a href="http://ab.inf.uni-tuebingen.de/software/dendroscope/welcome.html">Dendroscope</a></p>
      </li>
    </ul>
  </li>
</ul>

<!--more-->

<ul>
  <li>
    <p>进化树构建</p>

    <ul>
      <li>
        <p><a href="http://sco.h-its.org/exelixis/web/software/raxml/index.html">RAxML</a></p>
      </li>
      <li>
        <p><a href="http://www.atgc-montpellier.fr/phyml/">PhyML</a></p>
      </li>
      <li>
        <p><a href="http://evolution.genetics.washington.edu/phylip.html">PHYLIP</a>，在PHYLIP的<a href="http://evolution.genetics.washington.edu/phylip/general.html">介绍</a>中，列出了六个高使用率的构建进化树的软件，MrBayes、PAUP*、RAxML、PhyML、MEGA和PHYLIP。</p>
      </li>
    </ul>
  </li>
  <li>
    <p>时间尺度进化树</p>
  </li>
  <li>
    <p><a href="http://www.timetree.org/about.php">TimeTree</a></p>
  </li>
  <li>
    <p>sRNA数据库</p>

    <ul>
      <li>
        <p><a href="http://www.arb-silva.de/">16S/23S数据库</a></p>
      </li>
      <li>
        <p><a href="http://greengenes.lbl.gov/cgi-bin/nph-index.cgi">细菌16S数据库</a></p>
      </li>
      <li>
        <p><a href="http://rdp.cme.msu.edu/index.jsp">真核生物rRNA</a></p>
      </li>
    </ul>
  </li>
  <li>
    <p>数据格式转换</p>

    <ul>
      <li>
        <p><a href="http://sco.h-its.org/exelixis/web/software/raxml/index.html">fasta转换为Phylip</a></p>
      </li>
      <li>
        <p>进化树newick和nexus格式转换</p>

        <ol>
          <li>R package <span style="color: blue">ape</span>，提供了函数<code class="language-r">read.tree()</code>/<code class="language-r">write.tree()</code>，<code class="language-r">read.nexus()</code>/<code class="language-r">read.nexus()</code>。</li>
        </ol>
      </li>
      <li>
        <p><a href="http://www.phylogeny.fr/version2_cgi/data_converter.cgi">通用格式转换工具</a></p>
      </li>
    </ul>
  </li>
</ul>

<h2 id="section-2">3. 网络可视化</h2>

<ul>
  <li>
    <p><a href="http://www.cytoscape.org/">Cytoscape</a></p>
  </li>
  <li>
    <p><a href="http://www.biolayout.org/">3D网络BioLayout Expression3D</a></p>
  </li>
  <li>
    <p><a href="http://visant.bu.edu/">VisAnt</a></p>
  </li>
  <li>
    <p><a href="http://circos.ca/">Circos</a></p>
  </li>
</ul>

<h2 id="section-3">4. 序列比对</h2>

<ul>
  <li>
    <p><a href="http://www.clustal.org/">Clustal</a></p>
  </li>
  <li>
    <p><a href="ftp://ftp.ncbi.nlm.nih.gov/blast/executables/LATEST/">Blast</a></p>
  </li>
  <li>
    <p><a href="http://blast.ncbi.nlm.nih.gov/Blast.cgi?PAGE_TYPE=BlastDocs&amp;DOC_TYPE=Download">Blast+</a></p>
  </li>
  <li>
    <p><a href="http://www.ebi.ac.uk/Tools/msa/">EBI总结</a></p>
  </li>
  <li>
    <p><a href="http://mafft.cbrc.jp/alignment/server/">MAFFT</a></p>
  </li>
  <li>
    <p><a href="http://www.drive5.com/muscle/">MUSCLE</a></p>
  </li>
  <li>
    <p><a href="http://www.tcoffee.org/">T-Coffee</a></p>
  </li>
  <li>
    <p><a href="http://www.megasoftware.net/">MEGA</a></p>
  </li>
</ul>

<h2 id="section-4">5. 质谱分析</h2>

<ul>
  <li>
    <p><a href="http://www.thegpm.org/TANDEM/">X!Tandem</a></p>
  </li>
  <li>
    <p><a href="http://bacteria.thegpm.org/tandem/thegpm_tandem.html">X!Tandem bacterial</a></p>
  </li>
  <li>
    <p><a href="http://prospector2.ucsf.edu/prospector/mshome.htm">ProteinProspector</a></p>
  </li>
  <li>
    <p><a href="http://strimmerlab.org/notes/mass-spectrometry.html">R packages list</a></p>
  </li>
  <li>
    <p><a href="http://www.matrixscience.com/">Mascot</a></p>
  </li>
</ul>

<h2 id="section-5">6. 基因注释</h2>

<ul>
  <li>
    <p><a href="http://www.ncbi.nlm.nih.gov/IEB/Research/Acembly/index.html">Acembly</a></p>
  </li>
  <li>
    <p><a href="http://rest.kegg.jp/list/hsa">KEGG</a></p>
  </li>
  <li>
    <p><a href="http://www.pantherdb.org/">PANTHER</a></p>
  </li>
</ul>

<h2 id="section-6">7. 基因名转换</h2>

<ul>
  <li>
    <p><a href="http://biodbnet.abcc.ncifcrf.gov/db/db2db.php">bioDBnet</a></p>
  </li>
  <li>
    <p><a href="http://www.ncbi.nlm.nih.gov/COG/">COG</a></p>
  </li>
  <li>
    <p><a href="http://idconverter.bioinfo.cnio.es/IDconverter.php">IDconverter</a></p>
  </li>
  <li>
    <p><a href="http://www.uniprot.org/">uniprot</a></p>
  </li>
  <li>
    <p><a href="http://david.abcc.ncifcrf.gov/home.jsp">DAVID</a></p>
  </li>
  <li>
    <p><a href="http://www.ncbi.nlm.nih.gov/books/NBK179288/">NCBI E-utilities</a></p>
  </li>
</ul>

<h2 id="section-7">8. 结构域分析</h2>

<ul>
  <li>
    <p><a href="http://www.ncbi.nlm.nih.gov/Structure/bwrpsb/bwrpsb.cgi">CDD</a></p>
  </li>
  <li>
    <p><a href="http://pfam.sanger.ac.uk/">pfam</a></p>
  </li>
</ul>

<h2 id="transcription-unit">9. 原核生物Transcription Unit查询</h2>

<ul>
  <li>
    <p><a href="http://biocyc.org/">BioCyc</a></p>
  </li>
  <li>
    <p><a href="http://operons.ibt.unam.mx/OperonPredictor/">ProOpDB</a></p>
  </li>
</ul>

<h2 id="section-8">10. 探针设计</h2>

<ul>
  <li><a href="http://www.arb-home.de/">ARB</a></li>
</ul>

<h2 id="section-9">11. 统计学网址</h2>

<p><a href="http://www.math.uah.edu/stat/bernoulli/Binomial.html">Virtual Laboratories in Probability and Statistics</a></p>

<h2 id="section-10">12. 生物学通路数据库</h2>

<ul>
  <li>
    <p><a href="http://www.genome.jp/kegg/">KEGG</a></p>
  </li>
  <li>
    <p><a href="http://biocyc.org/">BioCyc</a></p>
  </li>
  <li>
    <p><a href="http://www.reactome.org/">Reactome</a></p>
  </li>
  <li>
    <p><a href="http://www.grenoble.prabi.fr/obiwarehouse/unipathway">Unipathway</a></p>
  </li>
  <li>
    <p><a href="http://pid.nci.nih.gov/">PID</a></p>
  </li>
  <li>
    <p><a href="http://biochemical-pathways.com/">Biochemical-pathways</a></p>
  </li>
  <li>
    <p><a href="http://lsresearch.thomsonreuters.com/maps/">Pathway Maps</a></p>
  </li>
  <li>
    <p><a href="http://www.biocarta.com/genes/index.asp">BioCarta</a></p>
  </li>
  <li>
    <p><a href="http://www.genmapp.org/">GenMAPP</a></p>
  </li>
</ul>

<h2 id="section-11">13. 转录调控数据库</h2>

<ul>
  <li>
    <p><a href="http://regprecise.lbl.gov/RegPrecise/index.jsp">RegPrecise</a> 原核生物“转录因子–下游基因”数据库。</p>
  </li>
  <li>
    <p><a href="http://dbtbs.hgc.jp/">DBTBS</a> 转录因子和相应的DNA结合保守（DNA binding motif）数据库。</p>
  </li>
</ul>

<h2 id="section-12">14. 基因序列可视化</h2>

<ul>
  <li>
    <p><a href="http://ibs.biocuckoo.org/">Illustrator for Biological Sequences (IBS)</a></p>
  </li>
  <li>
    <p><a href="http://dog.biocuckoo.org/">DOG</a> 可视化蛋白质结构域</p>
  </li>
</ul>

<h2 id="section-13">文章介绍</h2>

<ul>
  <li>
    <p><a href="http://www.nature.com/nrm/journal/v8/n12/abs/nrm2281.html">未知蛋白功能研究流程</a></p>
  </li>
  <li>
    <p>蛋白质相互作用 <a href="http://www.ploscompbiol.org/article/info:doi/10.1371/journal.pcbi.0030042">1</a>, <a href="http://www.ploscompbiol.org/article/info:doi/10.1371/journal.pcbi.0030043">2</a></p>
  </li>
  <li>
    <p><a href="http://cshprotocols.cshlp.org/content/2008/4/pdb.ip49.full">进化树方法选择</a></p>
  </li>
  <li>
    <p><a href="http://www.plosone.org/article/info:doi/10.1371/journal.pone.0002566">构建进化树</a></p>
  </li>
</ul>

<h2 id="section-14">书籍推荐</h2>

<ul>
  <li><a href="http://a-little-book-of-r-for-bioinformatics.readthedocs.org/en/latest/index.html">a Little Book of R for Bioinformatics</a> 一本使用R语言介绍生物信息学书，提供源代码和示例。</li>
</ul>

<h3 id="section-15">更新记录</h3>

<p>2015年6月6日</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Emacs高级使用技巧]]></title>
    <link href="http://yulongniu.github.io/blog/2012/06/25/emacs-extend-skills/"/>
    <updated>2012-06-25T08:01:36+08:00</updated>
    <id>http://yulongniu.github.io/blog/2012/06/25/emacs-extend-skills</id>
    <content type="html"><![CDATA[<h2 id="emacs">1. Emacs配置文件位置</h2>

<p>在Fedora系统下，Emacs的配置文件位置是<code class="language-bash">~/.emacs</code>。在Emacs配置文件中添加内容后，使用<code class="language-emacs-lisp">M-x eval-buffer</code>，使当前配置生效。编译代码以加快加载速度，<code class="language-eamcs-lisp">M-x byte-compile-file</code>。</p>

<p>使用Eamcs解释器<code class="language-emacs-lisp">M-x ielm</code>。</p>

<h2 id="emacs-1">2. Emacs自带的包管理系统</h2>

<p>在Emacs24之后，自带包管理系统，使用<code class="language-bash">M-x eval-buffer</code>进入。可以添加<a href="http://melpa.org/">MELPA源</a>、<a href="https://marmalade-repo.org/">marmalade源</a>、<a href="http://elpa.gnu.org/packages/">GNU源</a>。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Add repositories of Emacs packages</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="emacs-lisp"><span class="line"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;package</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;package-archives</span>
</span><span class="line">	     <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;marmalade&quot;</span> <span class="o">.</span> <span class="s">&quot;http://marmalade-repo.org/packages/&quot;</span><span class="p">))</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;package-archives</span>
</span><span class="line">	     <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;melpa&quot;</span> <span class="o">.</span> <span class="s">&quot;http://melpa.milkbox.net/packages/&quot;</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;package-archives</span>
</span><span class="line">	     <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;gnu&quot;</span> <span class="o">.</span> <span class="s">&quot;http://elpa.gnu.org/packages/&quot;</span><span class="p">)))</span>
</span><span class="line"><span class="p">(</span><span class="nv">package-initialize</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<!--more-->

<p>这样设置之后，就不需要类似<code class="language-emacs-lisp">(add-to-list 'load-path "~/.emacs.d/elpa/popup-20140207.1702/")</code>的语句了，因为Emacs会自动识别安装的包。但是，如果需要对某个包进行进一步设置，需要加上<code class="language-bash">(require 'popup)</code>之类的语句。</p>

<h2 id="section">3. 显示行号</h2>

<p>使用<code class="language-eamcs-lisp">M-x linum-mode</code>添加行号。如果需要永久显示，在Emacs配置文件中添加一下内容。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Show line number</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="emacs-lisp"><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="c1">;open linum mode</span>
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="p">(</span><span class="k">setq</span> <span class="nv">linum-format</span> <span class="s">&quot;%4d \u2502&quot;</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;prog-mode-hook</span> <span class="ss">&#39;linum-mode</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;ess-mode-hook</span> <span class="ss">&#39;linum-mode</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="shell">4. 进入Shell</h2>

<p>三种方法：</p>

<ul>
  <li>
    <p><code class="language-eamcs-lisp">M-x shell</code></p>
  </li>
  <li>
    <p><code class="language-eamcs-lisp">M-x ansi-term</code></p>
  </li>
  <li>
    <p><code class="language-eamcs-lisp">M-x eshell</code></p>
  </li>
</ul>

<h2 id="root">5. root权限</h2>

<p><code class="language-eamcs-lisp">C-x C-f</code> 之后输入root密码<code class="language-eamcs-lisp">/su:root@usrname password</code></p>

<h2 id="section-1">6. 移动整体代码块</h2>

<p>选中代码块后：
向左移动2个字符：<code class="language-eamcs-lisp">C-u -2 C-x TAB</code>
向右移动4个字符：<code class="language-eamcs-lisp">C-u 4 C-x TAB</code></p>

<h2 id="section-2">7. 添加彩虹猫</h2>

<p>添加<code>nyan-mode</code>包，之后在Emacs配置文档中写入：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Add nyan in modeline</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="emacs-lisp"><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="c1">;nyan-mode</span>
</span><span class="line"><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
</span><span class="line"><span class="p">(</span><span class="nv">nyan-mode</span> <span class="no">t</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="yasnippet">8. 自定义YASnippet模板</h2>

<p>使用<code class="language-emacs-lisp">M-x yas-new-snippet</code>，打开一个模板。比如，添加Octopress的语言高亮模板</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class=""><span class="line"># -*- mode: snippet; require-final-newline: nil -*-
</span><span class="line"># name: Highlight Language
</span><span class="line"># key: hl
</span><span class="line"># binding: direct-keybinding
</span><span class="line"># contributor: Yulong Niu &lt;yulong.niu@aol.com&gt;
</span><span class="line"># --
</span><span class="line">
</span><span class="line">{% codeblock lang:${1:bash} %}
</span><span class="line">$0
</span><span class="line">{% endcodeblock %}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>其中 <code class="languag-emacs-lisp">${1:bash}</code>表示光标跳转位置，编号从1开始。<code class="language-emacs-lisp">$0</code>表示光标最后停留位置。如果不需要插入空行，在模板中把多余空行去掉。</p>

<p>自定义的模板建议存放与 <code class="language-bash">~/.emacs.d/snippets/</code>的对应mode文件夹下。比如在markdown模式下使用的模板，存放与 <code class="language-bash">~/.emacs.d/snippets/markdown-mode/</code>。</p>

<h3 id="section-3">参考资料</h3>

<ul>
  <li>
    <p><a href="http://capitaomorte.github.io/yasnippet/">YASnippet Tutorial</a></p>
  </li>
  <li>
    <p><a href="http://www.cnblogs.com/ibgo/p/3900317.html">自定义 Yasnippet 模板</a></p>
  </li>
  <li>
    <p><a href="https://github.com/mad4alcohol/mad4a-blog/blob/master/_posts/2012-08-02-emacs-summary-cont.md">YASnippet添加模板</a></p>
  </li>
</ul>

<h3 id="section-4">更新记录</h3>

<p>2015年5月9日</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[R包制作和roxygen2使用说明]]></title>
    <link href="http://yulongniu.github.io/blog/2012/05/30/r-package-and-roxygen2/"/>
    <updated>2012-05-30T07:46:59+08:00</updated>
    <id>http://yulongniu.github.io/blog/2012/05/30/r-package-and-roxygen2</id>
    <content type="html"><![CDATA[<p>查看创建R包的各种细节，权威的文献是<a href="http://cran.r-project.org/doc/manuals/r-release/R-exts.html">Writing R Extensions</a>。</p>

<h2 id="r">1. 创建R包目录</h2>

<p>像盖房子一样，创建R包需要先搭建一个骨架，这个骨架往往是固定的，即一些文件夹（如<code>R</code>，<code>man</code>等）和文件（如<code>DESCRIPTION</code>，<code>NAMESPACE</code>）是必须的，而另外一些则可选择性添加。一个典型的R包目录,比如<span style="color: blue">Biobase</span>包，如下图：</p>

<!--more-->

<p><img class="middle" src="http://yulongniu.github.io/images/r_catalog.png" width="350" height="300" title="Biobase catalog #1" alt="a snap of Biobase catalog" /></p>

<h3 id="description">1.1 <code>DESCRIPTION</code>文件</h3>

<p>一个纯文本ASCII文件，其中Package, Version, License, Description, Title, Author和Maintainer是必备条目，一个例子<span style="color: blue">knitr</span>包的<code>DESCRIPTION</code>文件：</p>

<ul>
  <li>
    <p>Package：由字母、数字和“点”构成的，至少含有两个字符，第一个必须是字母，结束不能用“点”（这也是包名称的命名规范）。</p>
  </li>
  <li>
    <p>Version：版本号，经典的命名方式比如0.1-0。</p>
  </li>
  <li>
    <p>License：GPL。</p>
  </li>
  <li>
    <p>Description：一段话描述包主要的功能。</p>
  </li>
  <li>
    <p>Title：包的一句话解释。</p>
  </li>
  <li>
    <p>Author和Maintainer：包的作者和维护者，姓+名 （比如Karl Pearson ）。也可以使使用Author@R描述作者，使用R函数<code class="language-r">person()</code>，其中变量<code>role</code>的选项<code>aut</code>表示author，<code>cre</code>表示creator（维护者），<code>ctb</code>表示contributor。一个例子：</p>
  </li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="kt">c</span><span class="p">(</span>person<span class="p">(</span><span class="s">&quot;Hadley&quot;</span><span class="p">,</span> <span class="s">&quot;Wickham&quot;</span><span class="p">,</span> email <span class="o">=</span> <span class="s">&quot;hadley@rice.edu&quot;</span><span class="p">,</span> role <span class="o">=</span><span class="s">&quot;ctb&quot;</span><span class="p">),</span>
</span><span class="line">person<span class="p">(</span><span class="s">&quot;Yihui&quot;</span><span class="p">,</span> <span class="s">&quot;Xie&quot;</span><span class="p">,</span> email <span class="o">=</span> <span class="s">&quot;xie@yihui.name&quot;</span><span class="p">,</span> role <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;aut&quot;</span><span class="p">,</span> <span class="s">&quot;cre&quot;</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>
    <p>Date（可选）：当前版本包日期，格式yyyy-mm-dd。</p>
  </li>
  <li>
    <p>Depends（可选）：依赖的R环境版本和包名称，比如 <code>R (&gt;= 2.14.1)</code>。</p>
  </li>
</ul>

<p><span style="color: blue">注意：</span></p>

<blockquote>
  <ol>
    <li>
      <p>加上版本号，没有版本号等于没用，因为版本之间可能差异很大；</p>
    </li>
    <li>
      <p>对于<span style="color: blue">base</span>等这样的包就不用写了，因为是必然依赖的，同时也是R启动自动载入的。对于依赖的包名称，在R 2.14.0之后完全没有必要写，因为从这个版本后，所有包都有<code>NAMESPACE</code>，直接使用<code>Imports</code>就可以了。</p>
    </li>
  </ol>
</blockquote>

<ul>
  <li>
    <p>Imports（可选）：如果只是使用某些包中类、方法或者（一般）函数，而不用完全载入包，可以在此栏列出包的名称，最好加上版本号（在<code class="language-bash">R CMD check</code>会检查版本）。在代码中，引用其他包的namespace可以使用<code>::</code>或者<code>:::</code>操作符。与之对应的，需要在<code>NAMESPACE</code>文件中指明引用（见后）。</p>
  </li>
  <li>
    <p>Suggests（可选）：如果只是在帮助文档的<code>examples</code>，<code>tests</code>或者vignettes中用到了一些包，那么没有必要“依赖”或者“引用”，只用“建议”安装即可。版本号同样也要加上，在<code class="language-bash">R CMD check</code>时会用到。当然，我们要考虑到如果读者也想重现一下<code class="language-bash">examples/tests/vignettes</code>的例子，最好使用<code class="languag-r">if(require(pkgname)))</code>的条件句控制：<code class="languag-r">TRUE</code>执行，<code class="languag-r">FALSE</code>返回错误。</p>
  </li>
  <li>
    <p>Enhances（可选）：这个条目中的包可以被这个正在创建的包“增强”功能，比如我们创建的这个包为（对列表中的包）提供了更好的方法、更优秀的处理手段等。</p>
  </li>
  <li>
    <p>URL（可选）：一系列相关的网址，使用“逗号”或者空格隔开。链接可能是作者的主页、包的补充材料等。</p>
  </li>
  <li>
    <p>BugReports（可选）：一个网址，用于提交bug，代替了向作者发邮件。一个好的想法是使用<a href="https://github.com/">Github</a>，在项目的issures版块提交bug。</p>
  </li>
  <li>
    <p>Collate（可选）：看不懂。</p>
  </li>
  <li>
    <p>KeepSource（可选）：逻辑值，设定为<code class="languag-r">TRUE</code>，表示包是源码。</p>
  </li>
  <li>
    <p>ByteCompile（可选）：逻辑值，目前默认设置为否；如果性能确实可以得到提升，可以选择<code class="languag-r">TRUE</code>，但这可能增加安装时间和体积。</p>
  </li>
  <li>
    <p>BuildVignettes（可选）：如果设定位<code class="languag-r">FALSE</code>，<code class="languag-bash">R CMD build</code>不会重新编辑vignette，同时<code class="languag-bash">R CMD check</code>也不会检查。</p>
  </li>
</ul>

<h3 id="section">1.2 包目录下的各种文件夹说明</h3>

<ul>
  <li>
    <p>R文件夹：这个文件夹下放置用R语言写成的源代码，文件最好使用后缀<code>*.R</code>。</p>
  </li>
  <li>
    <p>man文件夹：man文件夹下放置<code>*.Rd</code>结尾的文档，这写文档详细描述的函数的用途。如果使用roxygen2，就不需要建立这个文件夹。</p>
  </li>
  <li>
    <p>src文件夹：放置用其他语言写成的代码，比如C/C++/Fortran等。</p>
  </li>
  <li>
    <p>data文件夹：放置一些data文件，比如R代码、表格（<code>*txt</code>/<code>*.tab</code>/<code>*.csv</code>）文件或者是用<code class="language-r">save()</code>函数保存的镜像（<code>*.RData</code>/<code>*.rda</code>）。这些文件必须是“自给自足”的，即不用调用包也能使用这些data。如果这些data比较大，可以将其压缩为<code>*.gzip</code>/<code>*.bzip2</code>/<code>*.xz</code>格式，或者在保存镜像时，使用<code class="language-r">save(, compress = TRUE)</code>。这些方法可以有效地减少包的体积和安装时间，以方便用户使用。</p>
  </li>
  <li>
    <p>demo文件夹：放置一些包的示例，通过<code>demo()</code>函数访问。（需要有一个00Index文件？不能自动生成？）</p>
  </li>
  <li>
    <p>exec文件夹：放置脚本文件比如shell、Perl、Python、Tcl等。</p>
  </li>
  <li>
    <p>inst文件夹：包在编译安装中，会将这个文件下的文件放入包的根目录下，所以可以放包的更新文件NEWS（或者CHANGELOG）文件、用于引用的CITATION文件等。还有很重要的子文件夹是doc，vignette文件就放在此处，格式为*.Rnw，这个文件会进一步被编程成LaTeX文件，最后生成常见的PDF文档。现在Swear过时了，用<span style="color: blue">knitr</span>吧。</p>
  </li>
</ul>

<h2 id="namespace">2. <code>NAMESPACE</code>文件</h2>

<h3 id="section-1">2.1 文件说明</h3>

<p><code>NAMESPACE</code>文件非常重要，因为它指明哪些函数是“输出（export）”给用户使用，哪些又是从其他包中“输入（import）”的。如果作者没有指明这个文件，那么在创建包时会被自动创建，此时所有的对象都被输出，在<code>Imports</code>和<code>Depends</code>下的包全部被输入。</p>

<p><strong>“输出”格式</strong>：<code class="language-r">export(f, g)</code>，其中<code class="language-r">f</code>和<code class="language-r">g</code>是变量名，一般不用引号括起。也可以使用正则表达式批量输出，比如 <code class="language-r">exportPattern("^[^\\.]")</code>。</p>

<p><strong>“输入”格式</strong>：<code class="language-r">import(for, bar)</code>，其中<code class="language-r">for</code>和<code class="language-r">bar</code>是包名称，这样做会导致<code class="language-r">for</code>和<code class="language-r">bar</code>中所有的输出对象都被引用。如果我们只想引用其中的某几个对象， 可以使用<code class="language-r">importFrom(foo, f, g)</code>，其中<code class="language-r">f</code>和<code class="language-r">g</code>是<code class="language-r">foo</code>包的变量名。<span style="color: blue">Base</span>包的命名空间被默认引用。当然，也可以输出其他包的变量，前提是这些变量需要先被输入。</p>

<h3 id="s3">2.2 S3类</h3>

<p><code class="language-r">S3method(Mymethod, Myclass)</code></p>

<h3 id="s4">2.3 S4类</h3>

<p><strong>“输出”格式</strong>：如果创建的S4类需要被外部调用，使用<code class="language-r">exportClasses(Myclass1, Myclass2)</code>，同样可以使用<code class="language-r">exportClassPattern()</code>批量输出。对于S4，输出“方法（methods）”也会输出“泛函（generic）”，输出泛函同样也会输出方法。如果一个方法，在要创建的包中没有找到对应的方法，有两种可能的情况：</p>

<blockquote>
  <ol>
    <li>
      <p>泛函已经从别的包中输入，比如<code class="language-r">importMethods()</code>；</p>
    </li>
    <li>
      <p>从别的包中输入函数，但被转换为默认方法，比如<code class="language-r">importFrom("graphics", plot)</code>，<code class="language-r">plot()</code>函数又被分配其他的方法，这种情况下输入自己包的<code class="language-r">plot()</code>函数，使用<code class="language-r">exportMethods(plot)</code>。</p>
    </li>
  </ol>
</blockquote>

<p><strong>“输入”格式</strong>：输入某个包的全部类或者特定的类，<code class="language-r">ImportClasses(pkg)</code>或者<code class="language-r">ImportClassesFrom(pkg, class1)</code>；输入某个包全部方法或者特定方法，<code class="language-r">ImportMethods(pkg)</code>或者<code class="language-r">ImportMethodsFrom(pkg, method1)</code>。</p>

<p><span style="color: blue">stats4</span>给出的例子非常好，R 2.15.0之后，对隐式泛函要求严格，必须先输入显示函数：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">  export<span class="p">(</span>mle<span class="p">)</span>
</span><span class="line">  importFrom<span class="p">(</span><span class="s">&quot;graphics&quot;</span><span class="p">,</span> plot<span class="p">)</span>
</span><span class="line">  importFrom<span class="p">(</span><span class="s">&quot;stats&quot;</span><span class="p">,</span> optim<span class="p">,</span> qchisq<span class="p">)</span>
</span><span class="line">  <span class="c1">## For these, we define methods or (AIC, BIC, nobs) an implicit generic: </span>
</span><span class="line">  importFrom<span class="p">(</span><span class="s">&quot;stats&quot;</span><span class="p">,</span> AIC<span class="p">,</span> BIC<span class="p">,</span> coef<span class="p">,</span> confint<span class="p">,</span> logLik<span class="p">,</span> nobs<span class="p">,</span> profile<span class="p">,</span> update<span class="p">,</span> vcov<span class="p">)</span>   exportClasses<span class="p">(</span>mle<span class="p">,</span> profile.mle<span class="p">,</span> summary.mle<span class="p">)</span>
</span><span class="line">  <span class="c1">## All methods for imported generics: </span>
</span><span class="line">  exportMethods<span class="p">(</span>coef<span class="p">,</span> confint<span class="p">,</span> logLik<span class="p">,</span> plot<span class="p">,</span> profile<span class="p">,</span> <span class="kp">summary</span><span class="p">,</span> show<span class="p">,</span> update<span class="p">,</span> vcov<span class="p">)</span>
</span><span class="line">  <span class="c1">## implicit generics which do not have any methods here </span>
</span><span class="line">  export<span class="p">(</span>AIC<span class="p">,</span> BIC<span class="p">,</span> nobs<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="r-1">3. 书写R函数帮助文档</h2>

<p>书写函数文档的利器当属Emacs+ESS+<span style="color: blue">roxygen2</span>包。Emacs+ESS搭建了一个非常棒的统计学软件（R、SAS、S-Plus等）的代码编辑和运行环境，从ESS命名Emacs Speaks Statistics上就可以感受到它外漏的霸气。而<a href="http://roxygen.org/">roxygen2</a>是R的一个包，仿照Doxygen构建的工具，实现了文档和源码用一个文件共同管理的想法。</p>

<p>这个想法相当棒：</p>

<blockquote>
  <ol>
    <li>
      <p>在写代码时，方便“就地”编写文档（函数功能、参数解释、实现功能、注意事项、依赖关系和例子等）；</p>
    </li>
    <li>
      <p>在源码修改时，及时地更新文档。</p>
    </li>
  </ol>
</blockquote>

<p>对于编辑R包来说，对应的文档是<code>*.Rd</code>（R documentation）格式的文件，以下是一个框架示意图：</p>

<p><img class="middle" src="http://yulongniu.github.io/images/r_rd.png" width="600" height="600" title="Rd file #1" alt="a snap of Rd file framework" /></p>

<h3 id="span-stylecolor-blueroxygen2span">3.1 <span style="color: blue">roxygen2</span>使用注释</h3>

<ul>
  <li>
    <p><code>@title</code>：文档标题，通常是函数名缩写（比如首字母缩写）的解释。出现在该函数文档的标题位置和检索（index）目录。</p>
  </li>
  <li>
    <p><code>@aliases</code>：函数别名。这个函数的别名，如果使用，在HTML帮助文档中将出现这个别名，链接的文档还是原来函数文档；同样，<code class="language-r">?“别名”</code>也能调出帮助文件。具体参考<span style="color: blue">stats</span>包中，“Normal”是<code class="language-r">dnorm()</code>，<code class="language-r">pnorm()</code>，<code class="language-r">qnorm()</code>，<code class="language-r">rnorm()</code>三个函数的别名。</p>
  </li>
  <li>
    <p><code>@description</code>：描述，对函数进行稍微详细的描述，可以讲解函数的功能，不能有空行。出现在文档开始位置。</p>
  </li>
  <li>
    <p><code>@details</code>：函数的具体描述，啰嗦各种细节，比如在运行过程中的注意事项、输入结果解释、运用的公式等。</p>
  </li>
  <li>
    <p><code>@param</code>：各个变量（argument）的解释。</p>
  </li>
  <li>
    <p><code>@inheritParams</code>：用于需要重复解释的变量，防止过多“剪切”“复制”。比如一些变量已经在foo1解释了，而foo2需要用foo1的一些变量，就可以使用这个字段。这里的foo1可以是当前包的函数，也可以是其他包函数，比如pkg::foo1。</p>
  </li>
  <li>
    <p><code>@return</code>：函数返回的结果。如果想具体解释返回的结果，格式<code class="language-html">\item{name a}{description a}</code>。</p>
  </li>
  <li>
    <p><code>@author</code>：作者，加上作者邮件地址，格式：<code class="language-html">\email{MrR@@stat.cn}</code>。</p>
  </li>
  <li>
    <p><code>@examples</code>：给出函数使用的例子。例子非常重要，很多用户对例子的关注要远远高于其他的部分，啰啰嗦嗦说了一大堆，不如来两个漂亮的例子。我认为好的例子应该包括（但不限于）：</p>
  </li>
</ul>

<blockquote>
  <ul>
    <li>
      <p>重要参数的演示；</p>
    </li>
    <li>
      <p>参数之间的协调控制；</p>
    </li>
    <li>
      <p>特殊参数（用语言描述困难）的演示；</p>
    </li>
    <li>
      <p>可能的错误使用；</p>
    </li>
    <li>
      <p>来几张漂亮图。</p>
    </li>
  </ul>
</blockquote>

<p>这些例子可以直接使用R代码编排、“#”注释、多行也问题。这些例子可以用函数<code class="language-r">example()</code>运行。如果不想运行某些例子（比如演示错误使用等），格式：<code class="language-html">\dontrun{Rcode}</code>。如果例子中依赖其他包，使用<code class="language-r">if(require(pkg)){ }</code>格式。</p>

<p>也可以在包的根目录下建立文件，通过<code class="language-r">@example path/relative/to/packge/root</code>引用。如果函数不需要输出，则不用添加<code>@example</code>，否则在R包检查中会报错。</p>

<ul>
  <li>
    <p><code>@references</code>： 参考文献，比如算法出处、函数编写思路、例子的参考文献等。如果想多行出现，只需再用一次<code>@references</code>即可。如果要网址，格式为<code class="language-html">\url{http://www.google.com}</code>。</p>
  </li>
  <li>
    <p><code>@seealso</code>：其他可供参考或者有联系的对象，并说明可供参考的原因。如果想在HTML中有超链接，格式为<code class="language-html">\code{\link{function}}</code>。</p>
  </li>
  <li>
    <p><code>@family</code>：为<code>@seealso</code>提供了另外一种解决方法，将需要相互引用函数编排成一个“家族（family）”，之后同一个家族的函数自动出现在see-also中。同一个函数可以属于多个不同家族。</p>
  </li>
  <li>
    <p><code>@note</code>：添加一些注释信息。</p>
  </li>
  <li>
    <p><code>@section</code>：用户自定义一个注释区（包括名称和内容）。</p>
  </li>
  <li>
    <p><code>@rdname</code>：解决了多个文档合并的问题。可以将多个函数标记为一个共同的<code class="language-html">@rdname（override name）</code>，这样在最后的HTML文档中，就可以将多个功能相似或者一个系列的函数总结在一个文档中。如果使用了<code>@rdname</code>，那么<code>@description</code>和<code>@details</code>需要在第一个函数中全部写完，<code>@title</code>也只在第一个函数中出现。</p>
  </li>
  <li>
    <p><code>@keywords internal</code>：隐藏函数，不在help文档中显示，在其他包中可以正常使用。</p>
  </li>
  <li>
    <p><code>@aliases</code>：命名一个函数的别名，将指向同一个文档；<code>@family</code>：如果几个函数共用一个family name，它们将在seealso中交叉链接；<code>@seealso</code>：其他函数的超链接；<code>@rdname</code>：将多个函数合并在一个文档中。这些标记用于在HTML帮助文档中，可能出现这些超级链接或者文档合并。</p>
  </li>
  <li>
    <p>对data文件夹下的R data file进行注释。R data file通常以.RData或者.rda作为文件名扩展。<a href="http://r-pkgs.had.co.nz/data.html#documenting-data">参考数据注释</a>。</p>
  </li>
</ul>

<h2 id="vignittes">4. 写vignittes文件</h2>

<p>推荐使用<a href="https://github.com/yihui/knitr"><span style="color: blue">knitr</span>包</a>。</p>

<h2 id="section-2">5. 检查和压缩包</h2>

<p>在提交代码之前，首先需要检查自己的代码，运行命名</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">R CMD check Mypkg
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>之后，因为R源码包（source package）的发布都是采用压缩文件（<code>*.tar.gz</code>）形式，所以需要将源代码打包，方法是运行命令</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">R CMD build Mypkg
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>当然，有时我们需要发布二进制包（binary packages）,操作方法是</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">R CMD INSTALL --build Mypkg
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>具体执行过程是：首先，在默认目录树下安装包；之后，将成功安装的包转化成（平台依赖的）二进制代码，再将二进制代码打包输出。所以，默认安装目录要有“可写”权限，如果没有，执行<code class="language-bash">R CMD INSTALL -l location --build Mypkg</code>，指定一个“可写”权限目录（location）安装。</p>

<p>CRAN很体贴地考虑了Window以外平台的作者，通过<a href="http://win-builder.r-project.org/">网站</a>上传源码包，之后编译成window平台二进制包。</p>

<p>最后是提交代码，依次执行以下命名或者操作:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">R CMD build Mypkg
</span><span class="line"><span class="c"># 检查例子（example）、检查（test）和文档输出，如果有报错或者警告，需要仔细阅读提示，原则上消除所有报错和警告</span>
</span><span class="line">R CMD check --as-cran
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>使用 ftp://CRAN.R-project.org/incoming/ （用户名： anonymous；密码：自己邮箱地址）上传自己的包，并向CRAN@R-project.org发邮件通知自己上传了包（名称、版本等）。</p>

<h2 id="section-3">注意事项</h2>

<h3 id="section-4">1. 命名</h3>

<p>给自己的包起一个漂亮的名字，注意大小写，因为一些操作系统可能对大小写不敏感。因此，为了平台兼容性，包的命名尽量不要用大小写区分；不仅如此，在包源代码文件夹下，文件命名也要注意这个问题。起了名字之后，最好到<a href="http://cran.r-project.org/web/packages/available_packages_by_name.html">R包列表</a>去看看，检查下自己包的名字是否与其他人的冲突。</p>

<h3 id="section-5">2. 名称符号</h3>

<blockquote>
  <ul>
    <li>
      <p>文件名中不允许出现如下符号<code>"</code>、 <code>*</code>、 <code>:</code>、<code>/</code>、<code>&lt;&lt;/font&gt;</code>、 <code>&gt;</code>、 <code>?</code>、 <code>\</code> 和 <code>|</code>；</p>
    </li>
    <li>
      <p>文件命名使用的字符包括 <code>A-Za-z0-9._!#$%&amp;+,;=@^(){}'[]</code>，但是不推荐使用 <code>(){}'[]$</code>；</p>
    </li>
    <li>
      <p><code>*.Rd</code>文件可以包括URL，但必须是ASCII，不能出现<code>%</code>。</p>
    </li>
  </ul>
</blockquote>

<h3 id="gnu">3. GNU版本号</h3>

<p>GNU版本命名规则：Major_Version_Number.Minor_Version_Number[.Revision_Number[.Build_Number]]。</p>

<h3 id="namespace-1">4. 关于“命名空间（namespace）”的讨论</h3>

<p>在制作R包时候，有两种方法可以引用其他包的变量：</p>

<blockquote>
  <p><strong>第一种方法</strong>：只需要在<code>NAMESPACE</code>中声明引用<code>import()</code>或者<code>importFrom()</code>，同时在<code>DESCRIPTION</code>中<code>Imports</code>添加需引用的包即可。这样，在编写代码时不用加上<code class="language-r">require(pkg)</code>之类载入包的语句。在安装过程中，通过引用可以很方便地获取其他包的变量（比如函数），因而避免了载入整个包；对应的，这很大程度上保证了代码的简洁，一个非常不错的设计。</p>

  <p>这里需要再多啰嗦两句，<code class="language-r">require(pkg)</code>和<code>NAMESPACE</code>声明<code>import()</code>有不同，前一个函数载入包，并将其添加（attach）到搜索目录下；而后一个则只载入包，并有添加搜索目录。这有两点好处：1. 用户只将注意力集中在载入的包，如果import()的包中有与载入包命名冲突的函数，只会调用载入的包；2. 设计简洁。</p>

  <p><strong>第二种方法</strong>：也可以通过操作符<code>::</code>和<code>:::</code>获得命名空间的“显变量（exported variables）和“隐变量（internal variables）”。需要注意的是，不推荐使用<code>:::</code>，这可能暗示这一个自己设计不足。因为“隐变量”之所以要隐藏起来，作者是有着充分的考虑；而且，这些“隐变量”可能随着作者对包的更新而改名。可以使用函数<code class="language-r">loadedNamespaces()</code>查看已经载入的命名空间，<code>unloadNamespace(name)</code>卸载命名空间。</p>
</blockquote>

<p>对于这两种方法，不推荐第二种方法，原因很简单：要多写包名+两个冒号。第二中方法适合在终端操作时，遇到函数名称冲突（见后）使用。</p>

<p>如果变量命名有冲突，R将采取“就近”策略应对，考虑两种特殊情况:</p>

<blockquote>
  <ol>
    <li>
      <p>假定自己包的名称是Mypkg，如果在<code>NAMESPACE</code>中声明输入<code>export(f)</code>，但是又从另外一包foo输入同名函数f，比如<code>importFrom(foo, f)</code>。这时，“就近”策略发挥作用，即在载入包Mypkg时，默认f函数是自己编写的，即声明输出的函数f，而不是foo中的f函数。总体而言，命名空间的查找顺序是：<strong>包的命名空间 –&gt; import声明 –&gt; Base包的命名空间 –&gt; 最后是搜索路径</strong>。</p>
    </li>
    <li>
      <p>假定pkg1和pkg2两个包，都有命名空间，而且输出同名函数f。这是，R会怎么处理呢？同样是“就近”原则，哪个包后载入，先用哪个包的函数f。不过，如果函数命名有冲突，后载入的包会给出一个警告“marsked from package: ***”。</p>
    </li>
  </ol>
</blockquote>

<h3 id="a-idrefa"><a id="Ref">参考网址</a></h3>

<ul>
  <li>
    <p><a href="https://github.com/yihui/knitr/blob/master/DESCRIPTION">knitr包的DESCRIPTION文件</a></p>
  </li>
  <li>
    <p>命名空间讨论：<a href="https://github.com/hadley/devtools/wiki/Namespaces">1</a>、<a href="http://www.r-bloggers.com/namespaces-and-name-conflicts/">2</a>、<a href="http://r-pkgs.had.co.nz/namespace.html">3</a></p>
  </li>
  <li>
    <p>其他帮助文档：<a href="http://cos.name/2011/05/write-r-packages-like-a-ninja/">1</a>、<a href="http://yihui.name/knitr/">2</a>、<a href="http://cran.r-project.org/doc/manuals/R-exts.html#Dynamic-pages">3</a>、<a href="http://sjp.co.nz/posts/emacs-ess-knitr/">4</a>、<a href="https://github.com/yihui/knitr/issues/252">5</a>、<a href="http://cos.name/cn/topic/106644">6</a></p>
  </li>
</ul>

<h3 id="section-6">更新记录</h3>

<p>2014年9月5日</p>
]]></content>
  </entry>
  
</feed>
