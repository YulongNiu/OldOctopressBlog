<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>R包制作和roxygen2使用说明 - 牛牛龙</title>
  <meta name="author" content="Yulong Niu">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yulongniu.bionutshell.org/blog/2012/05/30/r-package-and-roxygen2">
  <link href="/favicon.ico" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="牛牛龙" type="application/atom+xml">

  <!-- http://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://yulongniu.bionutshell.org/blog/2012/05/30/r-package-and-roxygen2">
  <meta property="og:title" content="R包制作和roxygen2使用说明 - 牛牛龙">
  

  <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ TeX: { extensions: ["color.js"] }});
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>

<!--enable to choose theme in octostrap-->

  <link href="http://bootswatch.com/readable/bootstrap.css" rel="stylesheet" type="text/css">



<!-- link open with new tab  -->
<script>
  function addBlankTargetForLinks () {
  $('a[href^="http"]').each(function(){
  $(this).attr('target', '_blank');
  });
  }
  
  $(document).bind('DOMNodeInserted', function(event) {
  addBlankTargetForLinks();
  });
</script>


  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  

  
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53073828-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">牛牛龙</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="index" href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
		<li >
                  <a href="/whoami">WhoAmI</a>
                </li>
		<li >
                  <a href="/link">Link</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:yulongniu.bionutshell.org">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="牛牛龙" />
    
    <meta itemprop="url" content="http://yulongniu.bionutshell.org" />
    <article class="hentry" role="article" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-05-30T07:46:59+08:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
           | <a href="#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="http://yulongniu.bionutshell.org">Comments</a>
        
      </p>
    
    
    <h1 class="entry-title" itemprop="name headline">
        R包制作和roxygen2使用说明
        
    </h1>
    
  </header>


<div class="entry-content clearfix" itemprop="articleBody description"><p>查看创建R包的各种细节，权威的文献是<a href="http://cran.r-project.org/doc/manuals/r-release/R-exts.html">Writing R Extensions</a>。</p>

<h2 id="r">1. 创建R包目录</h2>

<p>像盖房子一样，创建R包需要先搭建一个骨架，这个骨架往往是固定的，即一些文件夹（如<code>R</code>，<code>man</code>等）和文件（如<code>DESCRIPTION</code>，<code>NAMESPACE</code>）是必须的，而另外一些则可选择性添加。一个典型的R包目录,比如<span style="color: blue">Biobase</span>包，如下图：</p>

<!--more-->

<p><img class="middle" src="/images/r_catalog.png" width="350" height="300" title="Biobase catalog #1" alt="a snap of Biobase catalog" /></p>

<h3 id="description">1.1 <code>DESCRIPTION</code>文件</h3>

<p>一个纯文本ASCII文件，其中Package, Version, License, Description, Title, Author和Maintainer是必备条目，一个例子<span style="color: blue">knitr</span>包的<code>DESCRIPTION</code>文件：</p>

<ul>
  <li>
    <p>Package：由字母、数字和“点”构成的，至少含有两个字符，第一个必须是字母，结束不能用“点”（这也是包名称的命名规范）。</p>
  </li>
  <li>
    <p>Version：版本号，经典的命名方式比如0.1-0。</p>
  </li>
  <li>
    <p>License：GPL。</p>
  </li>
  <li>
    <p>Description：一段话描述包主要的功能。</p>
  </li>
  <li>
    <p>Title：包的一句话解释。</p>
  </li>
  <li>
    <p>Author和Maintainer：包的作者和维护者，姓+名 （比如Karl Pearson ）。也可以使使用Author@R描述作者，使用R函数<code class="language-r">person()</code>，其中变量<code>role</code>的选项<code>aut</code>表示author，<code>cre</code>表示creator（维护者），<code>ctb</code>表示contributor。一个例子：</p>
  </li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="kt">c</span><span class="p">(</span>person<span class="p">(</span><span class="s">&quot;Hadley&quot;</span><span class="p">,</span> <span class="s">&quot;Wickham&quot;</span><span class="p">,</span> email <span class="o">=</span> <span class="s">&quot;hadley@rice.edu&quot;</span><span class="p">,</span> role <span class="o">=</span><span class="s">&quot;ctb&quot;</span><span class="p">),</span>
</span><span class="line">person<span class="p">(</span><span class="s">&quot;Yihui&quot;</span><span class="p">,</span> <span class="s">&quot;Xie&quot;</span><span class="p">,</span> email <span class="o">=</span> <span class="s">&quot;xie@yihui.name&quot;</span><span class="p">,</span> role <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;aut&quot;</span><span class="p">,</span> <span class="s">&quot;cre&quot;</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>
    <p>Date（可选）：当前版本包日期，格式yyyy-mm-dd。</p>
  </li>
  <li>
    <p>Depends（可选）：依赖的R环境版本和包名称，比如 <code>R (&gt;= 2.14.1)</code>。</p>
  </li>
</ul>

<p><span style="color: blue">注意：</span></p>

<blockquote>
  <ol>
    <li>
      <p>加上版本号，没有版本号等于没用，因为版本之间可能差异很大；</p>
    </li>
    <li>
      <p>对于<span style="color: blue">base</span>等这样的包就不用写了，因为是必然依赖的，同时也是R启动自动载入的。对于依赖的包名称，在R 2.14.0之后完全没有必要写，因为从这个版本后，所有包都有<code>NAMESPACE</code>，直接使用<code>Imports</code>就可以了。</p>
    </li>
  </ol>
</blockquote>

<ul>
  <li>
    <p>Imports（可选）：如果只是使用某些包中类、方法或者（一般）函数，而不用完全载入包，可以在此栏列出包的名称，最好加上版本号（在<code class="language-bash">R CMD check</code>会检查版本）。在代码中，引用其他包的namespace可以使用<code>::</code>或者<code>:::</code>操作符。与之对应的，需要在<code>NAMESPACE</code>文件中指明引用（见后）。</p>
  </li>
  <li>
    <p>Suggests（可选）：如果只是在帮助文档的<code>examples</code>，<code>tests</code>或者vignettes中用到了一些包，那么没有必要“依赖”或者“引用”，只用“建议”安装即可。版本号同样也要加上，在<code class="language-bash">R CMD check</code>时会用到。当然，我们要考虑到如果读者也想重现一下<code class="language-bash">examples/tests/vignettes</code>的例子，最好使用<code class="languag-r">if(require(pkgname)))</code>的条件句控制：<code class="languag-r">TRUE</code>执行，<code class="languag-r">FALSE</code>返回错误。</p>
  </li>
  <li>
    <p>Enhances（可选）：这个条目中的包可以被这个正在创建的包“增强”功能，比如我们创建的这个包为（对列表中的包）提供了更好的方法、更优秀的处理手段等。</p>
  </li>
  <li>
    <p>URL（可选）：一系列相关的网址，使用“逗号”或者空格隔开。链接可能是作者的主页、包的补充材料等。</p>
  </li>
  <li>
    <p>BugReports（可选）：一个网址，用于提交bug，代替了向作者发邮件。一个好的想法是使用<a href="https://github.com/">Github</a>，在项目的issures版块提交bug。</p>
  </li>
  <li>
    <p>Collate（可选）：看不懂。</p>
  </li>
  <li>
    <p>KeepSource（可选）：逻辑值，设定为<code class="languag-r">TRUE</code>，表示包是源码。</p>
  </li>
  <li>
    <p>ByteCompile（可选）：逻辑值，目前默认设置为否；如果性能确实可以得到提升，可以选择<code class="languag-r">TRUE</code>，但这可能增加安装时间和体积。</p>
  </li>
  <li>
    <p>BuildVignettes（可选）：如果设定位<code class="languag-r">FALSE</code>，<code class="languag-bash">R CMD build</code>不会重新编辑vignette，同时<code class="languag-bash">R CMD check</code>也不会检查。</p>
  </li>
</ul>

<h3 id="section">1.2 包目录下的各种文件夹说明</h3>

<ul>
  <li>
    <p>R文件夹：这个文件夹下放置用R语言写成的源代码，文件最好使用后缀<code>*.R</code>。</p>
  </li>
  <li>
    <p>man文件夹：man文件夹下放置<code>*.Rd</code>结尾的文档，这写文档详细描述的函数的用途。如果使用roxygen2，就不需要建立这个文件夹。</p>
  </li>
  <li>
    <p>src文件夹：放置用其他语言写成的代码，比如C/C++/Fortran等。</p>
  </li>
  <li>
    <p>data文件夹：放置一些data文件，比如R代码、表格（<code>*txt</code>/<code>*.tab</code>/<code>*.csv</code>）文件或者是用<code class="language-r">save()</code>函数保存的镜像（<code>*.RData</code>/<code>*.rda</code>）。这些文件必须是“自给自足”的，即不用调用包也能使用这些data。如果这些data比较大，可以将其压缩为<code>*.gzip</code>/<code>*.bzip2</code>/<code>*.xz</code>格式，或者在保存镜像时，使用<code class="language-r">save(, compress = TRUE)</code>。这些方法可以有效地减少包的体积和安装时间，以方便用户使用。如果原始数据，比如<code>test.csv</code>{.language-bash}文件，可以放入<code>inst/extdata/</code>{.language-bash}文件夹。引用这类数据，使用<code class="languag-r">system.file("extdata", "test.csv", package = "myPkg")</code>。</p>
  </li>
  <li>
    <p>demo文件夹：放置一些包的示例，通过<code>demo()</code>函数访问。（需要有一个00Index文件？不能自动生成？）</p>
  </li>
  <li>
    <p>exec文件夹：放置脚本文件比如shell、Perl、Python、Tcl等。</p>
  </li>
  <li>
    <p>inst文件夹：包在编译安装中，会将这个文件下的文件放入包的根目录下，所以可以放包的更新文件NEWS（或者CHANGELOG）文件、用于引用的CITATION文件等。还有很重要的子文件夹是doc，vignette文件就放在此处，格式为*.Rnw，这个文件会进一步被编程成LaTeX文件，最后生成常见的PDF文档。现在Swear过时了，用<span style="color: blue">knitr</span>吧。</p>
  </li>
</ul>

<h2 id="namespace">2. <code>NAMESPACE</code>文件</h2>

<h3 id="section-1">2.1 文件说明</h3>

<p><code>NAMESPACE</code>文件非常重要，因为它指明哪些函数是“输出（export）”给用户使用，哪些又是从其他包中“输入（import）”的。如果作者没有指明这个文件，那么在创建包时会被自动创建，此时所有的对象都被输出，在<code>Imports</code>和<code>Depends</code>下的包全部被输入。</p>

<p><strong>“输出”格式</strong>：<code class="language-r">export(f, g)</code>，其中<code class="language-r">f</code>和<code class="language-r">g</code>是变量名，一般不用引号括起。也可以使用正则表达式批量输出，比如 <code class="language-r">exportPattern("^[^\\.]")</code>。</p>

<p><strong>“输入”格式</strong>：<code class="language-r">import(for, bar)</code>，其中<code class="language-r">for</code>和<code class="language-r">bar</code>是包名称，这样做会导致<code class="language-r">for</code>和<code class="language-r">bar</code>中所有的输出对象都被引用。如果我们只想引用其中的某几个对象， 可以使用<code class="language-r">importFrom(foo, f, g)</code>，其中<code class="language-r">f</code>和<code class="language-r">g</code>是<code class="language-r">foo</code>包的变量名。<span style="color: blue">Base</span>包的命名空间被默认引用。当然，也可以输出其他包的变量，前提是这些变量需要先被输入。</p>

<h3 id="s3">2.2 S3类</h3>

<p><code class="language-r">S3method(Mymethod, Myclass)</code></p>

<h3 id="s4">2.3 S4类</h3>

<p><strong>“输出”格式</strong>：如果创建的S4类需要被外部调用，使用<code class="language-r">exportClasses(Myclass1, Myclass2)</code>，同样可以使用<code class="language-r">exportClassPattern()</code>批量输出。对于S4，输出“方法（methods）”也会输出“泛函（generic）”，输出泛函同样也会输出方法。如果一个方法，在要创建的包中没有找到对应的方法，有两种可能的情况：</p>

<blockquote>
  <ol>
    <li>
      <p>泛函已经从别的包中输入，比如<code class="language-r">importMethods()</code>；</p>
    </li>
    <li>
      <p>从别的包中输入函数，但被转换为默认方法，比如<code class="language-r">importFrom("graphics", plot)</code>，<code class="language-r">plot()</code>函数又被分配其他的方法，这种情况下输入自己包的<code class="language-r">plot()</code>函数，使用<code class="language-r">exportMethods(plot)</code>。</p>
    </li>
  </ol>
</blockquote>

<p><strong>“输入”格式</strong>：输入某个包的全部类或者特定的类，<code class="language-r">ImportClasses(pkg)</code>或者<code class="language-r">ImportClassesFrom(pkg, class1)</code>；输入某个包全部方法或者特定方法，<code class="language-r">ImportMethods(pkg)</code>或者<code class="language-r">ImportMethodsFrom(pkg, method1)</code>。</p>

<p><span style="color: blue">stats4</span>给出的例子非常好，R 2.15.0之后，对隐式泛函要求严格，必须先输入显示函数：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">  export<span class="p">(</span>mle<span class="p">)</span>
</span><span class="line">  importFrom<span class="p">(</span><span class="s">&quot;graphics&quot;</span><span class="p">,</span> plot<span class="p">)</span>
</span><span class="line">  importFrom<span class="p">(</span><span class="s">&quot;stats&quot;</span><span class="p">,</span> optim<span class="p">,</span> qchisq<span class="p">)</span>
</span><span class="line">  <span class="c1">## For these, we define methods or (AIC, BIC, nobs) an implicit generic: </span>
</span><span class="line">  importFrom<span class="p">(</span><span class="s">&quot;stats&quot;</span><span class="p">,</span> AIC<span class="p">,</span> BIC<span class="p">,</span> coef<span class="p">,</span> confint<span class="p">,</span> logLik<span class="p">,</span> nobs<span class="p">,</span> profile<span class="p">,</span> update<span class="p">,</span> vcov<span class="p">)</span>   exportClasses<span class="p">(</span>mle<span class="p">,</span> profile.mle<span class="p">,</span> summary.mle<span class="p">)</span>
</span><span class="line">  <span class="c1">## All methods for imported generics: </span>
</span><span class="line">  exportMethods<span class="p">(</span>coef<span class="p">,</span> confint<span class="p">,</span> logLik<span class="p">,</span> plot<span class="p">,</span> profile<span class="p">,</span> <span class="kp">summary</span><span class="p">,</span> show<span class="p">,</span> update<span class="p">,</span> vcov<span class="p">)</span>
</span><span class="line">  <span class="c1">## implicit generics which do not have any methods here </span>
</span><span class="line">  export<span class="p">(</span>AIC<span class="p">,</span> BIC<span class="p">,</span> nobs<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="r-1">3. 书写R函数帮助文档</h2>

<p>书写函数文档的利器当属Emacs+ESS+<span style="color: blue">roxygen2</span>包。Emacs+ESS搭建了一个非常棒的统计学软件（R、SAS、S-Plus等）的代码编辑和运行环境，从ESS命名Emacs Speaks Statistics上就可以感受到它外漏的霸气。而<a href="http://roxygen.org/">roxygen2</a>是R的一个包，仿照Doxygen构建的工具，实现了文档和源码用一个文件共同管理的想法。</p>

<p>这个想法相当棒：</p>

<blockquote>
  <ol>
    <li>
      <p>在写代码时，方便“就地”编写文档（函数功能、参数解释、实现功能、注意事项、依赖关系和例子等）；</p>
    </li>
    <li>
      <p>在源码修改时，及时地更新文档。</p>
    </li>
  </ol>
</blockquote>

<p>对于编辑R包来说，对应的文档是<code>*.Rd</code>（R documentation）格式的文件，以下是一个框架示意图：</p>

<p><img class="middle" src="/images/r_rd.png" width="600" height="600" title="Rd file #1" alt="a snap of Rd file framework" /></p>

<h3 id="span-stylecolor-blueroxygen2span">3.1 <span style="color: blue">roxygen2</span>使用注释</h3>

<ul>
  <li>
    <p><code>@title</code>：文档标题，通常是函数名缩写（比如首字母缩写）的解释。出现在该函数文档的标题位置和检索（index）目录。</p>
  </li>
  <li>
    <p><code>@aliases</code>：函数别名。这个函数的别名，如果使用，在HTML帮助文档中将出现这个别名，链接的文档还是原来函数文档；同样，<code class="language-r">?“别名”</code>也能调出帮助文件。具体参考<span style="color: blue">stats</span>包中，“Normal”是<code class="language-r">dnorm()</code>，<code class="language-r">pnorm()</code>，<code class="language-r">qnorm()</code>，<code class="language-r">rnorm()</code>三个函数的别名。</p>
  </li>
  <li>
    <p><code>@description</code>：描述，对函数进行稍微详细的描述，可以讲解函数的功能，不能有空行。出现在文档开始位置。</p>
  </li>
  <li>
    <p><code>@details</code>：函数的具体描述，啰嗦各种细节，比如在运行过程中的注意事项、输入结果解释、运用的公式等。</p>
  </li>
  <li>
    <p><code>@param</code>：各个变量（argument）的解释。</p>
  </li>
  <li>
    <p><code>@inheritParams</code>：用于需要重复解释的变量，防止过多“剪切”“复制”。比如一些变量已经在foo1解释了，而foo2需要用foo1的一些变量，就可以使用这个字段。这里的foo1可以是当前包的函数，也可以是其他包函数，比如pkg::foo1。</p>
  </li>
  <li>
    <p><code>@return</code>：函数返回的结果。如果想具体解释返回的结果，格式<code class="language-html">\item{name a}{description a}</code>。</p>
  </li>
  <li>
    <p><code>@author</code>：作者，加上作者邮件地址，格式：<code class="language-html">\email{MrR@@stat.cn}</code>。</p>
  </li>
  <li>
    <p><code>@examples</code>：给出函数使用的例子。例子非常重要，很多用户对例子的关注要远远高于其他的部分，啰啰嗦嗦说了一大堆，不如来两个漂亮的例子。我认为好的例子应该包括（但不限于）：</p>
  </li>
</ul>

<blockquote>
  <ul>
    <li>
      <p>重要参数的演示；</p>
    </li>
    <li>
      <p>参数之间的协调控制；</p>
    </li>
    <li>
      <p>特殊参数（用语言描述困难）的演示；</p>
    </li>
    <li>
      <p>可能的错误使用；</p>
    </li>
    <li>
      <p>来几张漂亮图。</p>
    </li>
  </ul>
</blockquote>

<p>这些例子可以直接使用R代码编排、“#”注释、多行也问题。这些例子可以用函数<code class="language-r">example()</code>运行。如果不想运行某些例子（比如演示错误使用等），格式：<code class="language-html">\dontrun{Rcode}</code>。如果例子中依赖其他包，使用<code class="language-r">if(require(pkg)){ }</code>格式。如果函数使用了多核运算技术，例子最多只能允许使用2个核，如果使用多个核，会报错。</p>

<p>也可以在包的根目录下建立文件，通过<code class="language-r">@example path/relative/to/packge/root</code>引用。如果函数不需要输出，则不用添加<code>@example</code>，否则在R包检查中会报错。</p>

<ul>
  <li>
    <p><code>@references</code>： 参考文献，比如算法出处、函数编写思路、例子的参考文献等。如果想多行出现，只需再用一次<code>@references</code>即可。如果要网址，格式为<code class="language-html">\url{http://www.google.com}</code>。</p>
  </li>
  <li>
    <p><code>@seealso</code>：其他可供参考或者有联系的对象，并说明可供参考的原因。如果想在HTML中有超链接，格式为<code class="language-html">\code{\link{function}}</code>。</p>
  </li>
  <li>
    <p><code>@family</code>：为<code>@seealso</code>提供了另外一种解决方法，将需要相互引用函数编排成一个“家族（family）”，之后同一个家族的函数自动出现在see-also中。同一个函数可以属于多个不同家族。</p>
  </li>
  <li>
    <p><code>@note</code>：添加一些注释信息。</p>
  </li>
  <li>
    <p><code>@section</code>：用户自定义一个注释区（包括名称和内容）。</p>
  </li>
  <li>
    <p><code>@rdname</code>：解决了多个文档合并的问题。可以将多个函数标记为一个共同的<code class="language-html">@rdname（override name）</code>，这样在最后的HTML文档中，就可以将多个功能相似或者一个系列的函数总结在一个文档中。如果使用了<code>@rdname</code>，那么<code>@description</code>和<code>@details</code>需要在第一个函数中全部写完，<code>@title</code>也只在第一个函数中出现。</p>
  </li>
  <li>
    <p><code>@keywords internal</code>：隐藏函数，不在help文档中显示，在其他包中可以正常使用。</p>
  </li>
  <li>
    <p><code>@aliases</code>：命名一个函数的别名，将指向同一个文档；<code>@family</code>：如果几个函数共用一个family name，它们将在seealso中交叉链接；<code>@seealso</code>：其他函数的超链接；<code>@rdname</code>：将多个函数合并在一个文档中。这些标记用于在HTML帮助文档中，可能出现这些超级链接或者文档合并。</p>
  </li>
  <li>
    <p>对<code>data</code>文件夹下的R data file进行注释。R data file通常以.RData或者.rda作为文件名扩展。<a href="http://r-pkgs.had.co.nz/data.html#documenting-data">参考数据注释</a>。</p>
  </li>
</ul>

<h2 id="vignittes">4. 写vignittes文件</h2>

<p>推荐使用<a href="https://github.com/yihui/knitr"><span style="color: blue">knitr</span>包</a>。</p>

<h2 id="section-2">5. 其他辅助文件</h2>

<h3 id="news">5.1 NEWS文件</h3>

<p>在包根目录下，可以添加<code class="language-bash">NEWS</code>文件，简要说明版本更新特征。参考<a href="https://github.com/hadley/ggplot2/blob/master/NEWS">ggplot2</a>的格式：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class=""><span class="line">pkgName version
</span><span class="line">-------------------------
</span><span class="line">NEW FEATURES
</span><span class="line">
</span><span class="line">* 1st feature
</span><span class="line">
</span><span class="line">* 2nd feature
</span><span class="line">
</span><span class="line">* 3rd feature
</span><span class="line">
</span><span class="line">BUG FIXES
</span><span class="line">
</span><span class="line">* fixed bug1
</span><span class="line">
</span><span class="line">* fixed bug2</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>也可以在NEWS的最开头加入自己的TODO列表，提示将来需要作的更新。</p>

<h2 id="section-3">6. 检查和压缩包</h2>

<p>在提交代码之前，首先需要检查自己的代码，运行命名</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">R CMD check Mypkg
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>之后，因为R源码包（source package）的发布都是采用压缩文件（<code>*.tar.gz</code>）形式，所以需要将源代码打包，方法是运行命令</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">R CMD build Mypkg
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>当然，有时我们需要发布二进制包（binary packages）,操作方法是</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">R CMD INSTALL --build Mypkg
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>具体执行过程是：首先，在默认目录树下安装包；之后，将成功安装的包转化成（平台依赖的）二进制代码，再将二进制代码打包输出。所以，默认安装目录要有“可写”权限，如果没有，执行<code class="language-bash">R CMD INSTALL -l location --build Mypkg</code>，指定一个“可写”权限目录（location）安装。</p>

<p>CRAN很体贴地考虑了Window以外平台的作者，通过<a href="http://win-builder.r-project.org/">网站</a>上传源码包，之后编译成window平台二进制包。</p>

<p>最后是提交代码，依次执行以下命名或者操作:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">R CMD build Mypkg
</span><span class="line"><span class="c"># 检查例子（example）、检查（test）和文档输出，如果有报错或者警告，需要仔细阅读提示，原则上消除所有报错和警告</span>
</span><span class="line">R CMD check --as-cran
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>使用 ftp://CRAN.R-project.org/incoming/ （用户名： anonymous；密码：自己邮箱地址）上传自己的包，并向CRAN@R-project.org发邮件通知自己上传了包（名称、版本等）。</p>

<h2 id="section-4">注意事项</h2>

<h3 id="section-5">1. 命名</h3>

<p>给自己的包起一个漂亮的名字，注意大小写，因为一些操作系统可能对大小写不敏感。因此，为了平台兼容性，包的命名尽量不要用大小写区分；不仅如此，在包源代码文件夹下，文件命名也要注意这个问题。起了名字之后，最好到<a href="http://cran.r-project.org/web/packages/available_packages_by_name.html">R包列表</a>去看看，检查下自己包的名字是否与其他人的冲突。</p>

<h3 id="section-6">2. 名称符号</h3>

<blockquote>
  <ul>
    <li>
      <p>文件名中不允许出现如下符号<code>"</code>、 <code>*</code>、 <code>:</code>、<code>/</code>、<code>&lt;&lt;/font&gt;</code>、 <code>&gt;</code>、 <code>?</code>、 <code>\</code> 和 <code>|</code>；</p>
    </li>
    <li>
      <p>文件命名使用的字符包括 <code>A-Za-z0-9._!#$%&amp;+,;=@^(){}'[]</code>，但是不推荐使用 <code>(){}'[]$</code>；</p>
    </li>
    <li>
      <p><code>*.Rd</code>文件可以包括URL，但必须是ASCII，不能出现<code>%</code>。</p>
    </li>
  </ul>
</blockquote>

<h3 id="gnu">3. GNU版本号</h3>

<p>GNU版本命名规则：Major_Version_Number.Minor_Version_Number[.Revision_Number[.Build_Number]]。</p>

<h3 id="namespace-1">4. 关于“命名空间（namespace）”的讨论</h3>

<p>在制作R包时候，有两种方法可以引用其他包的变量：</p>

<blockquote>
  <p><strong>第一种方法</strong>：只需要在<code>NAMESPACE</code>中声明引用<code>import()</code>或者<code>importFrom()</code>，同时在<code>DESCRIPTION</code>中<code>Imports</code>添加需引用的包即可。这样，在编写代码时不用加上<code class="language-r">require(pkg)</code>之类载入包的语句。在安装过程中，通过引用可以很方便地获取其他包的变量（比如函数），因而避免了载入整个包；对应的，这很大程度上保证了代码的简洁，一个非常不错的设计。</p>

  <p>这里需要再多啰嗦两句，<code class="language-r">require(pkg)</code>和<code>NAMESPACE</code>声明<code>import()</code>有不同，前一个函数载入包，并将其添加（attach）到搜索目录下；而后一个则只载入包，并有添加搜索目录。这有两点好处：1. 用户只将注意力集中在载入的包，如果import()的包中有与载入包命名冲突的函数，只会调用载入的包；2. 设计简洁。</p>

  <p><strong>第二种方法</strong>：也可以通过操作符<code>::</code>和<code>:::</code>获得命名空间的“显变量（exported variables）和“隐变量（internal variables）”。需要注意的是，不推荐使用<code>:::</code>，这可能暗示这一个自己设计不足。因为“隐变量”之所以要隐藏起来，作者是有着充分的考虑；而且，这些“隐变量”可能随着作者对包的更新而改名。可以使用函数<code class="language-r">loadedNamespaces()</code>查看已经载入的命名空间，<code>unloadNamespace(name)</code>卸载命名空间。</p>
</blockquote>

<p>对于这两种方法，不推荐第二种方法，原因很简单：要多写包名+两个冒号。第二中方法适合在终端操作时，遇到函数名称冲突（见后）使用。</p>

<p>如果变量命名有冲突，R将采取“就近”策略应对，考虑两种特殊情况:</p>

<blockquote>
  <ol>
    <li>
      <p>假定自己包的名称是Mypkg，如果在<code>NAMESPACE</code>中声明输入<code>export(f)</code>，但是又从另外一包foo输入同名函数f，比如<code>importFrom(foo, f)</code>。这时，“就近”策略发挥作用，即在载入包Mypkg时，默认f函数是自己编写的，即声明输出的函数f，而不是foo中的f函数。总体而言，命名空间的查找顺序是：<strong>包的命名空间 –&gt; import声明 –&gt; Base包的命名空间 –&gt; 最后是搜索路径</strong>。</p>
    </li>
    <li>
      <p>假定pkg1和pkg2两个包，都有命名空间，而且输出同名函数f。这是，R会怎么处理呢？同样是“就近”原则，哪个包后载入，先用哪个包的函数f。不过，如果函数命名有冲突，后载入的包会给出一个警告“marsked from package: ***”。</p>
    </li>
  </ol>
</blockquote>

<h3 id="section-7">参考网址资料</h3>

<ul>
  <li>
    <p><a href="https://github.com/yihui/knitr/blob/master/DESCRIPTION">knitr包的DESCRIPTION文件</a></p>
  </li>
  <li>
    <p>命名空间讨论：<a href="https://github.com/hadley/devtools/wiki/Namespaces">1</a>、<a href="http://www.r-bloggers.com/namespaces-and-name-conflicts/">2</a>、<a href="http://r-pkgs.had.co.nz/namespace.html">3</a></p>
  </li>
  <li>
    <p>其他帮助文档：<a href="http://cos.name/2011/05/write-r-packages-like-a-ninja/">1</a>、<a href="http://yihui.name/knitr/">2</a>、<a href="http://cran.r-project.org/doc/manuals/R-exts.html#Dynamic-pages">3</a>、<a href="http://sjp.co.nz/posts/emacs-ess-knitr/">4</a>、<a href="https://github.com/yihui/knitr/issues/252">5</a>、<a href="http://cos.name/cn/topic/106644">6</a></p>
  </li>
  <li>
    <p><a href="https://stackoverflow.com/questions/25605185/how-do-i-add-a-changelog-or-news-file-to-my-r-package">NEWS文件说明</a></p>
  </li>
</ul>

<h3 id="section-8">更新记录</h3>

<p>2015年8月27日</p>
</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="glyphicon glyphicon-user"></span> <span class="byline author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person">Posted by <span class="fn" itemprop="name">Yulong Niu</span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-05-30T07:46:59+08:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
          

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/blog/categories/r/'>r</a>
  
</span>


        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://yulongniu.bionutshell.org/blog/2012/05/30/r-package-and-roxygen2/" data-via="" data-counturl="http://yulongniu.bionutshell.org/blog/2012/05/30/r-package-and-roxygen2/" >Tweet</a>
  
  
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/blog/2012/05/05/r-s4/" title="Previous Post: R面向对象编程S4">&laquo; R面向对象编程S4</a></li>
            
            
            <li class="next"><a href="/blog/2012/06/25/emacs-extend-skills/" title="Next Post: Emacs高级使用技巧">Emacs高级使用技巧 &raquo;</a></li>
            
          </ul>
        
      </footer>
    </article>
    
      <section>
        <h2>Comments</h2>
        <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
      </section>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/2017/10/15/naive-bayes-binary-multinomial/">朴素贝叶斯分类器应用于二元数据类型的尝试</a>
    
    <a class="list-group-item " href="/blog/2017/06/14/shadowsocks-setup/">Shadowsocks设置推荐</a>
    
    <a class="list-group-item " href="/blog/2017/05/16/java-binary/">探索Java基本类型的二进制表示</a>
    
    <a class="list-group-item " href="/blog/2016/11/11/git-rebase-examples/">两个git的rebase命令应用</a>
    
    <a class="list-group-item " href="/blog/2016/10/21/linux-sync-google-drive/">命令行使用Google Drive</a>
    
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Categories</h3>
  </div>
  <div class="list-group">
    
    
    <a class="list-group-item " href="/blog/categories/linux/index.html">
        <span class="badge">9</span>
        linux
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/r/index.html">
        <span class="badge">9</span>
        r
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/lisp/index.html">
        <span class="badge">6</span>
        lisp
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/ppr/index.html">
        <span class="badge">5</span>
        ppr
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/bioinfor/index.html">
        <span class="badge">14</span>
        bioinfor
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/saysomething/index.html">
        <span class="badge">1</span>
        saysomething
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/c/index.html">
        <span class="badge">2</span>
        c
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/hcj/index.html">
        <span class="badge">1</span>
        hcj
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/share/index.html">
        <span class="badge">1</span>
        share
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/java/index.html">
        <span class="badge">1</span>
        java
      </a>
    
  </div>
</section>






    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2017 - Yulong Niu<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'yulongniu';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://yulongniu.bionutshell.org/blog/2012/05/30/r-package-and-roxygen2/';
        var disqus_url = 'http://yulongniu.bionutshell.org/blog/2012/05/30/r-package-and-roxygen2/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>


  </body>
</html>
