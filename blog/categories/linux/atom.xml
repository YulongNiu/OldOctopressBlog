<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Linux | 牛牛龙]]></title>
  <link href="http://yulongniu.bionutshell.org/blog/categories/linux/atom.xml" rel="self"/>
  <link href="http://yulongniu.bionutshell.org/"/>
  <updated>2018-12-15T22:26:41+08:00</updated>
  <id>http://yulongniu.bionutshell.org/</id>
  <author>
    <name><![CDATA[Yulong Niu]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Shadowsocks设置推荐]]></title>
    <link href="http://yulongniu.bionutshell.org/blog/2017/06/14/shadowsocks-setup/"/>
    <updated>2017-06-14T23:49:13+08:00</updated>
    <id>http://yulongniu.bionutshell.org/blog/2017/06/14/shadowsocks-setup</id>
    <content type="html"><![CDATA[<h2 id="shadowsocks">1. Shadowsocks客户端</h2>

<p>Shadowsocks在主流平台上都有<a href="https://shadowsocks.org/en/download/clients.html">客户端</a>，下载直接使用即可。对于Linux平台，可能还需要在Chrome浏览器中安装<a href="https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif?hl=en">SwitchyOmega</a>插件。</p>

<!--more-->

<h2 id="section">2. 谷歌设置</h2>

<p>进入<a href="https://encrypted.google.com/preferences?hl=zh-CN#languages">网址</a>，设置自己喜欢的语言，之后重启即可。</p>

<h2 id="shadowsocks-1">3. 自己配置Shadowsocks</h2>

<h3 id="section-1">3.1 软件准备</h3>

<p>参考<a href="https://github.com/shadowsocks/shadowsocks-libev">shadowsocks网站</a>安装。</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># dnf copr enable librehat/shadowsocks</span>
</span><span class='line'><span class="c"># dnf update</span>
</span><span class='line'><span class="c"># dnf install shadowsocks-libev</span>
</span></code></pre></td></tr></table></div></figure></p>

<h3 id="section-2">3.2 配置文件</h3>

<p>文件位置<code>/etc/shadowsocks-libenv/config.json</code>，设置模板：</p>

<p>
<code>
{
    "server":"0.0.0.0",
    "port_password":{
     "8381":"******",
     "8382":"******"
    },
    "timeout":600,
    "method":"aes-256-cfb"
}
</code>
</p>

<h3 id="section-3">3.3 启动</h3>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># ss-manager -c /etc/shadowsocks-libev/config.json –manager-address 127.0.0.1:8000 -u config.json</span>
</span></code></pre></td></tr></table></div></figure></p>

<h2 id="tcp-bbr">4. 使用TCP BBR加速</h2>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># echo “net.core.default_qdisc=fq” » /etc/sysctl.conf</span>
</span><span class='line'><span class="c"># echo “net.ipv4.tcp_congestion_control=bbr” » /etc/sysctl.conf&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;sysctl--p&quot;</span>&gt;sysctl -p&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;sysctl-netipv4tcpavailablecongestioncontrol&quot;</span>&gt;sysctl net.ipv4.tcp_available_congestion_control&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;# sysctl net.ipv4.tcp_congestion_control
</span></code></pre></td></tr></table></div></figure></p>

<h2 id="section-4">5. 全局配置</h2>

<p>使用proxychains全局调用Shadowsocks。</p>

<p>首先，安装和配置proxychains：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># dnf install -y proxychains-ng&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;echo-socks5----127001----1080--etcproxychainsconf&quot;</span>&gt;echo ‘socks5    127.0.0.1    1080’ » /etc/proxychains.conf&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>之后，打开Shadowsocks后，在需要使用的命令行前加入<code>proxychains4</code>，例如：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>proxychains4 git push origin master
</span></code></pre></td></tr></table></div></figure></p>

<h3 id="section-5">参考资料</h3>

<ol>
  <li>
    <p><a href="http://nga.178.com/read.php?tid=8798506">更改谷歌语言偏好</a></p>
  </li>
  <li>
    <p><a href="https://dirtysalt.github.io/blogs/boost-shadowsocks-with-tcp-bbr.html">通过TCP BBR为ShadowSocks加速</a></p>
  </li>
  <li>
    <p><a href="https://github.com/shadowsocks/shadowsocks-libev/issues/1668">shadowsocks-libev多用户</a></p>
  </li>
</ol>

<h3 id="section-6">更新记录</h3>

<p>2017年10月16日</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[两个git的rebase命令应用]]></title>
    <link href="http://yulongniu.bionutshell.org/blog/2016/11/11/git-rebase-examples/"/>
    <updated>2016-11-11T16:24:39+08:00</updated>
    <id>http://yulongniu.bionutshell.org/blog/2016/11/11/git-rebase-examples</id>
    <content type="html"><![CDATA[<p>介绍两个<code>git rebase</code>的应用场景，一个是合并commits记录，另一个是贡献代码。</p>

<h2 id="commit">1. 合并commit记录</h2>

<p>假定有多条commits，按照离当前时间从近至远依次为：<code>c1</code>、<code>b2</code>、<code>b1</code>和<code>a1</code>。希望合并<code>c1</code>、<code>b2</code>和<code>b1</code>，即只保留<code>c1</code>和<code>a1</code>。操作流程如下：</p>

<!--more-->

<ul>
  <li>打开交互式rebase</li>
</ul>

<p><figure class='code'><figcaption><span>interactive rebase </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git rebase -i sha1id-of-a1
</span></code></pre></td></tr></table></div></figure></p>

<ul>
  <li>标记合并commits</li>
</ul>

<p>弹出的文本编辑器初始可能为：</p>

<p>
<code>
pick sha1id-of-c1 c1
pick sha1id-of-b2 b2
pick sha1id-of-b1 b1
...
</code>
</p>

<p>修改为：</p>

<p>
<code>
pick sha1id-of-c1 c1
squash sha1id-of-b2 b2
squash sha1id-of-b1 b1
...
</code>
</p>

<ul>
  <li>记录合并commits</li>
</ul>

<p>在弹出的文本编辑器中标记和注释commits</p>

<ul>
  <li>提交远程</li>
</ul>

<p>由于本地和远程记录不一致，需要强制合并。</p>

<p><figure class='code'><figcaption><span>force push </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git push -f origin mybranch
</span></code></pre></td></tr></table></div></figure></p>

<h2 id="section">2. 贡献代码</h2>

<ul>
  <li>Fork项目</li>
</ul>

<p>Fork在GitHub对应的项目（famous/project，master分支）至自己账户（my/project），克隆至本地并添加远程地址：</p>

<p><figure class='code'><figcaption><span>clone project </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git clone https://github.com/my/project.git
</span><span class='line'><span class="nv">$ </span>git remote add upstream https://github.com/famous/project.git
</span></code></pre></td></tr></table></div></figure></p>

<ul>
  <li>建立分支并提交修改</li>
</ul>

<p><figure class='code'><figcaption><span>commit </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git checkout -b devbranch
</span><span class='line'><span class="nv">$ </span>git commit -a -m ‘these commits’
</span><span class='line'><span class="nv">$ </span>git push origin devbranch
</span></code></pre></td></tr></table></div></figure></p>

<ul>
  <li>获取和合并最新远程修改</li>
</ul>

<p><figure class='code'><figcaption><span>commit </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git checkout master
</span><span class='line'><span class="nv">$ </span>git pull upstream master
</span><span class='line'><span class="nv">$ </span>git checkout devbranch&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>git rebase master
</span><span class='line'><span class="c">## compare and merge the latest commits</span>
</span><span class='line'><span class="nv">$ </span>git rebase –continue&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h2 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;force-push&quot;</span>&gt;force push&lt;/h2&gt;
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>git push -f origin devbranch
</span></code></pre></td></tr></table></div></figure></p>

<ul>
  <li>发起pull request。</li>
</ul>

<h3 id="section-1">参考资料</h3>

<ol>
  <li>
    <p><a href="http://itspg.logdown.com/posts/1731-git-squash-master-commits">合并分支</a></p>
  </li>
  <li>
    <p><a href="https://segmentfault.com/a/1190000000736629">贡献代码</a></p>
  </li>
</ol>

<h3 id="section-2">更新记录</h3>

<p>2016年11月11日</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[命令行使用Google Drive]]></title>
    <link href="http://yulongniu.bionutshell.org/blog/2016/10/21/linux-sync-google-drive/"/>
    <updated>2016-10-21T18:24:31+08:00</updated>
    <id>http://yulongniu.bionutshell.org/blog/2016/10/21/linux-sync-google-drive</id>
    <content type="html"><![CDATA[<p>本文简单介绍<a href="https://github.com/prasmussen/gdrive">gdrive</a>，它是一个跨多个平台软件，提供命令行操作Google Drive。同类软件还有<a href="https://github.com/odeke-em/drive">drive</a>和<a href="https://www.thefanclub.co.za/overgrive">overGrive</a>（Linux下Google Drive界面客户端）。</p>

<p>基本思路：对每一个上传至Google Drive的文件或文件夹都分配一个Id，所以云端操作需要指定Id。</p>

<p>突出优点：自动同步，比较云端和本地文件后，决定上传、删除或者替换；同步加入版本控制，可以下载和删除不同版本文件。</p>

<!--more-->

<h2 id="section">1. 初始化</h2>

<p><a href="https://github.com/prasmussen/gdrive">下载</a>系统对应版本，执行<code>gdrive about</code>，根据提示设置。</p>

<h2 id="section-1">2. 查找</h2>

<p><a href="https://developers.google.com/drive/v3/web/search-parameters">查找规则</a></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 查找所有文件夹，不包括垃圾箱，所有者为自己</span>
</span><span class='line'><span class="nv">$ </span>gdrive list –query “mimeType <span class="o">=</span> ‘application/vnd.google-apps.folder’ and <span class="nv">trashed</span> <span class="o">=</span> <span class="nb">false </span>and ‘me’ in owners”&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;id&quot;</span>&gt;加入上层目录Id&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;gdrive list –query “mimeType <span class="o">=</span> ‘application/vnd.google-apps.folder’ and <span class="nv">trashed</span> <span class="o">=</span> <span class="nb">false </span>and ‘me’ in owners and ‘YUlPWWdLcy1mX2c’ in parents”&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;section-2&quot;</span>&gt;查询信息&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;gdrive info YUlPWWdLcy1mX2c
</span></code></pre></td></tr></table></div></figure></p>

<h2 id="section-3">3. 建立和删除</h2>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 建立文件夹</span>
</span><span class='line'><span class="nv">$ </span>gdrive mkdir newFolder&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;pid&quot;</span>&gt;建立下一层文件夹，-p指定上层目录Id&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>gdrive mkdir -p M1h4M1dGYUhpSFE newFolder&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;id-1&quot;</span>&gt;删除文件（文件Id，非名称）&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>gdrive delete 0BzTeuubJesi&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;id-2&quot;</span>&gt;删除文件夹（文件Id，非名称）&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>gdrive delete -r 0BzTeuubJesi
</span></code></pre></td></tr></table></div></figure></p>

<h2 id="section-4">4. 普通上传和下载</h2>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 上传文件至制定文件夹</span>
</span><span class='line'><span class="nv">$ </span>gdrive upload -p M1h4M1dGYUhpSFE myFile&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;section-5&quot;</span>&gt;下载文件&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>gdrive download 0BzTeuubJesi&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></p>

<h2 id="section-6">5. 同步</h2>
<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># gdrive sync会标记同步文件，因此不要在同步文件夹中使用gdrive upload或者网页上传文件。未标记文件会被忽略。</span>
</span><span class='line'><span class="c"># 同步列表</span>
</span><span class='line'><span class="nv">$ </span>gdrive sync list&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;section-7&quot;</span>&gt;同步列表内容&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>gdrive sync content VUxydm5iMnM5LWs&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;section-8&quot;</span>&gt;上传&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>gdrive sync upload myLocaldir 0BzTeuubJesi&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;section-9&quot;</span>&gt;下载&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>gdrive sync download 0BzTeuubJesi myLocaldir&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;section-10&quot;</span>&gt;查询所有版本&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;gdrive revision list YUlPWWdLcy1mX2c&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;ididid&quot;</span>&gt;下载某一版本，最后两个Id分别为文件Id和版本Id&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;gdrive revision download YUlPWWdLcy1mX2c Y3JBWEJ5a0gwZndlR3hzWlZubFlUMWFnaHVnPQ&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;section-11&quot;</span>&gt;删除某一版本&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;gdrive revision delete YUlPWWdLcy1mX2c Y3JBWEJ5a0gwZndlR3hzWlZubFlUMWFnaHVnPQ
</span></code></pre></td></tr></table></div></figure></p>

<h3 id="section-12">更新记录</h3>

<p>2016年10月21日</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Docker使用记录]]></title>
    <link href="http://yulongniu.bionutshell.org/blog/2016/03/11/docker-use/"/>
    <updated>2016-03-11T16:53:51+08:00</updated>
    <id>http://yulongniu.bionutshell.org/blog/2016/03/11/docker-use</id>
    <content type="html"><![CDATA[<p>关于Docker的安装和使用，有详细的<a href="https://docs.docker.com/">文档</a>可供参考。本文收集一些有趣和重要的记录。</p>

<h2 id="docker">1. 普通用户权限执行Docker</h2>

<p>创建<code>docker</code>用户组并添加普通用户。</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo groupadd docker
</span><span class='line'><span class="nv">$ </span>sudo usermod -aG docker myUserName
</span></code></pre></td></tr></table></div></figure></p>

<p>注销后，再次登录即可。</p>

<!--more-->

<h2 id="docker-1">2. Docker命令集锦</h2>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 测试Docker</span>
</span><span class='line'><span class="nv">$ </span>docker run hello-world&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;docker-2&quot;</span>&gt;Docker镜象列表&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>docker image ls&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;docker-3&quot;</span>&gt;Docker容器列表&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>docker container ls
</span><span class='line'><span class="nv">$ </span>docker container ls –all&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;section&quot;</span>&gt;列出容器&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>docker ps
</span><span class='line'><span class="nv">$ </span>docker ps -al
</span></code></pre></td></tr></table></div></figure></p>

<h2 id="section-1">3. 运行镜象</h2>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker run -it –rm myDockerImage myCommand
</span></code></pre></td></tr></table></div></figure></p>

<h2 id="section-2">4. 挂载卷</h2>

<p>挂载文件目录至容器，可以挂载多个。</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker run -it –rm -v /localpath/data:/data -v /localpath/file:/file myDockerImage myCommand
</span></code></pre></td></tr></table></div></figure></p>

<h2 id="section-3">5. 保存和本地载入镜像</h2>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 查看镜像列表</span>
</span><span class='line'><span class="nv">$ </span>docker images&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;section-4&quot;</span>&gt;保存镜像&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>docker save -o dockerImage.tar /example/dockerImage&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;section-5&quot;</span>&gt;载入镜像&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>docker load –input dockerImage.tar
</span></code></pre></td></tr></table></div></figure></p>

<h2 id="section-6">6. 修改镜像和容器储存位置</h2>

<p>查看镜像储存位置，例如<code>/var/lib/docker</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker info <span class="p">|</span> grep “Docker Root Dir”
</span></code></pre></td></tr></table></div></figure></p>

<p>移动镜像和容器存储位置</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mv /var/lib/docker /localpath/docker
</span><span class='line'><span class="nv">$ </span>ln -s /localpath/docker /var/lib/docker
</span></code></pre></td></tr></table></div></figure></p>

<h3 id="a-idrefa"><a id="Ref">参考网址</a></h3>

<ul>
  <li>
    <p><a href="https://docs.docker.com/">Docker官方文档</a></p>
  </li>
  <li>
    <p><a href="https://www.gitbook.com/book/yeasy/docker_practice/details">Docker — 从入门到实践</a></p>
  </li>
</ul>

<h3 id="section-7">更新记录</h3>

<p>2018年7月9日</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PostgreSQL使用指南]]></title>
    <link href="http://yulongniu.bionutshell.org/blog/2015/07/29/postgresql-usage/"/>
    <updated>2015-07-29T18:24:10+08:00</updated>
    <id>http://yulongniu.bionutshell.org/blog/2015/07/29/postgresql-usage</id>
    <content type="html"><![CDATA[<h2 id="section">1. 查询</h2>

<p><figure class='code'><figcaption><span>Query </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='psql'><span class='line'><span class="err">–</span> <span class="err">选取特定的一列或者多列</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–</span> <span class="err">选取全部列</span>
</span><span class='line'><span class="k">SELECT</span> <span class="o">*</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–</span> <span class="err">去除重复，选取一列或多列中唯一元素</span>
</span><span class='line'><span class="err">–</span> <span class="err">如输入多列，则去除多列组合后的重复</span>
</span><span class='line'><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–</span> <span class="err">指定输出列数</span>
</span><span class='line'><span class="err">–</span> <span class="n">a</span><span class="err">是输出行数，</span><span class="n">b</span><span class="err">是输出起始行（第一行计为</span><span class="mf">0</span><span class="err">）</span>
</span><span class='line'><span class="k">SELECT</span> <span class="k">column</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">LIMIT</span> <span class="n">a</span> <span class="k">OFFSET</span> <span class="n">b</span>
</span></code></pre></td></tr></table></div></figure></p>

<!--more-->

<ul>
  <li>
    <p>使用<code class="language-bash">;</code>结束一条SQL语句，本文中省略；</p>
  </li>
  <li>
    <p>返回未排序数据；</p>
  </li>
</ul>

<h2 id="section-1">2. 排序</h2>

<p><figure class='code'><figcaption><span>Ordering </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='psql'><span class='line'><span class="err">–</span> <span class="err">按照一列或者多列升序排序</span>
</span><span class='line'><span class="err">–</span> <span class="err">可以按照“不查询”的列排序</span>
</span><span class='line'><span class="err">–</span> <span class="err">先按照</span><span class="n">column2</span><span class="err">排，再按照</span><span class="n">column5</span><span class="err">排</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="n">column3</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">column2</span><span class="p">,</span> <span class="n">column5</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–</span> <span class="err">降序</span>
</span><span class='line'><span class="err">–</span> <span class="k">DESC</span><span class="err">只作用于最靠近的唯一一列，即</span><span class="n">column2</span><span class="err">，不作用于</span><span class="n">column5</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="n">column3</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">column2</span> <span class="k">DESC</span><span class="p">,</span> <span class="n">column5</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–使用查询列相对编号</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="n">column3</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">ORDER</span> <span class="k">BY</span> <span class="mf">2</span><span class="p">,</span> <span class="n">column5</span>
</span></code></pre></td></tr></table></div></figure></p>

<ul>
  <li>
    <p>使用相对列查询时，不查询的列，比如上述例子的column5，不能用数字代替。</p>
  </li>
  <li>
    <p>使用相对列查询有风险，不采用。</p>
  </li>
  <li>
    <p>升序关键字为<code class="language-psql">ASC</code>，通常升序为默认。</p>
  </li>
  <li>
    <p><code class="language-psql">ORDER BY</code>必须在制定列和数据集后出现。</p>
  </li>
</ul>

<h2 id="section-2">3. 筛选</h2>

<p><figure class='code'><figcaption><span>Filter </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='psql'><span class='line'><span class="err">–</span> <span class="k">ORDER</span> <span class="k">BY</span><span class="err">语句需要在</span><span class="k">WHERE</span><span class="err">之后</span>
</span><span class='line'><span class="err">–</span> <span class="k">AND</span><span class="err">表示“且”，</span> <span class="k">OR</span><span class="err">表示“或”，第一个条件满足即终止</span>
</span><span class='line'><span class="err">–</span> <span class="k">AND</span><span class="err">和</span><span class="k">OR</span><span class="err">可有任意多个</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">WHERE</span> <span class="p">(</span><span class="n">column3</span> <span class="o">=</span> <span class="n">a</span> <span class="k">OR</span> <span class="n">column3</span> <span class="o">=</span> <span class="n">b</span><span class="p">)</span> <span class="k">AND</span> <span class="n">column1</span> <span class="o">=</span> <span class="n">c</span>
</span><span class='line'><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">column3</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–</span> <span class="err">多个</span><span class="k">OR</span><span class="err">语句使用</span><span class="k">IN</span><span class="err">代替，比如上述例子为：</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">column3</span> <span class="k">IN</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">AND</span> <span class="n">column1</span> <span class="o">=</span> <span class="n">c</span>
</span><span class='line'><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">column3</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–</span> <span class="k">NOT</span><span class="err">与</span><span class="k">IN</span><span class="err">连用</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">column3</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–</span> <span class="k">BETWEEN</span> <span class="n">a</span> <span class="k">AND</span> <span class="n">b</span><span class="err">语句，</span><span class="n">a</span><span class="err">必须小于等于</span><span class="n">b</span>
</span><span class='line'><span class="err">–</span> <span class="err">如</span><span class="n">a</span><span class="err">等于</span><span class="n">b</span><span class="err">，则相当于筛选与</span><span class="n">a</span><span class="err">（或者</span><span class="n">b</span><span class="err">）相等数值</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">column1</span> <span class="k">BETWEEN</span> <span class="n">a</span> <span class="k">AND</span> <span class="n">b</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–筛选</span><span class="k">NULL</span><span class="err">值使用</span><span class="k">IS</span> <span class="k">NULL</span>
</span><span class='line'><span class="err">–筛选非</span><span class="k">NULL</span><span class="err">值使用</span><span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">column1</span> <span class="k">IS</span> <span class="k">NULL</span>
</span></code></pre></td></tr></table></div></figure></p>

<ul>
  <li>
    <p><a href="http://www.postgresql.org/docs/9.4/static/functions-comparison.html#FUNCTIONS-COMPARISON-TABLE">PostgreSQL支持的比较符</a>：<code class="language-psql">&lt;</code>、<code class="language-psql">&lt;=</code>、<code class="language-psql">&gt;</code>、<code class="language-psql">&gt;=</code>、<code class="language-psql">=</code>和<code class="language-psql">!=</code>（“不等于”也可以表示为<code class="language-psql">&lt;&gt;</code>）。</p>
  </li>
  <li>
    <p>筛选字符串条件，需要对筛选串加引号，比如例子中<code class="language-psql">a</code>为<code class="language-psql">"testStr"</code>。</p>
  </li>
  <li>
    <p>合理使用括号，强制规定<code class="language-psql">AND</code>和<code class="language-psql">OR</code>先后顺序。</p>
  </li>
  <li>
    <p><code class="language-psql">IN</code>语句执行效率高，并且可以嵌套多层<code class="language-psql">SELECT</code>语句（每个<code class="language-psql">SELECT</code>只返回一列数据）。</p>
  </li>
  <li>
    <p>尽量在数据库查询过程，而非自己后续手写，完成数据筛选，因为：1. SQL数据库操作通常比自己手写效率高；2. 便于后续扩展。</p>
  </li>
</ul>

<h2 id="section-3">4. 模式匹配</h2>

<p><figure class='code'><figcaption><span>Pattern Matching </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='psql'><span class='line'><span class="err">–</span> <span class="k">LIKE</span><span class="err">和</span><span class="k">NOT</span> <span class="k">LIKE</span><span class="err">支持对字符串的模式匹配</span>
</span><span class='line'><span class="err">–</span> <span class="err">“</span><span class="n">_</span><span class="err">”匹配单一一个字符</span>
</span><span class='line'><span class="err">–</span> <span class="err">“</span><span class="o">%</span><span class="err">”匹配</span><span class="mf">0</span><span class="err">个或多个字符</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">column1</span> <span class="k">LIKE</span> <span class="err">‘</span><span class="n">F_y</span><span class="o">%</span><span class="err">’</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–</span> <span class="k">SIMILAR</span> <span class="k">TO</span><span class="err">和</span><span class="k">NOT</span> <span class="k">SIMILAR</span> <span class="k">TO</span><span class="err">支持正则匹配</span>
</span><span class='line'><span class="err">–</span> <span class="err">正则匹配中，仍然使用“</span><span class="n">_</span><span class="err">”和“</span><span class="o">%</span><span class="err">”</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">column1</span> <span class="k">SIMILAR</span> <span class="k">TO</span> <span class="err">‘</span><span class="p">[</span><span class="o">^</span><span class="n">JM</span><span class="p">]</span><span class="o">%</span><span class="err">’</span>
</span></code></pre></td></tr></table></div></figure></p>

<ul>
  <li>
    <p>PostgreSQL支持<code class="language-psql">ILIKE</code>和<code class="language-psql">NOT ILIKE</code>忽略大小写敏感搜索，这不是标准SQL语法。</p>
  </li>
  <li>
    <p>注意数据库自动补充的空格，比如 <code class="language-psql">'F_y'</code>只能匹配“F开头-间隔一个字符-y结尾”的字符串，如果字符串后跟有空格，则不能匹配。</p>
  </li>
  <li>
    <p><a href="http://www.postgresql.org/docs/9.4/static/functions-matching.html">PostgreSQL支持的通配符</a></p>
  </li>
  <li>
    <p>模式匹配效率不高，尽量后置，不要过度使用。</p>
  </li>
</ul>

<h2 id="section-4">5. 函数</h2>

<p><figure class='code'><figcaption><span>Function </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='psql'><span class='line'><span class="err">–数学计算</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span> <span class="o">*</span> <span class="n">column3</span> <span class="k">AS</span> <span class="n">newName</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–</span> <span class="err">字符串连接</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">RTRIM</span><span class="p">(</span><span class="n">column1</span><span class="p">)</span> <span class="o">||</span> <span class="err">‘</span> <span class="p">(</span><span class="err">‘</span> <span class="o">||</span> <span class="n">RTRIM</span><span class="p">(</span><span class="n">column1</span><span class="p">)</span> <span class="o">||</span> <span class="err">‘</span><span class="p">)</span><span class="err">’</span> <span class="k">AS</span> <span class="n">newName</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">column1</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–</span> <span class="err">使用函数</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">UPPER</span><span class="p">(</span><span class="n">column2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">newName</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–</span> <span class="err">筛选日期</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">columnDate</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">DATE_PART</span><span class="p">(</span><span class="err">‘</span><span class="k">year</span><span class="err">’</span><span class="p">,</span> <span class="n">columnDate</span><span class="p">)</span> <span class="o">=</span> <span class="mf">2015</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">–</span> <span class="err">汇总数据</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">AVG</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">column1</span><span class="p">)</span> <span class="k">AS</span> <span class="n">newName1</span><span class="p">,</span>
</span><span class='line'>       <span class="n">SUM</span><span class="p">(</span><span class="n">column2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">newName2</span><span class="p">,</span>
</span><span class='line'>       <span class="n">MAX</span><span class="p">(</span><span class="n">column3</span><span class="p">)</span> <span class="k">AS</span> <span class="n">newName3</span><span class="p">,</span>
</span><span class='line'>       <span class="n">MIN</span><span class="p">(</span><span class="n">column4</span><span class="p">)</span> <span class="k">AS</span> <span class="n">newName4</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">Products</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">vend_id</span> <span class="o">=</span> <span class="err">‘</span><span class="n">DLL01</span><span class="err">’</span>
</span></code></pre></td></tr></table></div></figure></p>

<ul>
  <li>
    <p>使用<code class="language-psql">AS</code>及时命名新列。</p>
  </li>
  <li>
    <p>支持数字列的运算有<code class="language-psql">+</code>、<code class="language-psql">-</code>、<code class="language-psql">*</code>和<code class="language-psql">/</code>，更多操作参考<a href="http://www.postgresql.org/docs/9.4/static/functions-math.html">PostgreSQL支持的数值操作</a>。</p>
  </li>
  <li>
    <p>为了移植性考虑，如果使用数据库内置函数，需要对代码相应部分添加详细注释。</p>
  </li>
</ul>

<h2 id="section-5">6. 分组</h2>

<p><figure class='code'><figcaption><span>Group </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='psql'><span class='line'><span class="err">–</span> <span class="err">分组的意思是对一列或者多列数据归总</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="n">COUNT</span><span class="p">(</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">AS</span> <span class="n">newName</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">dataset</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">column4</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mf">3</span>
</span><span class='line'><span class="k">GROUP</span> <span class="k">BY</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span>
</span><span class='line'><span class="k">HAVING</span> <span class="n">COUNT</span><span class="p">(</span><span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mf">1</span>
</span><span class='line'><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">newName</span>
</span></code></pre></td></tr></table></div></figure></p>

<ul>
  <li>
    <p><code class="language-psql">GROUP BY</code>必须出现在<code class="language-psql">WHERE</code>后，<code class="language-psql">ORDER BY</code>前。</p>
  </li>
  <li>
    <p><code class="language-psql">GROUP BY</code>需要配合聚集函数，比如<code class="language-psql">AVE()</code>，一起使用。</p>
  </li>
  <li>
    <p><code class="language-psql">GROUP BY</code>不保证返回结果有特定顺序，如果需要特定顺序，需要指明<code class="language-psql">ORDER BY</code>。<code class="language-psql">ORDER BY</code>可以使用新列名。</p>
  </li>
  <li>
    <p><code class="language-psql">SELECT</code>语句中出现的列，必须在<code class="language-psql">GROUP BY</code>中出现。</p>
  </li>
  <li>
    <p><code class="language-psql">NULL</code>单独给出，多个<code class="language-psql">NULL</code>合并为一组。</p>
  </li>
  <li>
    <p><code class="language-psql">HAVING</code>对分组汇总后数据筛选，区别<code class="language-psql">WHERE</code>（汇总分组前筛选）。不能使用新列名，比如<code class="language-psql">HAVING newName &gt; 1</code>非法。</p>
  </li>
</ul>

<h2 id="postgresql">8. PostgreSQL支持的函数</h2>

<h3 id="section-6">8.1 数值</h3>

<table>
  <thead>
    <tr>
      <th>函数名</th>
      <th>意义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-psql">ABS()</code></td>
      <td>绝对值</td>
    </tr>
    <tr>
      <td><code class="language-psql">SQRT()</code></td>
      <td>平方根</td>
    </tr>
    <tr>
      <td><code class="language-psql">ROUND(v numeric, s int)</code></td>
      <td>取特定小数位数</td>
    </tr>
    <tr>
      <td><code class="language-psql">AVG()</code></td>
      <td>平均值，忽略<code class="language-psql">NULL</code></td>
    </tr>
    <tr>
      <td><code class="language-psql">MAX()</code></td>
      <td>最大值，忽略<code class="language-psql">NULL</code></td>
    </tr>
    <tr>
      <td><code class="language-psql">MIN()</code></td>
      <td>最小指，忽略<code class="language-psql">NULL</code></td>
    </tr>
    <tr>
      <td><code class="language-psql">SUM()</code></td>
      <td>求和，忽略<code class="language-psql">NULL</code></td>
    </tr>
    <tr>
      <td><code class="language-psql">COUNT(*)</code></td>
      <td>所有行数，包括<code class="language-psql">NULL</code></td>
    </tr>
    <tr>
      <td><code class="language-psql">COUNT(column1)</code></td>
      <td>行数，忽略<code class="language-psql">NULL</code></td>
    </tr>
  </tbody>
</table>

<p>详细参考：<a href="http://www.postgresql.org/docs/9.4/static/functions-math.html">PostgreSQL支持的数值操作</a></p>

<h3 id="section-7">8.2 字符串</h3>

<table>
  <thead>
    <tr>
      <th>函数名</th>
      <th>意义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-psql">RTRIM()</code></td>
      <td>删除字符串左侧空格</td>
    </tr>
    <tr>
      <td><code class="language-psql">LTRIM()</code></td>
      <td>删除字符串右侧空格</td>
    </tr>
    <tr>
      <td><code class="language-psql">TRIM()</code></td>
      <td>删除双侧空格</td>
    </tr>
    <tr>
      <td><code class="language-psql">SUBSTRING(string [from int] [for int])</code></td>
      <td>按照索引取字符串（从1开始）</td>
    </tr>
    <tr>
      <td><code class="language-psql">SUBSTRING(string [from int] [for int])</code></td>
      <td>选取符合POSIX正则匹配字符串</td>
    </tr>
    <tr>
      <td><code class="language-psql">CHAR_LENGTH()</code></td>
      <td>计算字符串长度，等同于<code class="language-psql">LENGTH()</code></td>
    </tr>
    <tr>
      <td><code class="language-psql">UPPER()</code></td>
      <td>大写</td>
    </tr>
    <tr>
      <td><code class="language-psql">LOWER()</code></td>
      <td>小写</td>
    </tr>
    <tr>
      <td><code class="language-psql">LEFT(string, n int)</code></td>
      <td>截取左侧n个字符串（从1开始）</td>
    </tr>
  </tbody>
</table>

<p>详细参考：<a href="http://www.postgresql.org/docs/9.4/static/functions-string.html">PostgreSQL支持的字符串操作</a></p>

<h3 id="section-8">8.3 日期</h3>

<table>
  <thead>
    <tr>
      <th>函数名</th>
      <th>意义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-psql">CURRENT_DATE</code></td>
      <td>当前日期</td>
    </tr>
    <tr>
      <td><code class="language-psql">DATE_PART(text, timestamp)</code></td>
      <td>选取日期中的年、月或日</td>
    </tr>
  </tbody>
</table>

<p>详细参考：<a href="http://www.postgresql.org/docs/9.4/static/functions-datetime.html">PostgreSQL支持的日期操作</a></p>

<h2 id="section-9">使用建议</h2>

<ol>
  <li>数据集的名字为一个单词，比如<code class="language-psql">priceCustom</code>而不是一个字符串 <code class="language-psql">'price custom'</code>。同样，命名别名（使用<code class="language-psql">AS</code>）也如此。</li>
</ol>

<h3 id="section-10">参考资料</h3>

<ul>
  <li>
    <p>《SQL必知必会（SQL in 10 Minutes, Sams Teach Yourself (4th Edition)）》<a href="https://book.douban.com/subject/24250054/">豆瓣链接</a></p>
  </li>
  <li>
    <p><a href="https://wiki.postgresql.org/wiki/9.1%E7%AC%AC%E5%9B%9B%E7%AB%A0">PostgreSQL Wiki</a></p>
  </li>
</ul>

<h3 id="section-11">更新记录</h3>

<p>2015年7月29日</p>
]]></content>
  </entry>
  
</feed>
