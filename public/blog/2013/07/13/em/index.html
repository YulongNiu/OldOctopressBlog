<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>探索EM算法 - 牛牛龙</title>
  <meta name="author" content="Yulong Niu">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yulongniu.bionutshell.org/blog/2013/07/13/em">
  <link href="/favicon.ico" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="牛牛龙" type="application/atom+xml">

  <!-- http://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://yulongniu.bionutshell.org/blog/2013/07/13/em">
  <meta property="og:title" content="探索EM算法 - 牛牛龙">
  

  <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({
     tex2jax: {
         inlineMath: [ ['$','$'], ["\\(","\\)"] ],
         processEscapes: true,
         extensions: ["color.js"]
     }
 });
</script>

<script type="text/x-mathjax-config">
 MathJax.Hub.Config({
     tex2jax: {
         skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
     }
 });
</script>

<script type="text/x-mathjax-config">
 MathJax.Hub.Queue(function() {
     var all = MathJax.Hub.getAllJax(), i;
     for(i=0; i < all.length; i += 1) {
         all[i].SourceElement().parentNode.className += ' has-jax';
     }
 });
</script>

<!-- latest mathjax -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async>
</script>

<meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/ ; script-src 'self' https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/ 'unsafe-eval';style-src 'self' 'unsafe-inline'; font-src 'self'; img-src 'self';">

<script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>

<!--enable to choose theme in octostrap-->

<link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">



<!-- link open with new tab  -->
<script>
  function addBlankTargetForLinks () {
  $('a[href^="http"]').each(function(){
  $(this).attr('target', '_blank');
  });
  }

  $(document).bind('DOMNodeInserted', function(event) {
  addBlankTargetForLinks();
  });
</script>


  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  

  
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53073828-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">牛牛龙</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="index" href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
		<li >
                  <a href="/whoami">WhoAmI</a>
                </li>
		<li >
                  <a href="/link">Link</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:yulongniu.bionutshell.org">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="牛牛龙" />
    
    <meta itemprop="url" content="http://yulongniu.bionutshell.org" />
    <article class="hentry" role="article" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-07-13T13:23:22+02:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
           | <a href="#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="http://yulongniu.bionutshell.org">Comments</a>
        
      </p>
    
    
    <h1 class="entry-title" itemprop="name headline">
        探索EM算法
        
    </h1>
    
  </header>


<div class="entry-content clearfix" itemprop="articleBody description"><script type="text/x-mathjax-config">
MathJax.Hub.Config({
TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

<script type="math/tex; mode=display">\newcommand{\P}{\mathrm{P}}</script>

<script type="math/tex; mode=display">\DeclareMathOperator*{\argmax}{arg\,max}</script>

<h2 id="em">EM算法的推出</h2>

<p>考虑观测数据$Y=\{y_1, y_2, \dots, y_m\}$，其中不可观测数据为$Z=\{z_1, z_2, \dots, z_k\}$，需要估计的参数为$\theta=\{\theta_1, \theta_2, \dots, \theta_t\}$。$Z$可以是离散或连续型随机变量，以下过程中假设$Z$为离散型（$Z$为连续型，则全概率公式由求和改为积分）。则观测数据的对数似然函数为：</p>

<!--more-->

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\begin{split}
L(\theta) &= \log\left(\prod_{j=1}^m \P(y_j|\theta)\right) \\
&= \sum_{j=1}^m \log\left( \sum_{z \in Z} \P(y_j, z|\theta)\right)
\end{split}
\label{eq:1}
\end{align} %]]></script>

<p>为了使$L(\theta)$最大，很容易想到对$\theta$偏导求极值。但有一个困难，即$Z$不可观测，导致的直接后果是对数套求和，计算难度增加。直觉是，<strong>否能找到一个方法，将求和放在对数外面？</strong>一个常用的技巧是转化为不等式，<a href="https://en.wikipedia.org/wiki/Jensen%27s_inequality">Jensen’s inequality</a>描述了积分的函数与函数的积分的关系。由于$\log(x)$是凹函数，尝试考察某一次特定的$\theta^{(n)}$取值后，$L(\theta)$与$L(\theta^{(n)})$的差：</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\begin{split}
L(\theta) - L(\theta^{(n)}) &= \sum_{j=1}^m \log\left( \sum_{z \in Z} \P(y_j, z|\theta)\right) - L(\theta^{(n)}) \\
&= \sum_{j=1}^m \log\left( \sum_{z \in Z} \P(z|y_j, \theta^{(n)}) \frac{\P(y_j, z|\theta)}{\P(z|y_j, \theta^{(n)})}\right) - L(\theta^{(n)}) \\
&\geq \sum_{j=1}^m  \sum_{z \in Z} \P(z|y_j, \theta^{(n)}) \log \left( \frac{\P(y_j, z|\theta)}{\P(z|y_j, \theta^{(n)})} \right) \\
&- \sum_{j=1}^m \sum_{z \in Z} \P(z|y_j, \theta^{(n)}) \log(\P(y_j|\theta^{n})) \\
&= \sum_{j=1}^m  \sum_{z \in Z} \P(z|y_j, \theta^{(n)}) \log\left(\frac{\P(y_j, z|\theta)}{\P(y_j, z|\theta^{(n)})} \right)
\end{split}
\label{eq:2}
\end{align} %]]></script>

<p>从$\eqref{eq:2}$可以得到$L(\theta)$的一个下限：</p>

<script type="math/tex; mode=display">\begin{align}
\begin{split}
L(\theta) \geq L(\theta^{(n)}) + \sum_{j=1}^m  \sum_{z \in Z} \P(z|y_j, \theta^{(n)}) \log\left(\frac{\P(y_j, z|\theta)}{\P(y_j, z|\theta^{(n)})} \right)
\end{split}
\label{eq:3}
\end{align}</script>

<p>当$\theta=\theta^{(n)}$时，等号成立。有意思的是，由于$\theta^{(n)}$已知，$\eqref{eq:3}$的右半部分极大化要比$\eqref{eq:1}$简单很多，尽管右边的极值是一个下限，此时的$\theta$的估计值为：</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\begin{split}
\theta^{(n+1)} &= \argmax_\theta \left( L(\theta^{(n)}) + \sum_{j=1}^m  \sum_{z \in Z} \P(z|y_j, \theta^{(n)}) \log\left(\frac{\P(y_j, z|\theta)}{\P(y_j, z|\theta^{(n)})} \right) \right) \\
&=  \argmax_\theta \left(\sum_{j=1}^m  \sum_{z \in Z} \P(z|y_j, \theta^{(n)}) \log\left(\P(y_j, z|\theta)\right) \right)
\end{split}
\label{eq:4}
\end{align} %]]></script>

<p>EM算法的核心是通过迭代$L(\theta)$的下限极大化，进而逼近极值。EM算法每次迭代，都会靠近$L(\theta)$，但是最终可能得到局部最优。因此，EM算法对初始值敏感，可以多选几个初始值，对比结果。</p>

<h2 id="section">双硬币模型</h2>

<p><a href="#Ref">参考资料2</a>中使用EM算法解决双硬币模型：</p>

<script type="math/tex; mode=display">\begin{align*}
\begin{split}
\P(y|\theta) = \theta_1^{y}(1-\theta_1)^{N-y} + \theta_2^{y}(1-\theta_2)^{N-y}
\end{split}
\end{align*}</script>

<p>每次从两个硬币中选择一个，抛$N$次并记录正反面，同样的“选硬币-抛$N$次”进行$m$次，估计两个硬币正面出现的概率。观测数据$Y=\{y_1, y_2, \dots, y_m\}$为每次正面朝上的次数，每次抽样的不可观测数据$Z=\{z_1, z_2\}$为选择的硬币，估计参数为$\theta=\{\theta_1, \theta_2\}$。</p>

<p>对于第$n$次迭代，观察$\P(z_1|y_j, \theta^{(n)})$为：</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
\begin{split}
\P(z_1|y_j, \theta^{(n)}) &= \frac{\P(z_1, y_j|\theta^{(n)})}{\sum\limits_{z \in Z}\P(z, y_j|\theta^{(n)})} \\
&= \frac{\theta_1^{(n)y_j} (1-\theta_1^{(n)})^{N-y_j}}{\theta_1^{(n)y_j} (1-\theta_1^{(n)})^{N-y_j} + \theta_2^{(n)y_j} (1-\theta_2^{(n)})^{N-y_j}} \\
&= \mu_{1j}
\end{split}
\end{align*} %]]></script>

<p>易得$\P(z_2|y_j, \theta^{(n)}) = 1-\mu_{1j} = \mu_{2j}$</p>

<p>根据$\eqref{eq:4}$得，</p>

<script type="math/tex; mode=display">\begin{align*}
\begin{split}
\sum_{j=1}^m \left( \mu_{1j}\log\left(\theta_1^{y_j} (1-\theta_1)^{N-y_j}\right) + \mu_{2j}\log\left(\theta_2^{y_j} (1-\theta_2)^{N-y_j}\right) \right)
\end{split}
\end{align*}</script>

<p>分别对$\theta_1$和$\theta_2$求偏导取极限，得第$n+1$次$\theta$估计为：</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
\begin{split}
\theta_1^{(n+1)} &= \frac{\sum\limits_{j=1}^m \mu_{1j} y_j}{N\sum\limits
_{j=1}^m \mu_{1j}} \\
\theta_2^{(n+1)} &= \frac{\sum\limits_{j=1}^m \mu_{2j} y_j}{N\sum\limits_{j=1}^m \mu_{2j}} \\
\end{split}
\end{align*} %]]></script>

<h2 id="section-1">混合高斯模型</h2>

<p>混合高斯分布模型：</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
\begin{split}
\P(y|\theta) &= \sum\limits_{k=1}^{K}\alpha_k\phi(y|\theta_k), \theta_k = \{\mu_k, \sigma_k\} \\
\phi(y|\theta_k) &= \frac{1}{\sigma_k \sqrt{2\pi}} \exp \left( -\frac{(y-\mu_k)^2}{2\sigma_k^2} \right) \\
\sum_{k=1}^{K}\alpha_k &= 1
\end{split}
\end{align*} %]]></script>

<p>每次取样，依概率$\alpha_k$选择第$k$个高斯分布，根据相应概率分布生成观测数据$y_i$，由此组成观测数据$Y=\{y_1, y_2, \dots, y_m\}$。每次取样不可观测数据$Z=\{z_1, z_2, \dots, z_K\}$为抽取的高斯分布。估计参数为$\{\theta_1, \theta_2, \dots, \theta_K, \alpha_1, \alpha_2, \dots, \alpha_K\}$。</p>

<p>对于第$n$次迭代，观察$\P(z_1|y_j, \theta^{(n)})$为：</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
\begin{split}
\P(z_1|y_j, \theta^{(n)}) &= \frac{\P(z_1, y_j|\theta^{(n)})}{\sum\limits_{z \in Z}\P(z, y_j|\theta^{(n)})} \\
&= \frac{\alpha_1^{(n)}\phi(y_j|\theta_1^{(n)})}{\sum\limits_{k=1}^{K}\alpha_k^{(n)}\phi(y_j|\theta_k^{(n)})} \\
&= \lambda_{1j}
\end{split}
\end{align*} %]]></script>

<p>易得$\sum\limits_{k=1}^{K} \lambda_{kj} = 1$</p>

<p>根据$\eqref{eq:4}$得，</p>

<script type="math/tex; mode=display">\begin{align*}
\begin{split}
\sum_{j=1}^m \sum_{k=1}^{K} \lambda_{kj} \left( \log(\alpha_k) + \log\left( \frac{1}{\sqrt{2\pi}} \right) - \log(\sigma_k) - \frac{(y_j-\mu_k)^2}{2\sigma_k^2} \right)
\end{split}
\end{align*}</script>

<p>对各个参数求偏导取极限，第$n+1$次参数估计为：</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
\begin{split}
\alpha_k^{(n+1)} &= \frac{\sum_{j=1}^{m} \lambda_{kj}}{m}, \ k=1, 2, \dots, K\\
\mu_k^{(n+1)} &= \frac{\sum_{j=1}^{m} \lambda_{kj} y_j}{\sum_{j=1}^{m} \lambda_{kj}}, \ k=1, 2, \dots, K\\
\sigma_k^{2(n+1)} &= \frac{\sum_{j=1}^{m} \lambda_{kj} (y_j-\mu_k)^2}{\sum_{j=1}^{m} \lambda_{kj}}, \ k=1, 2, \dots, K
\end{split}
\end{align*} %]]></script>

<p>混合高斯模型在生物信息学中有广泛的应用，例如<a href="#Ref">参考资料4</a>用于家族拷贝数变异（copy number variations，CNV）检测。</p>

<h3 id="a-idrefa"><a id="Ref">参考资料</a></h3>

<ul>
  <li>
    <p>李航《统计学习方法》</p>
  </li>
  <li>
    <p>Do CB, Batzoglou S: What is the expectation maximization algorithm? Nat Biotechnol. 2008;26(8):897-9.</p>
  </li>
  <li>
    <p><a href="https://www.cs.utah.edu/~piyush/teaching/EM_algorithm.pdf">The Expectation Maximization Algorithm A short tutorial</a></p>
  </li>
  <li>
    <p>Chu JH, Rogers A, Ionita-Laza I, Darvishi K, Mills RE, Lee C, Raby BA: Copy number variation genotyping using family information. BMC Bioinformatics. 2013;14:157.</p>
  </li>
</ul>

<h3 id="section-2">更新记录</h3>

<p>2018年2月4日</p>

</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="glyphicon glyphicon-user"></span> <span class="byline author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person">Posted by <span class="fn" itemprop="name">Yulong Niu</span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-07-13T13:23:22+02:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
          

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/blog/categories/bioinfor/'>bioinfor</a>
  
</span>


        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://yulongniu.bionutshell.org/blog/2013/07/13/em/" data-via="" data-counturl="http://yulongniu.bionutshell.org/blog/2013/07/13/em/" >Tweet</a>
  
  
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/blog/2013/06/18/bioinfor-tools/" title="Previous Post: 生物信息学工具网址">&laquo; 生物信息学工具网址</a></li>
            
            
            <li class="next"><a href="/blog/2013/10/02/ggplot2-notes/" title="Next Post: R ggplot2 notes">R ggplot2 notes &raquo;</a></li>
            
          </ul>
        
      </footer>
    </article>
    
      <section>
        <h2>Comments</h2>
        <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
      </section>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/2019/05/04/small-changes-smooth-review/">小的改进能提升文章审稿速度</a>
    
    <a class="list-group-item " href="/blog/2019/04/15/deseq2-design/">DESeq2包的对比组设计</a>
    
    <a class="list-group-item " href="/blog/2018/11/26/r-dplyr/">R包dplyr使用集锦</a>
    
    <a class="list-group-item " href="/blog/2018/10/03/profile-r-and-rcpp/">R和Rcpp的性能检测</a>
    
    <a class="list-group-item " href="/blog/2018/07/19/rcppparallel-test/">使用RcppParallel并行计算</a>
    
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Categories</h3>
  </div>
  <div class="list-group">
    
    
    <a class="list-group-item " href="/blog/categories/linux/index.html">
        <span class="badge">10</span>
        linux
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/r/index.html">
        <span class="badge">12</span>
        r
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/lisp/index.html">
        <span class="badge">6</span>
        lisp
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/ppr/index.html">
        <span class="badge">6</span>
        ppr
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/bioinfor/index.html">
        <span class="badge">24</span>
        bioinfor
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/c/index.html">
        <span class="badge">2</span>
        c
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/hcj/index.html">
        <span class="badge">1</span>
        hcj
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/share/index.html">
        <span class="badge">2</span>
        share
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/java/index.html">
        <span class="badge">1</span>
        java
      </a>
    
  </div>
</section>






    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2019 - Yulong Niu<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'yulongniu';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://yulongniu.bionutshell.org/blog/2013/07/13/em/';
        var disqus_url = 'http://yulongniu.bionutshell.org/blog/2013/07/13/em/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>


  </body>
</html>
